var Gd=Object.defineProperty;var la=n=>{throw TypeError(n)};var Xd=(n,e,t)=>e in n?Gd(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Qn=(n,e,t)=>Xd(n,typeof e!="symbol"?e+"":e,t),Ko=(n,e,t)=>e.has(n)||la("Cannot "+t);var m=(n,e,t)=>(Ko(n,e,"read from private field"),t?t.call(n):e.get(n)),x=(n,e,t)=>e.has(n)?la("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),D=(n,e,t,r)=>(Ko(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),vt=(n,e,t)=>(Ko(n,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const Wa=!1;var xl=Array.isArray,Zd=Array.prototype.indexOf,Il=Array.from,sl=Object.defineProperty,Rr=Object.getOwnPropertyDescriptor,Ga=Object.getOwnPropertyDescriptors,Qd=Object.prototype,$d=Array.prototype,El=Object.getPrototypeOf,aa=Object.isExtensible;function eu(n){return typeof n=="function"}const si=()=>{};function tu(n){return n()}function il(n){for(var e=0;e<n.length;e++)n[e]()}function Xa(){var n,e,t=new Promise((r,s)=>{n=r,e=s});return{promise:t,resolve:n,reject:e}}const Tt=2,Ol=4,Co=8,_r=16,An=32,wr=64,Rl=128,Jt=256,ro=512,wt=1024,Ft=2048,Un=4096,sn=8192,yr=16384,Al=32768,Ii=65536,ca=1<<17,nu=1<<18,$s=1<<19,Za=1<<20,ol=1<<21,Ul=1<<22,or=1<<23,lr=Symbol("$state"),ru=Symbol("legacy props"),su=Symbol(""),Or=new class extends Error{constructor(){super(...arguments);Qn(this,"name","StaleReactionError");Qn(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function iu(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function ou(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function lu(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function au(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function cu(n){throw new Error("https://svelte.dev/e/effect_orphan")}function du(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function uu(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function hu(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function fu(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function gu(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function vu(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const ko=1,So=2,Qa=4,mu=8,pu=16,_u=1,wu=2,yu=4,bu=8,Cu=16,ku=1,Su=2,mt=Symbol(),Du="http://www.w3.org/1999/xhtml";function Tu(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let Mu=!1;function $a(n){return n===this.v}function xu(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function ec(n){return!xu(n,this.v)}let ei=!1,Iu=!1;function Eu(){ei=!0}let Qe=null;function Vs(n){Qe=n}function Xt(n,e=!1,t){Qe={p:Qe,c:null,e:null,s:n,x:null,l:ei&&!e?{s:null,u:null,$:[]}:null}}function Zt(n){var e=Qe,t=e.e;if(t!==null){e.e=null;for(var r of t)mc(r)}return Qe=e.p,{}}function Ei(){return!ei||Qe!==null&&Qe.l===null}let $n=[];function tc(){var n=$n;$n=[],il(n)}function Hn(n){if($n.length===0&&!oi){var e=$n;queueMicrotask(()=>{e===$n&&tc()})}$n.push(n)}function Ou(){for(;$n.length>0;)tc()}const Ru=new WeakMap;function nc(n){var e=Se;if(e===null)return Ce.f|=or,n;if((e.f&Al)===0){if((e.f&Rl)===0)throw!e.parent&&n instanceof Error&&rc(n),n;e.b.error(n)}else Hs(n,e)}function Hs(n,e){for(;e!==null;){if((e.f&Rl)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&rc(n),n}function rc(n){const e=Ru.get(n);e&&(sl(n,"message",{value:e.message}),sl(n,"stack",{value:e.stack}))}const Ki=new Set;let Be=null,Ji=null,ht=null,ll=new Set,fn=[],Do=null,al=!1,oi=!1;var Nr,Fr,tr,Si,Br,nr,zr,Di,Ti,Gt,cl,Wi,dl;const wo=class wo{constructor(){x(this,Gt);Qn(this,"current",new Map);x(this,Nr,new Map);x(this,Fr,new Set);x(this,tr,0);x(this,Si,null);x(this,Br,[]);x(this,nr,[]);x(this,zr,[]);x(this,Di,[]);x(this,Ti,[]);Qn(this,"skipped_effects",new Set)}process(e){var i;fn=[],Ji=null,this.apply();for(const l of e)vt(this,Gt,cl).call(this,l);if(m(this,tr)===0){var t=ht;vt(this,Gt,dl).call(this);var r=m(this,Br),s=m(this,nr);D(this,Br,[]),D(this,nr,[]),D(this,zr,[]),Ji=this,Be=null,ht=t,da(r),da(s),Ji=null,(i=m(this,Si))==null||i.resolve()}else vt(this,Gt,Wi).call(this,m(this,Br)),vt(this,Gt,Wi).call(this,m(this,nr)),vt(this,Gt,Wi).call(this,m(this,zr));ht=null}capture(e,t){m(this,Nr).has(e)||m(this,Nr).set(e,t),this.current.set(e,e.v),ht==null||ht.set(e,e.v)}activate(){Be=this}deactivate(){Be=null,ht=null}flush(){if(fn.length>0){if(this.activate(),sc(),Be!==null&&Be!==this)return}else m(this,tr)===0&&vt(this,Gt,dl).call(this);this.deactivate();for(const e of ll)if(ll.delete(e),e(),Be!==null)break}increment(){D(this,tr,m(this,tr)+1)}decrement(){D(this,tr,m(this,tr)-1);for(const e of m(this,Di))yt(e,Ft),ur(e);for(const e of m(this,Ti))yt(e,Un),ur(e);this.flush()}add_callback(e){m(this,Fr).add(e)}settled(){return(m(this,Si)??D(this,Si,Xa())).promise}static ensure(){if(Be===null){const e=Be=new wo;Ki.add(Be),oi||wo.enqueue(()=>{Be===e&&e.flush()})}return Be}static enqueue(e){Hn(e)}apply(){}};Nr=new WeakMap,Fr=new WeakMap,tr=new WeakMap,Si=new WeakMap,Br=new WeakMap,nr=new WeakMap,zr=new WeakMap,Di=new WeakMap,Ti=new WeakMap,Gt=new WeakSet,cl=function(e){e.f^=wt;for(var t=e.first;t!==null;){var r=t.f,s=(r&(An|wr))!==0,i=s&&(r&wt)!==0,l=i||(r&sn)!==0||this.skipped_effects.has(t);if(!l&&t.fn!==null){s?t.f^=wt:(r&Ol)!==0?m(this,nr).push(t):Ui(t)&&((t.f&_r)!==0&&m(this,zr).push(t),gi(t));var a=t.first;if(a!==null){t=a;continue}}var c=t.parent;for(t=t.next;t===null&&c!==null;)t=c.next,c=c.parent}},Wi=function(e){for(const t of e)((t.f&Ft)!==0?m(this,Di):m(this,Ti)).push(t),yt(t,wt);e.length=0},dl=function(){var e;for(const t of m(this,Fr))t();if(m(this,Fr).clear(),Ki.size>1){m(this,Nr).clear();let t=!0;for(const r of Ki){if(r===this){t=!1;continue}const s=[];for(const[l,a]of this.current){if(r.current.has(l))if(t&&a!==r.current.get(l))r.current.set(l,a);else continue;s.push(l)}if(s.length===0)continue;const i=[...r.current.keys()].filter(l=>!this.current.has(l));if(i.length>0){for(const l of s)ic(l,i);if(fn.length>0){Be=r,r.apply();for(const l of fn)vt(e=r,Gt,cl).call(e,l);fn=[],r.deactivate()}}}Be=null}Ki.delete(this)};let xn=wo;function Au(n){var e=oi;oi=!0;try{for(var t;;){if(Ou(),fn.length===0&&(Be==null||Be.flush(),fn.length===0))return Do=null,t;sc()}}finally{oi=e}}function sc(){var n=Ur;al=!0;try{var e=0;for(ha(!0);fn.length>0;){var t=xn.ensure();if(e++>1e3){var r,s;Uu()}t.process(fn),qn.clear()}}finally{al=!1,ha(n),Do=null}}function Uu(){try{du()}catch(n){Hs(n,Do)}}let Dn=null;function da(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(yr|sn))===0&&Ui(r)&&(Dn=[],gi(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?wc(r):r.fn=null),(Dn==null?void 0:Dn.length)>0)){qn.clear();for(const s of Dn)gi(s);Dn=[]}}Dn=null}}function ic(n,e){if(n.reactions!==null)for(const t of n.reactions){const r=t.f;(r&Tt)!==0?ic(t,e):(r&(Ul|_r))!==0&&oc(t,e)&&(yt(t,Ft),ur(t))}}function oc(n,e){if(n.deps!==null){for(const t of n.deps)if(e.includes(t)||(t.f&Tt)!==0&&oc(t,e))return!0}return!1}function ur(n){for(var e=Do=n;e.parent!==null;){e=e.parent;var t=e.f;if(al&&e===Se&&(t&_r)!==0)return;if((t&(wr|An))!==0){if((t&wt)===0)return;e.f^=wt}}fn.push(e)}function Lu(n){let e=0,t=hr(0),r;return()=>{Xu()&&(o(t),Ai(()=>(e===0&&(r=_(()=>n(()=>li(t)))),e+=1,()=>{Hn(()=>{e-=1,e===0&&(r==null||r(),r=void 0,li(t))})})))}}var ju=Ii|$s|Rl;function Pu(n,e,t){new Nu(n,e,t)}var $t,qt,Ml,cn,rr,dn,Vt,It,un,Nn,sr,Fn,ir,Bn,yo,bo,Dt,Fu,Bu,Gi,Xi,ul;class Nu{constructor(e,t,r){x(this,Dt);Qn(this,"parent");x(this,$t,!1);x(this,qt);x(this,Ml,null);x(this,cn);x(this,rr);x(this,dn);x(this,Vt,null);x(this,It,null);x(this,un,null);x(this,Nn,null);x(this,sr,0);x(this,Fn,0);x(this,ir,!1);x(this,Bn,null);x(this,yo,()=>{m(this,Bn)&&Ys(m(this,Bn),m(this,sr))});x(this,bo,Lu(()=>(D(this,Bn,hr(m(this,sr))),()=>{D(this,Bn,null)})));D(this,qt,e),D(this,cn,t),D(this,rr,r),this.parent=Se.b,D(this,$t,!!m(this,cn).pending),D(this,dn,xo(()=>{Se.b=this;{try{D(this,Vt,tn(()=>r(m(this,qt))))}catch(s){this.error(s)}m(this,Fn)>0?vt(this,Dt,Xi).call(this):D(this,$t,!1)}},ju))}is_pending(){return m(this,$t)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!m(this,cn).pending}update_pending_count(e){vt(this,Dt,ul).call(this,e),D(this,sr,m(this,sr)+e),ll.add(m(this,yo))}get_effect_pending(){return m(this,bo).call(this),o(m(this,Bn))}error(e){var t=m(this,cn).onerror;let r=m(this,cn).failed;if(m(this,ir)||!t&&!r)throw e;m(this,Vt)&&(Ot(m(this,Vt)),D(this,Vt,null)),m(this,It)&&(Ot(m(this,It)),D(this,It,null)),m(this,un)&&(Ot(m(this,un)),D(this,un,null));var s=!1,i=!1;const l=()=>{if(s){Tu();return}s=!0,i&&vu(),xn.ensure(),D(this,sr,0),m(this,un)!==null&&Ar(m(this,un),()=>{D(this,un,null)}),D(this,$t,this.has_pending_snippet()),D(this,Vt,vt(this,Dt,Gi).call(this,()=>(D(this,ir,!1),tn(()=>m(this,rr).call(this,m(this,qt)))))),m(this,Fn)>0?vt(this,Dt,Xi).call(this):D(this,$t,!1)};var a=Ce;try{Et(null),i=!0,t==null||t(e,l),i=!1}catch(c){Hs(c,m(this,dn)&&m(this,dn).parent)}finally{Et(a)}r&&Hn(()=>{D(this,un,vt(this,Dt,Gi).call(this,()=>{D(this,ir,!0);try{return tn(()=>{r(m(this,qt),()=>e,()=>l)})}catch(c){return Hs(c,m(this,dn).parent),null}finally{D(this,ir,!1)}}))})}}$t=new WeakMap,qt=new WeakMap,Ml=new WeakMap,cn=new WeakMap,rr=new WeakMap,dn=new WeakMap,Vt=new WeakMap,It=new WeakMap,un=new WeakMap,Nn=new WeakMap,sr=new WeakMap,Fn=new WeakMap,ir=new WeakMap,Bn=new WeakMap,yo=new WeakMap,bo=new WeakMap,Dt=new WeakSet,Fu=function(){try{D(this,Vt,tn(()=>m(this,rr).call(this,m(this,qt))))}catch(e){this.error(e)}D(this,$t,!1)},Bu=function(){const e=m(this,cn).pending;e&&(D(this,It,tn(()=>e(m(this,qt)))),xn.enqueue(()=>{D(this,Vt,vt(this,Dt,Gi).call(this,()=>(xn.ensure(),tn(()=>m(this,rr).call(this,m(this,qt)))))),m(this,Fn)>0?vt(this,Dt,Xi).call(this):(Ar(m(this,It),()=>{D(this,It,null)}),D(this,$t,!1))}))},Gi=function(e){var t=Se,r=Ce,s=Qe;pn(m(this,dn)),Et(m(this,dn)),Vs(m(this,dn).ctx);try{return e()}catch(i){return nc(i),null}finally{pn(t),Et(r),Vs(s)}},Xi=function(){const e=m(this,cn).pending;m(this,Vt)!==null&&(D(this,Nn,document.createDocumentFragment()),Cc(m(this,Vt),m(this,Nn))),m(this,It)===null&&D(this,It,tn(()=>e(m(this,qt))))},ul=function(e){var t;if(!this.has_pending_snippet()){this.parent&&vt(t=this.parent,Dt,ul).call(t,e);return}D(this,Fn,m(this,Fn)+e),m(this,Fn)===0&&(D(this,$t,!1),m(this,It)&&Ar(m(this,It),()=>{D(this,It,null)}),m(this,Nn)&&(m(this,qt).before(m(this,Nn)),D(this,Nn,null)),Hn(()=>{xn.ensure().flush()}))};function zu(n,e,t){const r=Ei()?Oi:He;if(e.length===0){t(n.map(r));return}var s=Be,i=Se,l=Ku();Promise.all(e.map(a=>qu(a))).then(a=>{l();try{t([...n.map(r),...a])}catch(c){(i.f&yr)===0&&Hs(c,i)}s==null||s.deactivate(),hl()}).catch(a=>{Hs(a,i)})}function Ku(){var n=Se,e=Ce,t=Qe,r=Be;return function(){pn(n),Et(e),Vs(t),r==null||r.activate()}}function hl(){pn(null),Et(null),Vs(null)}function Oi(n){var e=Tt|Ft,t=Ce!==null&&(Ce.f&Tt)!==0?Ce:null;return Se===null||t!==null&&(t.f&Jt)!==0?e|=Jt:Se.f|=$s,{ctx:Qe,deps:null,effects:null,equals:$a,f:e,fn:n,reactions:null,rv:0,v:mt,wv:0,parent:t??Se,ac:null}}function qu(n,e){let t=Se;t===null&&ou();var r=t.b,s=void 0,i=hr(mt),l=!Ce,a=new Map;return eh(()=>{var v;var c=Xa();s=c.promise;try{Promise.resolve(n()).then(c.resolve,c.reject).then(hl)}catch(f){c.reject(f),hl()}var d=Be,u=r.is_pending();l&&(r.update_pending_count(1),u||(d.increment(),(v=a.get(d))==null||v.reject(Or),a.delete(d),a.set(d,c)));const h=(f,g=void 0)=>{if(u||d.activate(),g)g!==Or&&(i.f|=or,Ys(i,g));else{(i.f&or)!==0&&(i.f^=or),Ys(i,f);for(const[p,w]of a){if(a.delete(p),p===d)break;w.reject(Or)}}l&&(r.update_pending_count(-1),u||d.decrement())};c.promise.then(h,f=>h(null,f||"unknown"))}),vc(()=>{for(const c of a.values())c.reject(Or)}),new Promise(c=>{function d(u){function h(){u===s?c(i):d(s)}u.then(h,h)}d(s)})}function Mr(n){const e=Oi(n);return kc(e),e}function He(n){const e=Oi(n);return e.equals=ec,e}function lc(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)Ot(e[t])}}function Vu(n){for(var e=n.parent;e!==null;){if((e.f&Tt)===0)return e;e=e.parent}return null}function Ll(n){var e,t=Se;pn(Vu(n));try{lc(n),e=Mc(n)}finally{pn(t)}return e}function ac(n){var e=Ll(n);if(n.equals(e)||(n.v=e,n.wv=Dc()),!br)if(ht!==null)ht.set(n,n.v);else{var t=(zn||(n.f&Jt)!==0)&&n.deps!==null?Un:wt;yt(n,t)}}const qn=new Map;function hr(n,e){var t={f:0,v:n,reactions:null,equals:$a,rv:0,wv:0};return t}function P(n,e){const t=hr(n);return kc(t),t}function vn(n,e=!1,t=!0){var s;const r=hr(n);return e||(r.equals=ec),ei&&t&&Qe!==null&&Qe.l!==null&&((s=Qe.l).s??(s.s=[])).push(r),r}function O(n,e){return S(n,_(()=>o(n))),e}function S(n,e,t=!1){Ce!==null&&(!nn||(Ce.f&ca)!==0)&&Ei()&&(Ce.f&(Tt|_r|Ul|ca))!==0&&!(St!=null&&St.includes(n))&&gu();let r=t?st(e):e;return Ys(n,r)}function Ys(n,e){if(!n.equals(e)){var t=n.v;br?qn.set(n,e):qn.set(n,t),n.v=e;var r=xn.ensure();r.capture(n,t),(n.f&Tt)!==0&&((n.f&Ft)!==0&&Ll(n),yt(n,(n.f&Jt)===0?wt:Un)),n.wv=Dc(),cc(n,Ft),Ei()&&Se!==null&&(Se.f&wt)!==0&&(Se.f&(An|wr))===0&&(Kt===null?rh([n]):Kt.push(n))}return e}function li(n){S(n,n.v+1)}function cc(n,e){var t=n.reactions;if(t!==null)for(var r=Ei(),s=t.length,i=0;i<s;i++){var l=t[i],a=l.f;if(!(!r&&l===Se)){var c=(a&Ft)===0;c&&yt(l,e),(a&Tt)!==0?cc(l,Un):c&&((a&_r)!==0&&Dn!==null&&Dn.push(l),ur(l))}}}function st(n){if(typeof n!="object"||n===null||lr in n)return n;const e=El(n);if(e!==Qd&&e!==$d)return n;var t=new Map,r=xl(n),s=P(0),i=ar,l=a=>{if(ar===i)return a();var c=Ce,d=ar;Et(null),ga(i);var u=a();return Et(c),ga(d),u};return r&&t.set("length",P(n.length)),new Proxy(n,{defineProperty(a,c,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&hu();var u=t.get(c);return u===void 0?u=l(()=>{var h=P(d.value);return t.set(c,h),h}):S(u,d.value,!0),!0},deleteProperty(a,c){var d=t.get(c);if(d===void 0){if(c in a){const u=l(()=>P(mt));t.set(c,u),li(s)}}else S(d,mt),li(s);return!0},get(a,c,d){var f;if(c===lr)return n;var u=t.get(c),h=c in a;if(u===void 0&&(!h||(f=Rr(a,c))!=null&&f.writable)&&(u=l(()=>{var g=st(h?a[c]:mt),p=P(g);return p}),t.set(c,u)),u!==void 0){var v=o(u);return v===mt?void 0:v}return Reflect.get(a,c,d)},getOwnPropertyDescriptor(a,c){var d=Reflect.getOwnPropertyDescriptor(a,c);if(d&&"value"in d){var u=t.get(c);u&&(d.value=o(u))}else if(d===void 0){var h=t.get(c),v=h==null?void 0:h.v;if(h!==void 0&&v!==mt)return{enumerable:!0,configurable:!0,value:v,writable:!0}}return d},has(a,c){var v;if(c===lr)return!0;var d=t.get(c),u=d!==void 0&&d.v!==mt||Reflect.has(a,c);if(d!==void 0||Se!==null&&(!u||(v=Rr(a,c))!=null&&v.writable)){d===void 0&&(d=l(()=>{var f=u?st(a[c]):mt,g=P(f);return g}),t.set(c,d));var h=o(d);if(h===mt)return!1}return u},set(a,c,d,u){var N;var h=t.get(c),v=c in a;if(r&&c==="length")for(var f=d;f<h.v;f+=1){var g=t.get(f+"");g!==void 0?S(g,mt):f in a&&(g=l(()=>P(mt)),t.set(f+"",g))}if(h===void 0)(!v||(N=Rr(a,c))!=null&&N.writable)&&(h=l(()=>P(void 0)),S(h,st(d)),t.set(c,h));else{v=h.v!==mt;var p=l(()=>st(d));S(h,p)}var w=Reflect.getOwnPropertyDescriptor(a,c);if(w!=null&&w.set&&w.set.call(u,d),!v){if(r&&typeof c=="string"){var C=t.get("length"),U=Number(c);Number.isInteger(U)&&U>=C.v&&S(C,U+1)}li(s)}return!0},ownKeys(a){o(s);var c=Reflect.ownKeys(a).filter(h=>{var v=t.get(h);return v===void 0||v.v!==mt});for(var[d,u]of t)u.v!==mt&&!(d in a)&&c.push(d);return c},setPrototypeOf(){fu()}})}var hi,dc,uc,hc;function Hu(){if(hi===void 0){hi=window,dc=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;uc=Rr(e,"firstChild").get,hc=Rr(e,"nextSibling").get,aa(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),aa(t)&&(t.__t=void 0)}}function Js(n=""){return document.createTextNode(n)}function Ws(n){return uc.call(n)}function Ri(n){return hc.call(n)}function I(n,e){return Ws(n)}function $e(n,e=!1){{var t=Ws(n);return t instanceof Comment&&t.data===""?Ri(t):t}}function E(n,e=1,t=!1){let r=n;for(;e--;)r=Ri(r);return r}function Yu(n){n.textContent=""}function fc(){return!1}let ua=!1;function Ju(){ua||(ua=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{var e;if(!n.defaultPrevented)for(const t of n.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function To(n){var e=Ce,t=Se;Et(null),pn(null);try{return n()}finally{Et(e),pn(t)}}function Wu(n,e,t,r=t){n.addEventListener(e,()=>To(t));const s=n.__on_r;s?n.__on_r=()=>{s(),r(!0)}:n.__on_r=()=>r(!0),Ju()}function gc(n){Se===null&&Ce===null&&cu(),Ce!==null&&(Ce.f&Jt)!==0&&Se===null&&au(),br&&lu()}function Gu(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function bn(n,e,t,r=!0){var s=Se;s!==null&&(s.f&sn)!==0&&(n|=sn);var i={ctx:Qe,deps:null,nodes_start:null,nodes_end:null,f:n|Ft,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{gi(i),i.f|=Al}catch(c){throw Ot(i),c}else e!==null&&ur(i);if(r){var l=i;if(t&&l.deps===null&&l.teardown===null&&l.nodes_start===null&&l.first===l.last&&(l.f&$s)===0&&(l=l.first),l!==null&&(l.parent=s,s!==null&&Gu(l,s),Ce!==null&&(Ce.f&Tt)!==0&&(n&wr)===0)){var a=Ce;(a.effects??(a.effects=[])).push(l)}}return i}function Xu(){return Ce!==null&&!nn}function vc(n){const e=bn(Co,null,!1);return yt(e,wt),e.teardown=n,e}function so(n){gc();var e=Se.f,t=!Ce&&(e&An)!==0&&(e&Al)===0;if(t){var r=Qe;(r.e??(r.e=[])).push(n)}else return mc(n)}function mc(n){return bn(Ol|Za,n,!1)}function Zu(n){return gc(),bn(Co|Za,n,!0)}function Qu(n){xn.ensure();const e=bn(wr|$s,n,!0);return(t={})=>new Promise(r=>{t.outro?Ar(e,()=>{Ot(e),r(void 0)}):(Ot(e),r(void 0))})}function $u(n){return bn(Ol,n,!1)}function Gs(n,e){var t=Qe,r={effect:null,ran:!1,deps:n};t.l.$.push(r),r.effect=Ai(()=>{n(),!r.ran&&(r.ran=!0,_(e))})}function Mo(){var n=Qe;Ai(()=>{for(var e of n.l.$){e.deps();var t=e.effect;(t.f&wt)!==0&&yt(t,Un),Ui(t)&&gi(t),e.ran=!1}})}function eh(n){return bn(Ul|$s,n,!0)}function Ai(n,e=0){return bn(Co|e,n,!0)}function le(n,e=[],t=[]){zu(e,t,r=>{bn(Co,()=>n(...r.map(o)),!0)})}function xo(n,e=0){var t=bn(_r|e,n,!0);return t}function tn(n,e=!0){return bn(An|$s,n,!0,e)}function pc(n){var e=n.teardown;if(e!==null){const t=br,r=Ce;fa(!0),Et(null);try{e.call(null)}finally{fa(t),Et(r)}}}function _c(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const s=t.ac;s!==null&&To(()=>{s.abort(Or)});var r=t.next;(t.f&wr)!==0?t.parent=null:Ot(t,e),t=r}}function th(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&An)===0&&Ot(e),e=t}}function Ot(n,e=!0){var t=!1;(e||(n.f&nu)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(nh(n.nodes_start,n.nodes_end),t=!0),_c(n,e&&!t),io(n,0),yt(n,yr);var r=n.transitions;if(r!==null)for(const i of r)i.stop();pc(n);var s=n.parent;s!==null&&s.first!==null&&wc(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function nh(n,e){for(;n!==null;){var t=n===e?null:Ri(n);n.remove(),n=t}}function wc(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function Ar(n,e,t=!0){var r=[];jl(n,r,!0),yc(r,()=>{t&&Ot(n),e&&e()})}function yc(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var s of n)s.out(r)}else e()}function jl(n,e,t){if((n.f&sn)===0){if(n.f^=sn,n.transitions!==null)for(const l of n.transitions)(l.is_global||t)&&e.push(l);for(var r=n.first;r!==null;){var s=r.next,i=(r.f&Ii)!==0||(r.f&An)!==0;jl(r,e,i?t:!1),r=s}}}function Pl(n){bc(n,!0)}function bc(n,e){if((n.f&sn)!==0){n.f^=sn,(n.f&wt)===0&&(yt(n,Ft),ur(n));for(var t=n.first;t!==null;){var r=t.next,s=(t.f&Ii)!==0||(t.f&An)!==0;bc(t,s?e:!1),t=r}if(n.transitions!==null)for(const i of n.transitions)(i.is_global||e)&&i.in()}}function Cc(n,e){for(var t=n.nodes_start,r=n.nodes_end;t!==null;){var s=t===r?null:Ri(t);e.append(t),t=s}}let Ur=!1;function ha(n){Ur=n}let br=!1;function fa(n){br=n}let Ce=null,nn=!1;function Et(n){Ce=n}let Se=null;function pn(n){Se=n}let St=null;function kc(n){Ce!==null&&(St===null?St=[n]:St.push(n))}let kt=null,Pt=0,Kt=null;function rh(n){Kt=n}let Sc=1,fi=0,ar=fi;function ga(n){ar=n}let zn=!1;function Dc(){return++Sc}function Ui(n){var h;var e=n.f;if((e&Ft)!==0)return!0;if((e&Un)!==0){var t=n.deps,r=(e&Jt)!==0;if(t!==null){var s,i,l=(e&ro)!==0,a=r&&Se!==null&&!zn,c=t.length;if((l||a)&&(Se===null||(Se.f&yr)===0)){var d=n,u=d.parent;for(s=0;s<c;s++)i=t[s],(l||!((h=i==null?void 0:i.reactions)!=null&&h.includes(d)))&&(i.reactions??(i.reactions=[])).push(d);l&&(d.f^=ro),a&&u!==null&&(u.f&Jt)===0&&(d.f^=Jt)}for(s=0;s<c;s++)if(i=t[s],Ui(i)&&ac(i),i.wv>n.wv)return!0}(!r||Se!==null&&!zn)&&yt(n,wt)}return!1}function Tc(n,e,t=!0){var r=n.reactions;if(r!==null&&!(St!=null&&St.includes(n)))for(var s=0;s<r.length;s++){var i=r[s];(i.f&Tt)!==0?Tc(i,e,!1):e===i&&(t?yt(i,Ft):(i.f&wt)!==0&&yt(i,Un),ur(i))}}function Mc(n){var p;var e=kt,t=Pt,r=Kt,s=Ce,i=zn,l=St,a=Qe,c=nn,d=ar,u=n.f;kt=null,Pt=0,Kt=null,zn=(u&Jt)!==0&&(nn||!Ur||Ce===null),Ce=(u&(An|wr))===0?n:null,St=null,Vs(n.ctx),nn=!1,ar=++fi,n.ac!==null&&(To(()=>{n.ac.abort(Or)}),n.ac=null);try{n.f|=ol;var h=n.fn,v=h(),f=n.deps;if(kt!==null){var g;if(io(n,Pt),f!==null&&Pt>0)for(f.length=Pt+kt.length,g=0;g<kt.length;g++)f[Pt+g]=kt[g];else n.deps=f=kt;if(!zn||(u&Tt)!==0&&n.reactions!==null)for(g=Pt;g<f.length;g++)((p=f[g]).reactions??(p.reactions=[])).push(n)}else f!==null&&Pt<f.length&&(io(n,Pt),f.length=Pt);if(Ei()&&Kt!==null&&!nn&&f!==null&&(n.f&(Tt|Un|Ft))===0)for(g=0;g<Kt.length;g++)Tc(Kt[g],n);return s!==null&&s!==n&&(fi++,Kt!==null&&(r===null?r=Kt:r.push(...Kt))),(n.f&or)!==0&&(n.f^=or),v}catch(w){return nc(w)}finally{n.f^=ol,kt=e,Pt=t,Kt=r,Ce=s,zn=i,St=l,Vs(a),nn=c,ar=d}}function sh(n,e){let t=e.reactions;if(t!==null){var r=Zd.call(t,n);if(r!==-1){var s=t.length-1;s===0?t=e.reactions=null:(t[r]=t[s],t.pop())}}t===null&&(e.f&Tt)!==0&&(kt===null||!kt.includes(e))&&(yt(e,Un),(e.f&(Jt|ro))===0&&(e.f^=ro),lc(e),io(e,0))}function io(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)sh(n,t[r])}function gi(n){var e=n.f;if((e&yr)===0){yt(n,wt);var t=Se,r=Ur;Se=n,Ur=!0;try{(e&_r)!==0?th(n):_c(n),pc(n);var s=Mc(n);n.teardown=typeof s=="function"?s:null,n.wv=Sc;var i;Wa&&Iu&&(n.f&Ft)!==0&&n.deps}finally{Ur=r,Se=t}}}async function ih(){await Promise.resolve(),Au()}function o(n){var e=n.f,t=(e&Tt)!==0;if(Ce!==null&&!nn){var r=Se!==null&&(Se.f&yr)!==0;if(!r&&!(St!=null&&St.includes(n))){var s=Ce.deps;if((Ce.f&ol)!==0)n.rv<fi&&(n.rv=fi,kt===null&&s!==null&&s[Pt]===n?Pt++:kt===null?kt=[n]:(!zn||!kt.includes(n))&&kt.push(n));else{(Ce.deps??(Ce.deps=[])).push(n);var i=n.reactions;i===null?n.reactions=[Ce]:i.includes(Ce)||i.push(Ce)}}}else if(t&&n.deps===null&&n.effects===null){var l=n,a=l.parent;a!==null&&(a.f&Jt)===0&&(l.f^=Jt)}if(br){if(qn.has(n))return qn.get(n);if(t){l=n;var c=l.v;return((l.f&wt)===0&&l.reactions!==null||xc(l))&&(c=Ll(l)),qn.set(l,c),c}}else if(t){if(l=n,ht!=null&&ht.has(l))return ht.get(l);Ui(l)&&ac(l)}if(ht!=null&&ht.has(n))return ht.get(n);if((n.f&or)!==0)throw n.v;return n.v}function xc(n){if(n.v===mt)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(qn.has(e)||(e.f&Tt)!==0&&xc(e))return!0;return!1}function _(n){var e=nn;try{return nn=!0,n()}finally{nn=e}}const oh=-7169;function yt(n,e){n.f=n.f&oh|e}function b(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(lr in n)fl(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&lr in t&&fl(t)}}}function fl(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{fl(n[r],e)}catch{}const t=El(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=Ga(t);for(let s in r){const i=r[s].get;if(i)try{i.call(n)}catch{}}}}}const lh=["touchstart","touchmove"];function ah(n){return lh.includes(n)}const Ic=new Set,gl=new Set;function ch(n,e,t,r={}){function s(i){if(r.capture||ii.call(e,i),!i.cancelBubble)return To(()=>t==null?void 0:t.call(this,i))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Hn(()=>{e.addEventListener(n,s,r)}):e.addEventListener(n,s,r),s}function H(n,e,t,r,s){var i={capture:r,passive:s},l=ch(n,e,t,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&vc(()=>{e.removeEventListener(n,l,i)})}function Cn(n){for(var e=0;e<n.length;e++)Ic.add(n[e]);for(var t of gl)t(n)}let va=null;function ii(n){var U;var e=this,t=e.ownerDocument,r=n.type,s=((U=n.composedPath)==null?void 0:U.call(n))||[],i=s[0]||n.target;va=n;var l=0,a=va===n&&n.__root;if(a){var c=s.indexOf(a);if(c!==-1&&(e===document||e===window)){n.__root=e;return}var d=s.indexOf(e);if(d===-1)return;c<=d&&(l=c)}if(i=s[l]||n.target,i!==e){sl(n,"currentTarget",{configurable:!0,get(){return i||t}});var u=Ce,h=Se;Et(null),pn(null);try{for(var v,f=[];i!==null;){var g=i.assignedSlot||i.parentNode||i.host||null;try{var p=i["__"+r];if(p!=null&&(!i.disabled||n.target===i))if(xl(p)){var[w,...C]=p;w.apply(i,[n,...C])}else p.call(i,n)}catch(N){v?f.push(N):v=N}if(n.cancelBubble||g===e||g===null)break;i=g}if(v){for(let N of f)queueMicrotask(()=>{throw N});throw v}}finally{n.__root=e,delete n.currentTarget,Et(u),pn(h)}}}function Ec(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function oo(n,e){var t=Se;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function B(n,e){var t=(e&ku)!==0,r=(e&Su)!==0,s,i=!n.startsWith("<!>");return()=>{s===void 0&&(s=Ec(i?n:"<!>"+n),t||(s=Ws(s)));var l=r||dc?document.importNode(s,!0):s.cloneNode(!0);if(t){var a=Ws(l),c=l.lastChild;oo(a,c)}else oo(l,l);return l}}function dh(n,e,t="svg"){var r=!n.startsWith("<!>"),s=`<${t}>${r?n:"<!>"+n}</${t}>`,i;return()=>{if(!i){var l=Ec(s),a=Ws(l);i=Ws(a)}var c=i.cloneNode(!0);return oo(c,c),c}}function Cr(n,e){return dh(n,e,"svg")}function ft(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Js();return n.append(e,t),oo(e,t),n}function T(n,e){n!==null&&n.before(e)}function In(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=t,n.nodeValue=t+"")}function uh(n,e){return hh(n,e)}const xr=new Map;function hh(n,{target:e,anchor:t,props:r={},events:s,context:i,intro:l=!0}){Hu();var a=new Set,c=h=>{for(var v=0;v<h.length;v++){var f=h[v];if(!a.has(f)){a.add(f);var g=ah(f);e.addEventListener(f,ii,{passive:g});var p=xr.get(f);p===void 0?(document.addEventListener(f,ii,{passive:g}),xr.set(f,1)):xr.set(f,p+1)}}};c(Il(Ic)),gl.add(c);var d=void 0,u=Qu(()=>{var h=t??e.appendChild(Js());return Pu(h,{pending:()=>{}},v=>{if(i){Xt({});var f=Qe;f.c=i}s&&(r.$$events=s),d=n(v,r)||{},i&&Zt()}),()=>{var g;for(var v of a){e.removeEventListener(v,ii);var f=xr.get(v);--f===0?(document.removeEventListener(v,ii),xr.delete(v)):xr.set(v,f)}gl.delete(c),h!==t&&((g=h.parentNode)==null||g.removeChild(h))}});return fh.set(d,u),d}let fh=new WeakMap;var Tn,hn,en,Mi,xi;class Oc{constructor(e,t=!0){Qn(this,"anchor");x(this,Tn,new Map);x(this,hn,new Map);x(this,en,new Map);x(this,Mi,!0);x(this,xi,()=>{var e=Be;if(m(this,Tn).has(e)){var t=m(this,Tn).get(e),r=m(this,hn).get(t);if(r)Pl(r);else{var s=m(this,en).get(t);s&&(m(this,hn).set(t,s.effect),m(this,en).delete(t),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,l]of m(this,Tn)){if(m(this,Tn).delete(i),i===e)break;const a=m(this,en).get(l);a&&(Ot(a.effect),m(this,en).delete(l))}for(const[i,l]of m(this,hn)){if(i===t)continue;const a=()=>{if(Array.from(m(this,Tn).values()).includes(i)){var d=document.createDocumentFragment();Cc(l,d),d.append(Js()),m(this,en).set(i,{effect:l,fragment:d})}else Ot(l);m(this,hn).delete(i)};m(this,Mi)||!r?Ar(l,a,!1):a()}}});this.anchor=e,D(this,Mi,t)}ensure(e,t){var r=Be,s=fc();if(t&&!m(this,hn).has(e)&&!m(this,en).has(e))if(s){var i=document.createDocumentFragment(),l=Js();i.append(l),m(this,en).set(e,{effect:tn(()=>t(l)),fragment:i})}else m(this,hn).set(e,tn(()=>t(this.anchor)));if(m(this,Tn).set(r,e),s){for(const[a,c]of m(this,hn))a===e?r.skipped_effects.delete(c):r.skipped_effects.add(c);for(const[a,c]of m(this,en))a===e?r.skipped_effects.delete(c.effect):r.skipped_effects.add(c.effect);r.add_callback(m(this,xi))}else m(this,xi).call(this)}}Tn=new WeakMap,hn=new WeakMap,en=new WeakMap,Mi=new WeakMap,xi=new WeakMap;function Z(n,e,t=!1){var r=new Oc(n),s=t?Ii:0;function i(l,a){r.ensure(l,a)}xo(()=>{var l=!1;e((a,c=!0)=>{l=!0,i(c,a)}),l||i(!1,null)},s)}let Zi=null;function Io(n,e){return e}function gh(n,e,t){for(var r=n.items,s=[],i=e.length,l=0;l<i;l++)jl(e[l].e,s,!0);var a=i>0&&s.length===0&&t!==null;if(a){var c=t.parentNode;Yu(c),c.append(t),r.clear(),an(n,e[0].prev,e[i-1].next)}yc(s,()=>{for(var d=0;d<i;d++){var u=e[d];a||(r.delete(u.k),an(n,u.prev,u.next)),Ot(u.e,!a)}})}function gn(n,e,t,r,s,i=null){var l=n,a={flags:e,items:new Map,first:null},c=(e&Qa)!==0;if(c){var d=n;l=d.appendChild(Js())}var u=null,h=!1,v=new Map,f=He(()=>{var C=t();return xl(C)?C:C==null?[]:Il(C)}),g,p;function w(){vh(p,g,a,v,l,s,e,r,t),i!==null&&(g.length===0?u?Pl(u):u=tn(()=>i(l)):u!==null&&Ar(u,()=>{u=null}))}xo(()=>{p??(p=Se),g=o(f);var C=g.length;if(!(h&&C===0)){h=C===0;var U,N,q,K;if(fc()){var F=new Set,te=Be;for(N=0;N<C;N+=1){q=g[N],K=r(q,N);var J=a.items.get(K)??v.get(K);J?(e&(ko|So))!==0&&Rc(J,q,N,e):(U=Ac(null,a,null,null,q,K,N,s,e,t,!0),v.set(K,U)),F.add(K)}for(const[V,G]of a.items)F.has(V)||te.skipped_effects.add(G.e);te.add_callback(w)}else w();o(f)}})}function vh(n,e,t,r,s,i,l,a,c){var pe,Ae,Q,y;var d=(l&mu)!==0,u=(l&(ko|So))!==0,h=e.length,v=t.items,f=t.first,g=f,p,w=null,C,U=[],N=[],q,K,F,te;if(d)for(te=0;te<h;te+=1)q=e[te],K=a(q,te),F=v.get(K),F!==void 0&&((pe=F.a)==null||pe.measure(),(C??(C=new Set)).add(F));for(te=0;te<h;te+=1){if(q=e[te],K=a(q,te),F=v.get(K),F===void 0){var J=r.get(K);if(J!==void 0){r.delete(K),v.set(K,J);var V=w?w.next:g;an(t,w,J),an(t,J,V),qo(J,V,s),w=J}else{var G=g?g.e.nodes_start:s;w=Ac(G,t,w,w===null?t.first:w.next,q,K,te,i,l,c)}v.set(K,w),U=[],N=[],g=w.next;continue}if(u&&Rc(F,q,te,l),(F.e.f&sn)!==0&&(Pl(F.e),d&&((Ae=F.a)==null||Ae.unfix(),(C??(C=new Set)).delete(F))),F!==g){if(p!==void 0&&p.has(F)){if(U.length<N.length){var Te=N[0],Ne;w=Te.prev;var Fe=U[0],M=U[U.length-1];for(Ne=0;Ne<U.length;Ne+=1)qo(U[Ne],Te,s);for(Ne=0;Ne<N.length;Ne+=1)p.delete(N[Ne]);an(t,Fe.prev,M.next),an(t,w,Fe),an(t,M,Te),g=Te,w=M,te-=1,U=[],N=[]}else p.delete(F),qo(F,g,s),an(t,F.prev,F.next),an(t,F,w===null?t.first:w.next),an(t,w,F),w=F;continue}for(U=[],N=[];g!==null&&g.k!==K;)(g.e.f&sn)===0&&(p??(p=new Set)).add(g),N.push(g),g=g.next;if(g===null)continue;F=g}U.push(F),w=F,g=F.next}if(g!==null||p!==void 0){for(var W=p===void 0?[]:Il(p);g!==null;)(g.e.f&sn)===0&&W.push(g),g=g.next;var ne=W.length;if(ne>0){var Me=(l&Qa)!==0&&h===0?s:null;if(d){for(te=0;te<ne;te+=1)(Q=W[te].a)==null||Q.measure();for(te=0;te<ne;te+=1)(y=W[te].a)==null||y.fix()}gh(t,W,Me)}}d&&Hn(()=>{var A;if(C!==void 0)for(F of C)(A=F.a)==null||A.apply()}),n.first=t.first&&t.first.e,n.last=w&&w.e;for(var ce of r.values())Ot(ce.e);r.clear()}function Rc(n,e,t,r){(r&ko)!==0&&Ys(n.v,e),(r&So)!==0?Ys(n.i,t):n.i=t}function Ac(n,e,t,r,s,i,l,a,c,d,u){var h=Zi,v=(c&ko)!==0,f=(c&pu)===0,g=v?f?vn(s,!1,!1):hr(s):s,p=(c&So)===0?l:hr(l),w={i:p,v:g,k:i,a:null,e:null,prev:t,next:r};Zi=w;try{if(n===null){var C=document.createDocumentFragment();C.append(n=Js())}return w.e=tn(()=>a(n,g,p,d),Mu),w.e.prev=t&&t.e,w.e.next=r&&r.e,t===null?u||(e.first=w):(t.next=w,t.e.next=w.e),r!==null&&(r.prev=w,r.e.prev=w.e),w}finally{Zi=h}}function qo(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,i=n.e.nodes_start;i!==null&&i!==r;){var l=Ri(i);s.before(i),i=l}}function an(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function mh(n,e,...t){var r=new Oc(n);xo(()=>{const s=e()??null;r.ensure(s,s&&(i=>s(i,...t)))},Ii)}const ma=[...` 	
\r\f \v\uFEFF`];function ph(n,e,t){var r=n==null?"":""+n;if(e&&(r=r?r+" "+e:e),t){for(var s in t)if(t[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,l=0;(l=r.indexOf(s,l))>=0;){var a=l+i;(l===0||ma.includes(r[l-1]))&&(a===r.length||ma.includes(r[a]))?r=(l===0?"":r.substring(0,l))+r.substring(a+1):l=a}}return r===""?null:r}function _h(n,e){return n==null?null:String(n)}function Rt(n,e,t,r,s,i){var l=n.__className;if(l!==t||l===void 0){var a=ph(t,r,i);a==null?n.removeAttribute("class"):e?n.className=a:n.setAttribute("class",a),n.__className=t}else if(i&&s!==i)for(var c in i){var d=!!i[c];(s==null||d!==!!s[c])&&n.classList.toggle(c,d)}return i}function ze(n,e,t,r){var s=n.__style;if(s!==e){var i=_h(e);i==null?n.removeAttribute("style"):n.style.cssText=i,n.__style=e}return r}const wh=Symbol("is custom element"),yh=Symbol("is html");function rn(n,e){var t=Uc(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function Ye(n,e,t,r){var s=Uc(n);s[e]!==(s[e]=t)&&(e==="loading"&&(n[su]=t),t==null?n.removeAttribute(e):typeof t!="string"&&bh(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Uc(n){return n.__attributes??(n.__attributes={[wh]:n.nodeName.includes("-"),[yh]:n.namespaceURI===Du})}var pa=new Map;function bh(n){var e=n.getAttribute("is")||n.nodeName,t=pa.get(e);if(t)return t;pa.set(e,t=[]);for(var r,s=n,i=Element.prototype;i!==s;){r=Ga(s);for(var l in r)r[l].set&&t.push(l);s=El(s)}return t}const Ch=()=>performance.now(),Mn={tick:n=>requestAnimationFrame(n),now:()=>Ch(),tasks:new Set};function Lc(){const n=Mn.now();Mn.tasks.forEach(e=>{e.c(n)||(Mn.tasks.delete(e),e.f())}),Mn.tasks.size!==0&&Mn.tick(Lc)}function kh(n){let e;return Mn.tasks.size===0&&Mn.tick(Lc),{promise:new Promise(t=>{Mn.tasks.add(e={c:n,f:t})}),abort(){Mn.tasks.delete(e)}}}function Sh(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const e=n.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function _a(n){const e={},t=n.split(";");for(const r of t){const[s,i]=r.split(":");if(!s||i===void 0)break;const l=Sh(s.trim());e[l]=i.trim()}return e}const Dh=n=>n;function vl(n,e,t){var r=Zi,s,i,l,a=null;r.a??(r.a={element:n,measure(){s=this.element.getBoundingClientRect()},apply(){if(l==null||l.abort(),i=this.element.getBoundingClientRect(),s.left!==i.left||s.right!==i.right||s.top!==i.top||s.bottom!==i.bottom){const c=e()(this.element,{from:s,to:i},t==null?void 0:t());l=jc(this.element,c,void 0,1,()=>{l==null||l.abort(),l=void 0})}},fix(){if(!n.getAnimations().length){var{position:c,width:d,height:u}=getComputedStyle(n);if(c!=="absolute"&&c!=="fixed"){var h=n.style;a={position:h.position,width:h.width,height:h.height,transform:h.transform},h.position="absolute",h.width=d,h.height=u;var v=n.getBoundingClientRect();if(s.left!==v.left||s.top!==v.top){var f=`translate(${s.left-v.left}px, ${s.top-v.top}px)`;h.transform=h.transform?`${h.transform} ${f}`:f}}}},unfix(){if(a){var c=n.style;c.position=a.position,c.width=a.width,c.height=a.height,c.transform=a.transform}}}),r.a.element=n}function jc(n,e,t,r,s){if(eu(e)){var i,l=!1;return Hn(()=>{if(!l){var p=e({direction:"in"});i=jc(n,p,t,r,s)}}),{abort:()=>{l=!0,i==null||i.abort()},deactivate:()=>i.deactivate(),reset:()=>i.reset(),t:()=>i.t()}}if(!(e!=null&&e.duration))return s(),{abort:si,deactivate:si,reset:si,t:()=>r};const{delay:a=0,css:c,tick:d,easing:u=Dh}=e;var h=[];if(d&&d(0,1),c){var v=_a(c(0,1));h.push(v,v)}var f=()=>1-r,g=n.animate(h,{duration:a,fill:"forwards"});return g.onfinish=()=>{g.cancel();var p=1-r,w=r-p,C=e.duration*Math.abs(w),U=[];if(C>0){var N=!1;if(c)for(var q=Math.ceil(C/16.666666666666668),K=0;K<=q;K+=1){var F=p+w*u(K/q),te=_a(c(F,1-F));U.push(te),N||(N=te.overflow==="hidden")}N&&(n.style.overflow="hidden"),f=()=>{var J=g.currentTime;return p+w*u(J/C)},d&&kh(()=>{if(g.playState!=="running")return!1;var J=f();return d(J,1-J),!0})}g=n.animate(U,{duration:C,fill:"forwards"}),g.onfinish=()=>{f=()=>r,d==null||d(r,1-r),s()}},{abort:()=>{g&&(g.cancel(),g.effect=null,g.onfinish=si)},deactivate:()=>{s=si},reset:()=>{},t:()=>f()}}function lo(n,e,t=e){var r=new WeakSet;Wu(n,"input",async s=>{var i=s?n.defaultValue:n.value;if(i=Vo(n)?Ho(i):i,t(i),Be!==null&&r.add(Be),await ih(),i!==(i=e())){var l=n.selectionStart,a=n.selectionEnd,c=n.value.length;if(n.value=i??"",a!==null){var d=n.value.length;l===a&&a===c&&d>c?(n.selectionStart=d,n.selectionEnd=d):(n.selectionStart=l,n.selectionEnd=Math.min(a,d))}}}),_(e)==null&&n.value&&(t(Vo(n)?Ho(n.value):n.value),Be!==null&&r.add(Be)),Ai(()=>{var s=e();if(n===document.activeElement){var i=Ji??Be;if(r.has(i))return}Vo(n)&&s===Ho(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function Vo(n){var e=n.type;return e==="number"||e==="range"}function Ho(n){return n===""?null:+n}function wa(n,e){return n===e||(n==null?void 0:n[lr])===e}function vi(n={},e,t,r){return $u(()=>{var s,i;return Ai(()=>{s=i,i=[],_(()=>{n!==t(...i)&&(e(n,...i),s&&wa(t(...s),n)&&e(null,...s))})}),()=>{Hn(()=>{i&&wa(t(...i),n)&&e(null,...i)})}}),n}function Eo(n=!1){const e=Qe,t=e.l.u;if(!t)return;let r=()=>b(e.s);if(n){let s=0,i={};const l=Oi(()=>{let a=!1;const c=e.s;for(const d in c)c[d]!==i[d]&&(i[d]=c[d],a=!0);return a&&s++,s});r=()=>o(l)}t.b.length&&Zu(()=>{ya(e,r),il(t.b)}),so(()=>{const s=_(()=>t.m.map(tu));return()=>{for(const i of s)typeof i=="function"&&i()}}),t.a.length&&so(()=>{ya(e,r),il(t.a)})}function ya(n,e){if(n.l.s)for(const t of n.l.s)o(t);e()}let qi=!1;function Th(n){var e=qi;try{return qi=!1,[n(),qi]}finally{qi=e}}function k(n,e,t,r){var N;var s=!ei||(t&wu)!==0,i=(t&bu)!==0,l=(t&Cu)!==0,a=r,c=!0,d=()=>(c&&(c=!1,a=l?_(r):r),a),u;if(i){var h=lr in n||ru in n;u=((N=Rr(n,e))==null?void 0:N.set)??(h&&e in n?q=>n[e]=q:void 0)}var v,f=!1;i?[v,f]=Th(()=>n[e]):v=n[e],v===void 0&&r!==void 0&&(v=d(),u&&(s&&uu(),u(v)));var g;if(s?g=()=>{var q=n[e];return q===void 0?d():(c=!0,q)}:g=()=>{var q=n[e];return q!==void 0&&(a=void 0),q===void 0?a:q},s&&(t&yu)===0)return g;if(u){var p=n.$$legacy;return(function(q,K){return arguments.length>0?((!s||!K||p||f)&&u(K?g():q),q):g()})}var w=!1,C=((t&_u)!==0?Oi:He)(()=>(w=!1,g()));i&&o(C);var U=Se;return(function(q,K){if(arguments.length>0){const F=K?o(C):s&&i?st(q):q;return S(C,F),w=!0,a!==void 0&&(a=F),q}return br&&w||(U.f&yr)!==0?C.v:o(C)})}function Mh(n){Qe===null&&iu(),ei&&Qe.l!==null?xh(Qe).m.push(n):so(()=>{const e=_(n);if(typeof e=="function")return e})}function xh(n){var e=n.l;return e.u??(e.u={a:[],b:[],m:[]})}const Ih="5";var Ja;typeof window<"u"&&((Ja=window.__svelte??(window.__svelte={})).v??(Ja.v=new Set)).add(Ih);Eu();class ba{constructor(){this.name="vertical"}getTimeline(e,t){return e}getLanes(e,t){return t}cellKey(e,t){return`${e}:${t}`}parseCellKey(e){const[t,r]=e.split(":");return{timeId:t,laneId:r}}calculateInsertBefore(e,t){const r=e.top+e.height/2;return t.y<r}getDragAxis(){return"y"}shiftCellsForwardInTime(e,t,r,s,i){const l=i??t.length;for(let a=s;a<l-1;a++){const c=this.cellKey(t[a],r),d=this.cellKey(t[a+1],r),u=e.get(d);u?(e.delete(d),e.set(c,u)):e.delete(c)}}shiftCellsBackwardInTime(e,t,r,s){for(let i=t.length-1;i>s;i--){const l=this.cellKey(t[i-1],r),a=this.cellKey(t[i],r),c=e.get(l);c&&i<t.length&&(e.delete(l),e.set(a,c))}}getContainerFlexDirection(){return"row"}getLaneFlexDirection(){return"column"}getFrozenLaneStyle(){return{position:"sticky",top:"0",width:"100%"}}}class Eh{constructor(){this.name="horizontal"}getTimeline(e,t){return e}getLanes(e,t){return t}cellKey(e,t){return`${e}:${t}`}parseCellKey(e){const[t,r]=e.split(":");return{timeId:t,laneId:r}}calculateInsertBefore(e,t){const r=e.left+e.width/2;return t.x<r}getDragAxis(){return"x"}shiftCellsForwardInTime(e,t,r,s,i){const l=i??t.length;for(let a=s;a<l-1;a++){const c=this.cellKey(t[a],r),d=this.cellKey(t[a+1],r),u=e.get(d);u?(e.delete(d),e.set(c,u)):e.delete(c)}}shiftCellsBackwardInTime(e,t,r,s){for(let i=t.length-1;i>s;i--){const l=this.cellKey(t[i-1],r),a=this.cellKey(t[i],r),c=e.get(l);c&&i<t.length&&(e.delete(l),e.set(a,c))}}getContainerFlexDirection(){return"column"}getLaneFlexDirection(){return"row"}getFrozenLaneStyle(){return{position:"sticky",left:"0",height:"100%"}}}class Oh{constructor(){this.type="yjsServer",this.sheetId="",this.connected=!1}async initialize(e,t){return this.sheetId=e,this.connected=!0,{timeline:[],lanes:[],cells:new Map,cardsMetadata:new Map,laneTitles:new Map}}async disconnect(){this.connected=!1}async saveSheet(e){}async saveCell(e,t){}async saveCardMetadata(e,t){}async saveLaneOrder(e){}async saveTimelineOrder(e){}getLabel(){return`Yjs Server: ${this.sheetId}`}getInfo(){return{type:"yjsServer",sheetId:this.sheetId,connected:this.connected,persistence:"automatic (Yjs server)",notes:"All changes auto-persisted by Yjs server"}}supports(e){switch(e){case"realtime":return!0;case"batch":return!1;case"versioning":return!1;case"search":return!1;default:return!1}}}const ao=[{label:"160 × 90",width:160,height:90},{label:"192 × 108",width:192,height:108},{label:"224 × 126",width:224,height:126},{label:"256 × 144",width:256,height:144},{label:"288 × 162",width:288,height:162},{label:"320 × 180",width:320,height:180},{label:"384 × 216",width:384,height:216},{label:"448 × 252",width:448,height:252}];var Kr,qr,Vr,Hr,Yr,Jr,Wr,Gr,Xr,Zr,Qr,$r,es,ts,ns,rs,ss,is,os,ls,as,cs,ds,us,hs,fs,gs,vs,ms,ps,_s,ws,ys,bs,Cs,ks,Ss,Ds,Ts,Ms,xs,Is,Es,Os,Rs,As,Us,Ls,js,Ps,Ns,Fs,Bs,zs,Ks,qs;class Rh{constructor(){x(this,Kr);x(this,qr);x(this,Vr);x(this,Hr);x(this,Yr);x(this,Jr);x(this,Wr);x(this,Gr);x(this,Xr);x(this,Zr);x(this,Qr);x(this,$r);x(this,es);x(this,ts);x(this,ns);x(this,rs);x(this,ss);x(this,is);x(this,os);x(this,ls);x(this,as);x(this,cs);x(this,ds);x(this,us);x(this,hs);x(this,fs);x(this,gs);x(this,vs);x(this,ms);x(this,ps);x(this,_s);x(this,ws);x(this,ys);x(this,bs);x(this,Cs);x(this,ks);x(this,Ss);x(this,Ds);x(this,Ts);x(this,Ms);x(this,xs);x(this,Is);x(this,Es);x(this,Os);x(this,Rs);x(this,As);x(this,Us);x(this,Ls);x(this,js);x(this,Ps);x(this,Ns);x(this,Fs);x(this,Bs);x(this,zs);x(this,Ks);x(this,qs);D(this,Kr,P(st(new ba))),D(this,qr,P(st(new Oh))),D(this,Vr,P(null)),D(this,Hr,P(st([]))),D(this,Yr,P(st([]))),D(this,Jr,P(st(new Map))),D(this,Wr,P(st(new Map))),D(this,Gr,P(st(new Map))),this.userId=`user-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,D(this,Xr,P("")),D(this,Zr,P("")),D(this,Qr,P("test-sheet-1")),D(this,$r,P(!0)),D(this,es,P(3)),D(this,ts,P(!0)),D(this,ns,P(!1)),D(this,rs,P(!1)),D(this,ss,P(null)),D(this,is,P(null)),D(this,os,P(null)),D(this,ls,P(!1)),this.dragMousePos={x:0,y:0},this.draggedColumn=null,this.columnDragPreview=null,this.isColumnDragging=!1,D(this,as,P(null)),D(this,cs,P(null)),D(this,ds,P(null)),D(this,us,P(!1)),D(this,hs,P(null)),D(this,fs,P(null)),D(this,gs,P("")),D(this,vs,P(null)),D(this,ms,P(null)),D(this,ps,P("")),D(this,_s,P("#CCCCCC")),D(this,ws,P(null)),D(this,ys,P(null)),D(this,bs,P(null)),D(this,Cs,P(st([]))),D(this,ks,P(null)),D(this,Ss,P(!1)),D(this,Ds,P("white")),D(this,Ts,P(st([]))),this.drawingHistory=new Map,this.drawingRedoStack=new Map,D(this,Ms,P(!1)),D(this,xs,P("")),this.confirmCallback=null,D(this,Is,P(null)),D(this,Es,P(st({x:0,y:0}))),D(this,Os,P(!1)),D(this,Rs,P("")),D(this,As,P(void 0)),D(this,Us,P(void 0)),D(this,Ls,P(void 0)),this.toastTimeout=null,D(this,js,P(st([]))),D(this,Ps,P(st([]))),D(this,Ns,Mr(()=>this.orientation.getTimeline(this.rows,this.cols))),D(this,Fs,Mr(()=>this.orientation.getLanes(this.rows,this.cols))),D(this,Bs,Mr(()=>this.lanes.length>0?this.lanes[0]:null)),D(this,zs,Mr(()=>[...this.cols,`phantom-col-${this.cols.length}`])),D(this,Ks,Mr(()=>[...this.rows,`phantom-row-${this.rows.length}`])),D(this,qs,Mr(()=>ao[this.selectedThumbnailSize]))}get orientation(){return o(m(this,Kr))}set orientation(e){S(m(this,Kr),e,!0)}get dataSource(){return o(m(this,qr))}set dataSource(e){S(m(this,qr),e,!0)}get sheet(){return o(m(this,Vr))}set sheet(e){S(m(this,Vr),e,!0)}get rows(){return o(m(this,Hr))}set rows(e){S(m(this,Hr),e,!0)}get cols(){return o(m(this,Yr))}set cols(e){S(m(this,Yr),e,!0)}get cellsMap(){return o(m(this,Jr))}set cellsMap(e){S(m(this,Jr),e,!0)}get cardsMetadata(){return o(m(this,Wr))}set cardsMetadata(e){S(m(this,Wr),e,!0)}get shotTitles(){return o(m(this,Gr))}set shotTitles(e){S(m(this,Gr),e,!0)}get wsUrl(){return o(m(this,Xr))}set wsUrl(e){S(m(this,Xr),e,!0)}get apiUrl(){return o(m(this,Zr))}set apiUrl(e){S(m(this,Zr),e,!0)}get sheetId(){return o(m(this,Qr))}set sheetId(e){S(m(this,Qr),e,!0)}get loading(){return o(m(this,$r))}set loading(e){S(m(this,$r),e,!0)}get selectedThumbnailSize(){return o(m(this,es))}set selectedThumbnailSize(e){S(m(this,es),e,!0)}get stickyTopRow(){return o(m(this,ts))}set stickyTopRow(e){S(m(this,ts),e,!0)}get isSoundMuted(){return o(m(this,ns))}set isSoundMuted(e){S(m(this,ns),e,!0)}get showThumbnailMenu(){return o(m(this,rs))}set showThumbnailMenu(e){S(m(this,rs),e,!0)}get openEllipsisMenu(){return o(m(this,ss))}set openEllipsisMenu(e){S(m(this,ss),e,!0)}get draggedCard(){return o(m(this,is))}set draggedCard(e){S(m(this,is),e,!0)}get dragPreview(){return o(m(this,os))}set dragPreview(e){S(m(this,os),e,!0)}get isDragging(){return o(m(this,ls))}set isDragging(e){S(m(this,ls),e,!0)}get openColumnMenu(){return o(m(this,as))}set openColumnMenu(e){S(m(this,as),e,!0)}get frozenRowRef(){return o(m(this,cs))}set frozenRowRef(e){S(m(this,cs),e,!0)}get columnsContainerRef(){return o(m(this,ds))}set columnsContainerRef(e){S(m(this,ds),e,!0)}get showModal(){return o(m(this,us))}set showModal(e){S(m(this,us),e,!0)}get modalCardId(){return o(m(this,hs))}set modalCardId(e){S(m(this,hs),e,!0)}get modalMediaId(){return o(m(this,fs))}set modalMediaId(e){S(m(this,fs),e,!0)}get modalPrompt(){return o(m(this,gs))}set modalPrompt(e){S(m(this,gs),e,!0)}get promptTextRef(){return o(m(this,vs))}set promptTextRef(e){S(m(this,vs),e,!0)}get promptYText(){return o(m(this,ms))}set promptYText(e){S(m(this,ms),e,!0)}get modalTitle(){return o(m(this,ps))}set modalTitle(e){S(m(this,ps),e,!0)}get modalColor(){return o(m(this,_s))}set modalColor(e){S(m(this,_s),e,!0)}get modalMediaUrl(){return o(m(this,ws))}set modalMediaUrl(e){S(m(this,ws),e,!0)}get modalMediaType(){return o(m(this,ys))}set modalMediaType(e){S(m(this,ys),e,!0)}get modalThumbUrl(){return o(m(this,bs))}set modalThumbUrl(e){S(m(this,bs),e,!0)}get attachments(){return o(m(this,Cs))}set attachments(e){S(m(this,Cs),e,!0)}get canvasRef(){return o(m(this,ks))}set canvasRef(e){S(m(this,ks),e,!0)}get isDrawing(){return o(m(this,Ss))}set isDrawing(e){S(m(this,Ss),e,!0)}get currentColor(){return o(m(this,Ds))}set currentColor(e){S(m(this,Ds),e,!0)}get drawingStrokes(){return o(m(this,Ts))}set drawingStrokes(e){S(m(this,Ts),e,!0)}get showConfirmDialog(){return o(m(this,Ms))}set showConfirmDialog(e){S(m(this,Ms),e,!0)}get confirmMessage(){return o(m(this,xs))}set confirmMessage(e){S(m(this,xs),e,!0)}get openCardMenu(){return o(m(this,Is))}set openCardMenu(e){S(m(this,Is),e,!0)}get cardMenuPosition(){return o(m(this,Es))}set cardMenuPosition(e){S(m(this,Es),e,!0)}get showToast(){return o(m(this,Os))}set showToast(e){S(m(this,Os),e,!0)}get toastMessage(){return o(m(this,Rs))}set toastMessage(e){S(m(this,Rs),e,!0)}get toastProgress(){return o(m(this,As))}set toastProgress(e){S(m(this,As),e,!0)}get toastCurrent(){return o(m(this,Us))}set toastCurrent(e){S(m(this,Us),e,!0)}get toastTotal(){return o(m(this,Ls))}set toastTotal(e){S(m(this,Ls),e,!0)}get undoStack(){return o(m(this,js))}set undoStack(e){S(m(this,js),e,!0)}get redoStack(){return o(m(this,Ps))}set redoStack(e){S(m(this,Ps),e,!0)}get timeline(){return o(m(this,Ns))}set timeline(e){S(m(this,Ns),e)}get lanes(){return o(m(this,Fs))}set lanes(e){S(m(this,Fs),e)}get fixedLane(){return o(m(this,Bs))}set fixedLane(e){S(m(this,Bs),e)}get displayCols(){return o(m(this,zs))}set displayCols(e){S(m(this,zs),e)}get displayRows(){return o(m(this,Ks))}set displayRows(e){S(m(this,Ks),e)}get thumbnailSize(){return o(m(this,qs))}set thumbnailSize(e){S(m(this,qs),e)}cellKey(e,t){return this.orientation.cellKey(e,t)}parseCellKey(e){return this.orientation.parseCellKey(e)}setOrientation(e){e==="vertical"?this.orientation=new ba:this.orientation=new Eh,typeof localStorage<"u"&&localStorage.setItem("orientation",e)}loadPreferences(){if(typeof localStorage>"u")return;const e=localStorage.getItem("thumbnailSize");if(e){const s=parseInt(e,10);s>=0&&s<ao.length&&(this.selectedThumbnailSize=s)}localStorage.getItem("isSoundMuted")==="true"&&(this.isSoundMuted=!0),localStorage.getItem("stickyTopRow")==="false"&&(this.stickyTopRow=!1),localStorage.getItem("orientation")}savePreference(e,t){typeof localStorage>"u"||localStorage.setItem(e,String(t))}getCardsInLane(e){const t=[];for(const r of this.timeline){const s=this.cellKey(r,e),i=this.cellsMap.get(s);if(i!=null&&i.cardId){const l=this.cardsMetadata.get(i.cardId);l&&t.push({timeId:r,cardId:i.cardId,card:l})}}return t}getCardsInTime(e){const t=[];for(const r of this.lanes){const s=this.cellKey(e,r),i=this.cellsMap.get(s);if(i!=null&&i.cardId){const l=this.cardsMetadata.get(i.cardId);l&&t.push({laneId:r,cardId:i.cardId,card:l})}}return t}}Kr=new WeakMap,qr=new WeakMap,Vr=new WeakMap,Hr=new WeakMap,Yr=new WeakMap,Jr=new WeakMap,Wr=new WeakMap,Gr=new WeakMap,Xr=new WeakMap,Zr=new WeakMap,Qr=new WeakMap,$r=new WeakMap,es=new WeakMap,ts=new WeakMap,ns=new WeakMap,rs=new WeakMap,ss=new WeakMap,is=new WeakMap,os=new WeakMap,ls=new WeakMap,as=new WeakMap,cs=new WeakMap,ds=new WeakMap,us=new WeakMap,hs=new WeakMap,fs=new WeakMap,gs=new WeakMap,vs=new WeakMap,ms=new WeakMap,ps=new WeakMap,_s=new WeakMap,ws=new WeakMap,ys=new WeakMap,bs=new WeakMap,Cs=new WeakMap,ks=new WeakMap,Ss=new WeakMap,Ds=new WeakMap,Ts=new WeakMap,Ms=new WeakMap,xs=new WeakMap,Is=new WeakMap,Es=new WeakMap,Os=new WeakMap,Rs=new WeakMap,As=new WeakMap,Us=new WeakMap,Ls=new WeakMap,js=new WeakMap,Ps=new WeakMap,Ns=new WeakMap,Fs=new WeakMap,Bs=new WeakMap,zs=new WeakMap,Ks=new WeakMap,qs=new WeakMap;class Ah{constructor(e,t,r,s,i,l){this.lastDragOverTime=0,this.autoScrollInterval=null,this.strategy=e,this.state=t,this.callbacks=r,this.userId=s,this.getSheet=i,this.getTimeline=l}handleDragStart(e,t,r,s){const i=this.getTimeline();if(i.length>0&&t===i[0]){e.preventDefault();return}if(this.state.draggedCard={timeId:t,laneId:r,cardId:s},this.state.isDragging=!0,e.dataTransfer){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",s);const l=e.target;if(l){const a=l.getBoundingClientRect(),c=a.width/2,d=a.height/2;e.dataTransfer.setDragImage(l,c,d)}}console.log("[DragOperations.handleDragStart] Started dragging:",s)}handleDragOver(e,t,r,s){e.preventDefault();const i=Date.now();if(i-this.lastDragOverTime<16||(this.lastDragOverTime=i,!this.state.draggedCard||!this.state.isDragging))return;const l=this.getTimeline(),a=s.getBoundingClientRect(),c=e.clientY,d=a.top+a.height/2,u=c<d;if(l.length>0&&t===l[0]&&u){this.state.dragPreview=null,console.log("[DragOperations.handleDragOver] Skipped - cannot insert before frozen header row");return}if(this.state.draggedCard.timeId===t&&this.state.draggedCard.laneId===r){this.state.dragPreview=null;return}if(this.state.draggedCard.laneId===r){const v=l.indexOf(this.state.draggedCard.timeId),f=l.indexOf(t),g=u?f:f+1;if(g===v||g===v+1){this.state.dragPreview=null;return}}this.state.dragMousePos={x:e.clientX,y:e.clientY},this.handleAutoScroll(e.clientY);const h=this.state.dragPreview;(!h||h.targetLane!==r||h.targetTime!==t||h.insertBefore!==u)&&(this.state.dragPreview={targetLane:r,targetTime:t,insertBefore:u}),e.dataTransfer&&(e.dataTransfer.dropEffect="move")}handleDragEnd(e){console.log("[DragOperations.handleDragEnd] Drag ended"),this.state.isDragging=!1,this.state.dragPreview=null,this.state.draggedCard=null,this.stopAutoScroll()}handleAutoScroll(e){const s=window.innerHeight,i=e,l=s-e;let a=null;i<100?a="up":l<100&&(a="down"),a?this.autoScrollInterval||this.startAutoScroll(a,10):this.stopAutoScroll()}startAutoScroll(e,t){this.stopAutoScroll(),this.autoScrollInterval=window.setInterval(()=>{const r=e==="up"?-t:t;window.scrollBy(0,r)},16)}stopAutoScroll(){this.autoScrollInterval&&(clearInterval(this.autoScrollInterval),this.autoScrollInterval=null)}handleDrop(e,t,r){e.preventDefault();const s=this.getSheet();if(!s||!this.state.draggedCard){console.log("[DragOperations.handleDrop] Missing required data:",{hasSheet:!!s,hasDraggedCard:!!this.state.draggedCard}),this.state.isDragging=!1,this.state.dragPreview=null,this.state.draggedCard=null;return}const{timeId:i,laneId:l,cardId:a}=this.state.draggedCard;if(!this.state.dragPreview){console.warn("[DragOperations.handleDrop] No dragPreview! Using drop event target"),this.state.isDragging=!1,this.state.draggedCard=null;return}const c=this.state.dragPreview.targetTime,d=this.state.dragPreview.targetLane,u=this.state.dragPreview.insertBefore;if(console.log("=== DROP POSITION ANALYSIS ==="),console.log("[PLACEHOLDER] Where placeholder was shown:",{targetTime:c,targetLane:d,insertBefore:u?"BEFORE":"AFTER"}),console.log("[SOURCE] Dragging from:",{fromTime:i,fromLane:l,cardId:a}),d.startsWith("phantom-col-")){const h=`c-${Date.now().toString(36)}-${Math.random().toString(36).substring(2,9)}`;s.colOrder.push([h]),d=h,console.log("[DragOperations.handleDrop] Created new column:",h);const v=this.getTimeline();if(v.length>0){const f=v[0],g=`card-${Date.now()}-header-${Math.random().toString(36).substring(2,9)}`,p=this.strategy.cellKey(f,h);s.cells.set(p,{cardId:g});const w={cardId:g,title:"New Lane",color:"#CCCCCC",prompt:"",createdAt:new Date().toISOString()},C=new Y.Map;for(const[U,N]of Object.entries(w))C.set(U,N);s.cardsMetadata.set(g,C),console.log("[DragOperations.handleDrop] Created header card for new lane:",g)}}if(c.startsWith("phantom-row-")){const h=`r-${Date.now().toString(36)}-${Math.random().toString(36).substring(2,9)}`;s.rowOrder.push([h]),c=h,console.log("[DragOperations.handleDrop] Created new row:",h)}s.doc.transact(()=>{const h=this.strategy.cellKey(i,l),v=s.cells.get(h);if(!v){console.log("[DragOperations.handleDrop] Card not found at source");return}s.cells.delete(h),console.log("[DragOperations.handleDrop] Removed from:",h);const f=this.getTimeline(),g=f.indexOf(i),p=f.indexOf(c);if(l===d)for(let J=g+1;J<f.length;J++){const V=this.strategy.cellKey(f[J],l),G=this.strategy.cellKey(f[J-1],l),Te=s.cells.get(V);Te&&(s.cells.delete(V),s.cells.set(G,Te))}else for(let J=g+1;J<f.length;J++){const V=this.strategy.cellKey(f[J],l),G=this.strategy.cellKey(f[J-1],l),Te=s.cells.get(V);Te&&(s.cells.delete(V),s.cells.set(G,Te))}const w=u?p:p+1;console.log("[CALCULATION] Insert position:",{targetTimeIndex:p,insertBefore:u,insertAtIndex:w,timelineLength:f.length,targetTimeInTimeline:f[p],insertTimeInTimeline:f[w]});for(let J=f.length-1;J>=w;J--){const V=this.strategy.cellKey(f[J],d),G=this.strategy.cellKey(f[J+1],d),Te=s.cells.get(V);Te&&J+1<f.length&&(s.cells.delete(V),s.cells.set(G,Te))}const C=this.strategy.cellKey(f[w],d);s.cells.set(C,v),console.log("[DragOperations.handleDrop] Placed at:",C);const U=this.strategy.cellKey(f[0],d);s.cells.get(U);const N=[];for(let J=1;J<f.length;J++){const V=this.strategy.cellKey(f[J],d),G=s.cells.get(V);G&&N.push({card:G,originalIndex:J})}for(let J=1;J<f.length;J++){const V=this.strategy.cellKey(f[J],d);s.cells.delete(V)}const q=1;let K=C;for(let J=0;J<N.length;J++){const V=this.strategy.cellKey(f[q+J],d);s.cells.set(V,N[J].card),N[J].card.cardId===a&&(K=V)}console.log("[DragOperations.handleDrop] Compacted lane:",d,"cards:",N.length);const{timeId:F,laneId:te}=this.strategy.parseCellKey(K);console.log("[ACTUAL DROP] Card ended up at:",{finalTime:F,finalLane:te,finalKey:K,calculatedInsertIndex:u?p:p+1}),console.log(`=== END DROP ANALYSIS ===
`),this.callbacks.onRecordUndo({type:"move",userId:this.userId,cardId:a,fromRow:this.strategy.name==="vertical"?i:l,fromCol:this.strategy.name==="vertical"?l:i,toRow:this.strategy.name==="vertical"?F:te,toCol:this.strategy.name==="vertical"?te:F}),this.callbacks.onClearRedo()}),this.state.isDragging=!1,this.state.dragPreview=null,this.state.draggedCard=null}}class Uh{constructor(e,t,r,s,i,l,a,c,d,u){this.strategy=e,this.state=t,this.callbacks=r,this.userId=s,this.getSheet=i,this.getLanes=l,this.getTimeline=a,this.getCellsMap=c,this.getCardsMetadata=d,this.getThumbnailSize=u}handleColumnDragStart(e,t){if(this.state.draggedColumn=t,this.state.isColumnDragging=!0,e.dataTransfer){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t);const r=document.createElement("div");r.style.position="absolute",r.style.top="-9999px",r.style.left="-9999px",r.style.display="flex",r.style.flexDirection="column";const s=this.getThumbnailSize();r.style.gap=`${s.width*.035}px`,r.style.opacity="0.7",r.style.pointerEvents="none";const i=this.getLanes(),l=this.getTimeline(),a=this.getCellsMap(),c=this.getCardsMetadata();i.indexOf(t);const d=l.map(p=>{const w=this.strategy.cellKey(p,t),C=a.get(w),U=C==null?void 0:C.cardId;return U?c.get(U):null}).filter(p=>p!==null);d.forEach(p=>{const w=document.createElement("div");w.style.width=`${s.width}px`,w.style.height=`${s.height}px`,w.style.backgroundColor=p.color,w.style.borderRadius="8px",w.style.display="flex",w.style.alignItems="center",w.style.justifyContent="center",w.style.color="rgba(255, 255, 255, 0.9)",w.style.fontSize="0.75rem",w.style.padding="0.5rem",w.style.textAlign="center",w.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.2)",w.textContent=p.title,r.appendChild(w)}),document.body.appendChild(r);const u=s.height,h=s.width*.035,v=d.length*u+(d.length-1)*h,f=s.width/2,g=v/2;e.dataTransfer.setDragImage(r,f,g),setTimeout(()=>{document.body.removeChild(r)},0)}console.log("[ColumnDragOperations.handleColumnDragStart] Dragging lane:",t)}handleColumnDragOver(e,t){if(e.preventDefault(),!this.state.draggedColumn||this.state.draggedColumn===t){this.state.columnDragPreview=null;return}e.dataTransfer&&(e.dataTransfer.dropEffect="move");const r=e.currentTarget.getBoundingClientRect(),s=r.left+r.width/2,i=e.clientX<s,l=this.getLanes(),a=l.indexOf(this.state.draggedColumn),c=l.indexOf(t);if(c===-1||a===-1)return;let d=i?c:c+1;if(a<d&&d--,a===d){this.state.columnDragPreview=null;return}this.state.columnDragPreview={targetColIndex:c,insertBefore:i}}handleColumnDrop(e,t){if(e.preventDefault(),e.stopPropagation(),console.log("[ColumnDragOperations.handleColumnDrop] Drop event",{draggedColumn:this.state.draggedColumn,targetLaneId:t}),!this.state.draggedColumn||this.state.draggedColumn===t){console.log("[ColumnDragOperations.handleColumnDrop] Early exit:",{draggedColumn:this.state.draggedColumn,sameTarget:this.state.draggedColumn===t}),this.resetColumnDrag();return}const r=this.getSheet();if(!r){console.log("[ColumnDragOperations.handleColumnDrop] No sheet available"),this.resetColumnDrag();return}const s=this.strategy.name==="vertical"?r.colOrder:r.rowOrder,i=s.toArray();console.log("[ColumnDragOperations.handleColumnDrop] Lanes array:",i);const l=i.indexOf(this.state.draggedColumn),a=i.indexOf(t);if(console.log("[ColumnDragOperations.handleColumnDrop] Indices:",{sourceIndex:l,targetIndex:a}),l===-1||a===-1){console.log("[ColumnDragOperations.handleColumnDrop] Invalid indices, exiting"),this.resetColumnDrag();return}const c=e.currentTarget.getBoundingClientRect(),d=c.left+c.width/2,u=e.clientX<d;let h=u?a:a+1;if(l<h&&h--,console.log("[ColumnDragOperations.handleColumnDrop] Final index calculation:",{insertBefore:u,finalIndex:h}),l!==h){this.callbacks.onRecordUndo({type:"reorderColumn",userId:this.userId,colId:this.state.draggedColumn,fromIndex:l,toIndex:h}),this.callbacks.onClearRedo();const[v]=i.splice(l,1);i.splice(h,0,v),console.log("[ColumnDragOperations.handleColumnDrop] New lanes array:",i),s.delete(0,s.length),s.push(i),console.log("[ColumnDragOperations.handleColumnDrop] Reordered lane",this.state.draggedColumn,"from",l,"to",h)}else console.log("[ColumnDragOperations.handleColumnDrop] No reorder needed, sourceIndex === finalIndex");this.resetColumnDrag()}resetColumnDrag(){this.state.draggedColumn=null,this.state.isColumnDragging=!1,this.state.columnDragPreview=null}}const At=()=>new Map,ml=n=>{const e=At();return n.forEach((t,r)=>{e.set(r,t)}),e},kn=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},Lh=(n,e)=>{const t=[];for(const[r,s]of n)t.push(e(s,r));return t},jh=(n,e)=>{for(const[t,r]of n)if(e(r,t))return!0;return!1},Yn=()=>new Set,Yo=n=>n[n.length-1],Ph=(n,e)=>{for(let t=0;t<e.length;t++)n.push(e[t])},On=Array.from,Nh=Array.isArray;class Pc{constructor(){this._observers=At()}on(e,t){return kn(this._observers,e,Yn).add(t),t}once(e,t){const r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return On((this._observers.get(e)||At()).values()).forEach(r=>r(...t))}destroy(){this._observers=At()}}class Fh{constructor(){this._observers=At()}on(e,t){kn(this._observers,e,Yn).add(t)}once(e,t){const r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return On((this._observers.get(e)||At()).values()).forEach(r=>r(...t))}destroy(){this._observers=At()}}const Rn=Math.floor,Qi=Math.abs,Nl=(n,e)=>n<e?n:e,kr=(n,e)=>n>e?n:e,Bh=Math.pow,Nc=n=>n!==0?n<0:1/n<0,Ca=1,ka=2,Jo=4,Wo=8,mi=32,En=64,Nt=128,Oo=31,pl=63,cr=127,zh=2147483647,Fc=Number.MAX_SAFE_INTEGER,Kh=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&Rn(n)===n),qh=String.fromCharCode,Vh=n=>n.toLowerCase(),Hh=/^\s*/g,Yh=n=>n.replace(Hh,""),Jh=/([A-Z])/g,Sa=(n,e)=>Yh(n.replace(Jh,t=>`${e}${Vh(t)}`)),Wh=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},pi=typeof TextEncoder<"u"?new TextEncoder:null,Gh=n=>pi.encode(n),Xh=pi?Gh:Wh;let ai=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ai&&ai.decode(new Uint8Array).length===1&&(ai=null);class Li{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const _t=()=>new Li,Fl=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},Ze=n=>{const e=new Uint8Array(Fl(n));let t=0;for(let r=0;r<n.bufs.length;r++){const s=n.bufs[r];e.set(s,t),t+=s.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},Zh=(n,e)=>{const t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(kr(t,e)*2),n.cpos=0)},at=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},_l=at,$=(n,e)=>{for(;e>cr;)at(n,Nt|cr&e),e=Rn(e/128);at(n,cr&e)},Bl=(n,e)=>{const t=Nc(e);for(t&&(e=-e),at(n,(e>pl?Nt:0)|(t?En:0)|pl&e),e=Rn(e/64);e>0;)at(n,(e>cr?Nt:0)|cr&e),e=Rn(e/128)},wl=new Uint8Array(3e4),Qh=wl.length/3,$h=(n,e)=>{if(e.length<Qh){const t=pi.encodeInto(e,wl).written||0;$(n,t);for(let r=0;r<t;r++)at(n,wl[r])}else nt(n,Xh(e))},ef=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;$(n,r);for(let s=0;s<r;s++)at(n,t.codePointAt(s))},dr=pi&&pi.encodeInto?$h:ef,Ro=(n,e)=>{const t=n.cbuf.length,r=n.cpos,s=Nl(t-r,e.length),i=e.length-s;n.cbuf.set(e.subarray(0,s),r),n.cpos+=s,i>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(kr(t*2,i)),n.cbuf.set(e.subarray(s)),n.cpos=i)},nt=(n,e)=>{$(n,e.byteLength),Ro(n,e)},zl=(n,e)=>{Zh(n,e);const t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},tf=(n,e)=>zl(n,4).setFloat32(0,e,!1),nf=(n,e)=>zl(n,8).setFloat64(0,e,!1),rf=(n,e)=>zl(n,8).setBigInt64(0,e,!1),Da=new DataView(new ArrayBuffer(4)),sf=n=>(Da.setFloat32(0,n),Da.getFloat32(0)===n),_i=(n,e)=>{switch(typeof e){case"string":at(n,119),dr(n,e);break;case"number":Kh(e)&&Qi(e)<=zh?(at(n,125),Bl(n,e)):sf(e)?(at(n,124),tf(n,e)):(at(n,123),nf(n,e));break;case"bigint":at(n,122),rf(n,e);break;case"object":if(e===null)at(n,126);else if(Nh(e)){at(n,117),$(n,e.length);for(let t=0;t<e.length;t++)_i(n,e[t])}else if(e instanceof Uint8Array)at(n,116),nt(n,e);else{at(n,118);const t=Object.keys(e);$(n,t.length);for(let r=0;r<t.length;r++){const s=t[r];dr(n,s),_i(n,e[s])}}break;case"boolean":at(n,e?120:121);break;default:at(n,127)}};class Ta extends Li{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&$(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Ma=n=>{n.count>0&&(Bl(n.encoder,n.count===1?n.s:-n.s),n.count>1&&$(n.encoder,n.count-2))};class $i{constructor(){this.encoder=new Li,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Ma(this),this.count=1,this.s=e)}toUint8Array(){return Ma(this),Ze(this.encoder)}}const xa=n=>{if(n.count>0){const e=n.diff*2+(n.count===1?0:1);Bl(n.encoder,e),n.count>1&&$(n.encoder,n.count-2)}};class Go{constructor(){this.encoder=new Li,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(xa(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return xa(this),Ze(this.encoder)}}class of{constructor(){this.sarr=[],this.s="",this.lensE=new $i}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Li;return this.sarr.push(this.s),this.s="",dr(e,this.sarr.join("")),Ro(e,this.lensE.toUint8Array()),Ze(e)}}const Jn=n=>new Error(n),mn=()=>{throw Jn("Method unimplemented")},_n=()=>{throw Jn("Unexpected case")},Bc=Jn("Unexpected end of array"),zc=Jn("Integer out of Range");class Ao{constructor(e){this.arr=e,this.pos=0}}const Xn=n=>new Ao(n),lf=n=>n.pos!==n.arr.length,af=(n,e)=>{const t=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},pt=n=>af(n,ue(n)),Xs=n=>n.arr[n.pos++],ue=n=>{let e=0,t=1;const r=n.arr.length;for(;n.pos<r;){const s=n.arr[n.pos++];if(e=e+(s&cr)*t,t*=128,s<Nt)return e;if(e>Fc)throw zc}throw Bc},Kl=n=>{let e=n.arr[n.pos++],t=e&pl,r=64;const s=(e&En)>0?-1:1;if((e&Nt)===0)return s*t;const i=n.arr.length;for(;n.pos<i;){if(e=n.arr[n.pos++],t=t+(e&cr)*r,r*=128,e<Nt)return s*t;if(t>Fc)throw zc}throw Bc},cf=n=>{let e=ue(n);if(e===0)return"";{let t=String.fromCodePoint(Xs(n));if(--e<100)for(;e--;)t+=String.fromCodePoint(Xs(n));else for(;e>0;){const r=e<1e4?e:1e4,s=n.arr.subarray(n.pos,n.pos+r);n.pos+=r,t+=String.fromCodePoint.apply(null,s),e-=r}return decodeURIComponent(escape(t))}},df=n=>ai.decode(pt(n)),Vn=ai?df:cf,ql=(n,e)=>{const t=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,e);return n.pos+=e,t},uf=n=>ql(n,4).getFloat32(0,!1),hf=n=>ql(n,8).getFloat64(0,!1),ff=n=>ql(n,8).getBigInt64(0,!1),gf=[n=>{},n=>null,Kl,uf,hf,ff,n=>!1,n=>!0,Vn,n=>{const e=ue(n),t={};for(let r=0;r<e;r++){const s=Vn(n);t[s]=wi(n)}return t},n=>{const e=ue(n),t=[];for(let r=0;r<e;r++)t.push(wi(n));return t},pt],wi=n=>gf[127-Xs(n)](n);class Ia extends Ao{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),lf(this)?this.count=ue(this)+1:this.count=-1),this.count--,this.s}}class eo extends Ao{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Kl(this);const e=Nc(this.s);this.count=1,e&&(this.s=-this.s,this.count=ue(this)+2)}return this.count--,this.s}}class Xo extends Ao{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Kl(this),t=e&1;this.diff=Rn(e/2),this.count=1,t&&(this.count=ue(this)+2)}return this.s+=this.diff,this.count--,this.s}}class vf{constructor(e){this.decoder=new eo(e),this.str=Vn(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}const mf=crypto.getRandomValues.bind(crypto),Kc=()=>mf(new Uint32Array(1))[0],pf="10000000-1000-4000-8000"+-1e11,_f=()=>pf.replace(/[018]/g,n=>(n^Kc()&15>>n/4).toString(16)),fr=Date.now,Ea=n=>new Promise(n);Promise.all.bind(Promise);const Oa=n=>n===void 0?null:n;class wf{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let qc=new wf,Vl=!0;try{typeof localStorage<"u"&&localStorage&&(qc=localStorage,Vl=!1)}catch{}const Vc=qc,yf=n=>Vl||addEventListener("storage",n),bf=n=>Vl||removeEventListener("storage",n),Cf=Object.assign,Hc=Object.keys,kf=(n,e)=>{for(const t in n)e(n[t],t)},Sf=(n,e)=>{const t=[];for(const r in n)t.push(e(n[r],r));return t},Ra=n=>Hc(n).length,Aa=n=>Hc(n).length,Df=n=>{for(const e in n)return!1;return!0},Tf=(n,e)=>{for(const t in n)if(!e(n[t],t))return!1;return!0},Yc=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),Mf=(n,e)=>n===e||Aa(n)===Aa(e)&&Tf(n,(t,r)=>(t!==void 0||Yc(e,r))&&e[r]===t),xf=Object.freeze,Jc=n=>{for(const e in n){const t=n[e];(typeof t=="object"||typeof t=="function")&&Jc(n[e])}return xf(n)},Ua=Symbol("Equality"),Hl=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&Hl(n,e,t+1)}},If=n=>n,ci=(n,e)=>{if(n===e)return!0;if(n==null||e==null||n.constructor!==e.constructor)return!1;if(n[Ua]!=null)return n[Ua](e);switch(n.constructor){case ArrayBuffer:n=new Uint8Array(n),e=new Uint8Array(e);case Uint8Array:{if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;break}case Set:{if(n.size!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;break}case Map:{if(n.size!==e.size)return!1;for(const t of n.keys())if(!e.has(t)||!ci(n.get(t),e.get(t)))return!1;break}case Object:if(Ra(n)!==Ra(e))return!1;for(const t in n)if(!Yc(n,t)||!ci(n[t],e[t]))return!1;break;case Array:if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!ci(n[t],e[t]))return!1;break;default:return!1}return!0},Ef=(n,e)=>e.includes(n);var Wc={};const Wn=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",Gc=typeof window<"u"&&typeof document<"u"&&!Wn;let ln;const Of=()=>{if(ln===void 0)if(Wn){ln=At();const n=process.argv;let e=null;for(let t=0;t<n.length;t++){const r=n[t];r[0]==="-"?(e!==null&&ln.set(e,""),e=r):e!==null&&(ln.set(e,r),e=null)}e!==null&&ln.set(e,"")}else typeof location=="object"?(ln=At(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[e,t]=n.split("=");ln.set(`--${Sa(e,"-")}`,t),ln.set(`-${Sa(e,"-")}`,t)}})):ln=At();return ln},yl=n=>Of().has(n),co=n=>Oa(Wn?Wc[n.toUpperCase().replaceAll("-","_")]:Vc.getItem(n)),Xc=n=>yl("--"+n)||co(n)!==null;Xc("production");const Rf=Wn&&Ef(Wc.FORCE_COLOR,["true","1","2"]),Af=Rf||!yl("--no-colors")&&!Xc("no-color")&&(!Wn||process.stdout.isTTY)&&(!Wn||yl("--color")||co("COLORTERM")!==null||(co("TERM")||"").includes("color")),Zc=n=>new Uint8Array(n),Uf=(n,e,t)=>new Uint8Array(n,e,t),Lf=n=>new Uint8Array(n),jf=n=>{let e="";for(let t=0;t<n.byteLength;t++)e+=qh(n[t]);return btoa(e)},Pf=n=>Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("base64"),Nf=n=>{const e=atob(n),t=Zc(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},Ff=n=>{const e=Buffer.from(n,"base64");return Uf(e.buffer,e.byteOffset,e.byteLength)},Bf=Gc?jf:Pf,zf=Gc?Nf:Ff,Kf=n=>{const e=Zc(n.byteLength);return e.set(n),e};class qf{constructor(e,t){this.left=e,this.right=t}}const Sn=(n,e)=>new qf(n,e);typeof DOMParser<"u"&&new DOMParser;const Vf=n=>Lh(n,(e,t)=>`${t}:${e};`).join(""),Ln=Symbol,Qc=Ln(),$c=Ln(),Hf=Ln(),Yf=Ln(),Jf=Ln(),ed=Ln(),Wf=Ln(),Yl=Ln(),Gf=Ln(),Xf=n=>{var s;n.length===1&&((s=n[0])==null?void 0:s.constructor)===Function&&(n=n[0]());const e=[],t=[];let r=0;for(;r<n.length;r++){const i=n[r];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(r>0&&t.push(e.join(""));r<n.length;r++){const i=n[r];i instanceof Symbol||t.push(i)}return t},Zf={[Qc]:Sn("font-weight","bold"),[$c]:Sn("font-weight","normal"),[Hf]:Sn("color","blue"),[Jf]:Sn("color","green"),[Yf]:Sn("color","grey"),[ed]:Sn("color","red"),[Wf]:Sn("color","purple"),[Yl]:Sn("color","orange"),[Gf]:Sn("color","black")},Qf=n=>{var l;n.length===1&&((l=n[0])==null?void 0:l.constructor)===Function&&(n=n[0]());const e=[],t=[],r=At();let s=[],i=0;for(;i<n.length;i++){const a=n[i],c=Zf[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const d=Vf(r);i>0||d.length>0?(e.push("%c"+a),t.push(d)):e.push(a)}else break}}for(i>0&&(s=t,s.unshift(e.join("")));i<n.length;i++){const a=n[i];a instanceof Symbol||s.push(a)}return s},td=Af?Qf:Xf,$f=(...n)=>{console.log(...td(n)),nd.forEach(e=>e.print(n))},eg=(...n)=>{console.warn(...td(n)),n.unshift(Yl),nd.forEach(e=>e.print(n))},nd=Yn(),rd=n=>({[Symbol.iterator](){return this},next:n}),tg=(n,e)=>rd(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),Zo=(n,e)=>rd(()=>{const{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});class Jl{constructor(e,t){this.clock=e,this.len=t}}class ji{constructor(){this.clients=new Map}}const sd=(n,e,t)=>e.clients.forEach((r,s)=>{const i=n.doc.store.clients.get(s);if(i!=null){const l=i[i.length-1],a=l.id.clock+l.length;for(let c=0,d=r[c];c<r.length&&d.clock<a;d=r[++c])pd(n,i,d.clock,d.len,t)}}),ng=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){const s=Rn((t+r)/2),i=n[s],l=i.clock;if(l<=e){if(e<l+i.len)return s;t=s+1}else r=s-1}return null},id=(n,e)=>{const t=n.clients.get(e.client);return t!==void 0&&ng(t,e.clock)!==null},Wl=n=>{n.clients.forEach(e=>{e.sort((s,i)=>s.clock-i.clock);let t,r;for(t=1,r=1;t<e.length;t++){const s=e[r-1],i=e[t];s.clock+s.len>=i.clock?s.len=kr(s.len,i.clock+i.len-s.clock):(r<t&&(e[r]=i),r++)}e.length=r})},rg=n=>{const e=new ji;for(let t=0;t<n.length;t++)n[t].clients.forEach((r,s)=>{if(!e.clients.has(s)){const i=r.slice();for(let l=t+1;l<n.length;l++)Ph(i,n[l].clients.get(s)||[]);e.clients.set(s,i)}});return Wl(e),e},uo=(n,e,t,r)=>{kn(n.clients,e,()=>[]).push(new Jl(t,r))},sg=()=>new ji,ig=n=>{const e=sg();return n.clients.forEach((t,r)=>{const s=[];for(let i=0;i<t.length;i++){const l=t[i];if(l.deleted){const a=l.id.clock;let c=l.length;if(i+1<t.length)for(let d=t[i+1];i+1<t.length&&d.deleted;d=t[++i+1])c+=d.length;s.push(new Jl(a,c))}}s.length>0&&e.clients.set(r,s)}),e},ti=(n,e)=>{$(n.restEncoder,e.clients.size),On(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),$(n.restEncoder,t);const s=r.length;$(n.restEncoder,s);for(let i=0;i<s;i++){const l=r[i];n.writeDsClock(l.clock),n.writeDsLen(l.len)}})},Gl=n=>{const e=new ji,t=ue(n.restDecoder);for(let r=0;r<t;r++){n.resetDsCurVal();const s=ue(n.restDecoder),i=ue(n.restDecoder);if(i>0){const l=kn(e.clients,s,()=>[]);for(let a=0;a<i;a++)l.push(new Jl(n.readDsClock(),n.readDsLen()))}}return e},La=(n,e,t)=>{const r=new ji,s=ue(n.restDecoder);for(let i=0;i<s;i++){n.resetDsCurVal();const l=ue(n.restDecoder),a=ue(n.restDecoder),c=t.clients.get(l)||[],d=ct(t,l);for(let u=0;u<a;u++){const h=n.readDsClock(),v=h+n.readDsLen();if(h<d){d<v&&uo(r,l,d,v-d);let f=wn(c,h),g=c[f];for(!g.deleted&&g.id.clock<h&&(c.splice(f+1,0,_o(e,g,h-g.id.clock)),f++);f<c.length&&(g=c[f++],g.id.clock<v);)g.deleted||(v<g.id.clock+g.length&&c.splice(f,0,_o(e,g,v-g.id.clock)),g.delete(e))}else uo(r,l,h,v-h)}}if(r.clients.size>0){const i=new gr;return $(i.restEncoder,0),ti(i,r),i.toUint8Array()}return null},od=Kc;class ni extends Pc{constructor({guid:e=_f(),collectionid:t=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:l=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=od(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new vd,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=l,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Ea(d=>{this.on("load",()=>{this.isLoaded=!0,d(this)})});const c=()=>Ea(d=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),d())};this.on("sync",u)});this.on("sync",d=>{d===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=d===void 0||d===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Ke(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(On(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Ke(this,e,t)}get(e,t=gt){const r=kn(this.share,e,()=>{const i=new t;return i._integrate(this,null),i}),s=r.constructor;if(t!==gt&&s!==t)if(s===gt){const i=new t;i._map=r._map,r._map.forEach(l=>{for(;l!==null;l=l.left)l.parent=i}),i._start=r._start;for(let l=i._start;l!==null;l=l.right)l.parent=i;return i._length=r._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,jr)}getText(e=""){return this.get(e,vr)}getMap(e=""){return this.get(e,Wt)}getXmlElement(e=""){return this.get(e,Qs)}getXmlFragment(e=""){return this.get(e,mr)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,On(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new ni({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Ke(e.parent.doc,r=>{const s=t.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class ld{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return ue(this.restDecoder)}readDsLen(){return ue(this.restDecoder)}}class ad extends ld{readLeftID(){return De(ue(this.restDecoder),ue(this.restDecoder))}readRightID(){return De(ue(this.restDecoder),ue(this.restDecoder))}readClient(){return ue(this.restDecoder)}readInfo(){return Xs(this.restDecoder)}readString(){return Vn(this.restDecoder)}readParentInfo(){return ue(this.restDecoder)===1}readTypeRef(){return ue(this.restDecoder)}readLen(){return ue(this.restDecoder)}readAny(){return wi(this.restDecoder)}readBuf(){return Kf(pt(this.restDecoder))}readJSON(){return JSON.parse(Vn(this.restDecoder))}readKey(){return Vn(this.restDecoder)}}class og{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ue(this.restDecoder),this.dsCurrVal}readDsLen(){const e=ue(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Zs extends og{constructor(e){super(e),this.keys=[],ue(e),this.keyClockDecoder=new Xo(pt(e)),this.clientDecoder=new eo(pt(e)),this.leftClockDecoder=new Xo(pt(e)),this.rightClockDecoder=new Xo(pt(e)),this.infoDecoder=new Ia(pt(e),Xs),this.stringDecoder=new vf(pt(e)),this.parentInfoDecoder=new Ia(pt(e),Xs),this.typeRefDecoder=new eo(pt(e)),this.lenDecoder=new eo(pt(e))}readLeftID(){return new Lr(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Lr(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return wi(this.restDecoder)}readBuf(){return pt(this.restDecoder)}readJSON(){return wi(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class cd{constructor(){this.restEncoder=_t()}toUint8Array(){return Ze(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){$(this.restEncoder,e)}writeDsLen(e){$(this.restEncoder,e)}}class Pi extends cd{writeLeftID(e){$(this.restEncoder,e.client),$(this.restEncoder,e.clock)}writeRightID(e){$(this.restEncoder,e.client),$(this.restEncoder,e.clock)}writeClient(e){$(this.restEncoder,e)}writeInfo(e){_l(this.restEncoder,e)}writeString(e){dr(this.restEncoder,e)}writeParentInfo(e){$(this.restEncoder,e?1:0)}writeTypeRef(e){$(this.restEncoder,e)}writeLen(e){$(this.restEncoder,e)}writeAny(e){_i(this.restEncoder,e)}writeBuf(e){nt(this.restEncoder,e)}writeJSON(e){dr(this.restEncoder,JSON.stringify(e))}writeKey(e){dr(this.restEncoder,e)}}class dd{constructor(){this.restEncoder=_t(),this.dsCurrVal=0}toUint8Array(){return Ze(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,$(this.restEncoder,t)}writeDsLen(e){e===0&&_n(),$(this.restEncoder,e-1),this.dsCurrVal+=e}}class gr extends dd{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Go,this.clientEncoder=new $i,this.leftClockEncoder=new Go,this.rightClockEncoder=new Go,this.infoEncoder=new Ta(_l),this.stringEncoder=new of,this.parentInfoEncoder=new Ta(_l),this.typeRefEncoder=new $i,this.lenEncoder=new $i}toUint8Array(){const e=_t();return $(e,0),nt(e,this.keyClockEncoder.toUint8Array()),nt(e,this.clientEncoder.toUint8Array()),nt(e,this.leftClockEncoder.toUint8Array()),nt(e,this.rightClockEncoder.toUint8Array()),nt(e,Ze(this.infoEncoder)),nt(e,this.stringEncoder.toUint8Array()),nt(e,Ze(this.parentInfoEncoder)),nt(e,this.typeRefEncoder.toUint8Array()),nt(e,this.lenEncoder.toUint8Array()),Ro(e,Ze(this.restEncoder)),Ze(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){_i(this.restEncoder,e)}writeBuf(e){nt(this.restEncoder,e)}writeJSON(e){_i(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const lg=(n,e,t,r)=>{r=kr(r,e[0].id.clock);const s=wn(e,r);$(n.restEncoder,e.length-s),n.writeClient(t),$(n.restEncoder,r);const i=e[s];i.write(n,r-i.id.clock);for(let l=s+1;l<e.length;l++)e[l].write(n,0)},Xl=(n,e,t)=>{const r=new Map;t.forEach((s,i)=>{ct(e,i)>s&&r.set(i,s)}),Uo(e).forEach((s,i)=>{t.has(i)||r.set(i,0)}),$(n.restEncoder,r.size),On(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{lg(n,e.clients.get(s),s,i)})},ag=(n,e)=>{const t=At(),r=ue(n.restDecoder);for(let s=0;s<r;s++){const i=ue(n.restDecoder),l=new Array(i),a=n.readClient();let c=ue(n.restDecoder);t.set(a,{i:0,refs:l});for(let d=0;d<i;d++){const u=n.readInfo();switch(Oo&u){case 0:{const h=n.readLen();l[d]=new Ht(De(a,c),h),c+=h;break}case 10:{const h=ue(n.restDecoder);l[d]=new Yt(De(a,c),h),c+=h;break}default:{const h=(u&(En|Nt))===0,v=new it(De(a,c),null,(u&Nt)===Nt?n.readLeftID():null,null,(u&En)===En?n.readRightID():null,h?n.readParentInfo()?e.get(n.readString()):n.readLeftID():null,h&&(u&mi)===mi?n.readString():null,jd(n,u));l[d]=v,c+=v.length}}}}return t},cg=(n,e,t)=>{const r=[];let s=On(t.keys()).sort((f,g)=>f-g);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let f=t.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=t.get(s[s.length-1]);else return null;return f};let l=i();if(l===null)return null;const a=new vd,c=new Map,d=(f,g)=>{const p=c.get(f);(p==null||p>g)&&c.set(f,g)};let u=l.refs[l.i++];const h=new Map,v=()=>{for(const f of r){const g=f.id.client,p=t.get(g);p?(p.i--,a.clients.set(g,p.refs.slice(p.i)),t.delete(g),p.i=0,p.refs=[]):a.clients.set(g,[f]),s=s.filter(w=>w!==g)}r.length=0};for(;;){if(u.constructor!==Yt){const g=kn(h,u.id.client,()=>ct(e,u.id.client))-u.id.clock;if(g<0)r.push(u),d(u.id.client,u.id.clock-1),v();else{const p=u.getMissing(n,e);if(p!==null){r.push(u);const w=t.get(p)||{refs:[],i:0};if(w.refs.length===w.i)d(p,ct(e,p)),v();else{u=w.refs[w.i++];continue}}else(g===0||g<u.length)&&(u.integrate(n,g),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(l!==null&&l.i<l.refs.length)u=l.refs[l.i++];else{if(l=i(),l===null)break;u=l.refs[l.i++]}}if(a.clients.size>0){const f=new gr;return Xl(f,a,new Map),$(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},dg=(n,e)=>Xl(n,e.doc.store,e.beforeState),ug=(n,e,t,r=new Zs(n))=>Ke(e,s=>{s.local=!1;let i=!1;const l=s.doc,a=l.store,c=ag(r,l),d=cg(s,a,c),u=a.pendingStructs;if(u){for(const[v,f]of u.missing)if(f<ct(a,v)){i=!0;break}if(d){for(const[v,f]of d.missing){const g=u.missing.get(v);(g==null||g>f)&&u.missing.set(v,f)}u.update=ho([u.update,d.update])}}else a.pendingStructs=d;const h=La(r,s,a);if(a.pendingDs){const v=new Zs(Xn(a.pendingDs));ue(v.restDecoder);const f=La(v,s,a);h&&f?a.pendingDs=ho([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(i){const v=a.pendingStructs.update;a.pendingStructs=null,ud(s.doc,v)}},t,!1),ud=(n,e,t,r=Zs)=>{const s=Xn(e);ug(s,n,t,new r(s))},hg=(n,e,t)=>ud(n,e,t,ad),fg=(n,e,t=new Map)=>{Xl(n,e.store,t),ti(n,ig(e.store))},gg=(n,e=new Uint8Array([0]),t=new gr)=>{const r=hd(e);fg(t,n,r);const s=[t.toUint8Array()];if(n.store.pendingDs&&s.push(n.store.pendingDs),n.store.pendingStructs&&s.push(Eg(n.store.pendingStructs.update,e)),s.length>1){if(t.constructor===Pi)return xg(s.map((i,l)=>l===0?i:Rg(i)));if(t.constructor===gr)return ho(s)}return s[0]},vg=(n,e)=>gg(n,e,new Pi),mg=n=>{const e=new Map,t=ue(n.restDecoder);for(let r=0;r<t;r++){const s=ue(n.restDecoder),i=ue(n.restDecoder);e.set(s,i)}return e},hd=n=>mg(new ld(Xn(n))),fd=(n,e)=>($(n.restEncoder,e.size),On(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{$(n.restEncoder,t),$(n.restEncoder,r)}),n),pg=(n,e)=>fd(n,Uo(e.store)),_g=(n,e=new dd)=>(n instanceof Map?fd(e,n):pg(e,n),e.toUint8Array()),wg=n=>_g(n,new cd);class yg{constructor(){this.l=[]}}const ja=()=>new yg,Pa=(n,e)=>n.l.push(e),Na=(n,e)=>{const t=n.l,r=t.length;n.l=t.filter(s=>e!==s),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},gd=(n,e,t)=>Hl(n.l,[e,t]);class Lr{constructor(e,t){this.client=e,this.clock=t}}const Vi=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,De=(n,e)=>new Lr(n,e),bg=n=>{for(const[e,t]of n.doc.share.entries())if(t===n)return e;throw _n()},Ir=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!id(e.ds,n.id),bl=(n,e)=>{const t=kn(n.meta,bl,Yn),r=n.doc.store;t.has(e)||(e.sv.forEach((s,i)=>{s<ct(r,i)&&Gn(n,De(i,s))}),sd(n,e.ds,s=>{}),t.add(e))};class vd{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Uo=n=>{const e=new Map;return n.clients.forEach((t,r)=>{const s=t[t.length-1];e.set(r,s.id.clock+s.length)}),e},ct=(n,e)=>{const t=n.clients.get(e);if(t===void 0)return 0;const r=t[t.length-1];return r.id.clock+r.length},md=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{const r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw _n()}t.push(e)},wn=(n,e)=>{let t=0,r=n.length-1,s=n[r],i=s.id.clock;if(i===e)return r;let l=Rn(e/(i+s.length-1)*r);for(;t<=r;){if(s=n[l],i=s.id.clock,i<=e){if(e<i+s.length)return l;t=l+1}else r=l-1;l=Rn((t+r)/2)}throw _n()},Cg=(n,e)=>{const t=n.clients.get(e.client);return t[wn(t,e.clock)]},Qo=Cg,Cl=(n,e,t)=>{const r=wn(e,t),s=e[r];return s.id.clock<t&&s instanceof it?(e.splice(r+1,0,_o(n,s,t-s.id.clock)),r+1):r},Gn=(n,e)=>{const t=n.doc.store.clients.get(e.client);return t[Cl(n,t,e.clock)]},Fa=(n,e,t)=>{const r=e.clients.get(t.client),s=wn(r,t.clock),i=r[s];return t.clock!==i.id.clock+i.length-1&&i.constructor!==Ht&&r.splice(s+1,0,_o(n,i,t.clock-i.id.clock+1)),i},kg=(n,e,t)=>{const r=n.clients.get(e.id.client);r[wn(r,e.id.clock)]=t},pd=(n,e,t,r,s)=>{if(r===0)return;const i=t+r;let l=Cl(n,e,t),a;do a=e[l++],i<a.id.clock+a.length&&Cl(n,e,i),s(a);while(l<e.length&&e[l].id.clock<i)};class Sg{constructor(e,t,r){this.doc=e,this.deleteSet=new ji,this.beforeState=Uo(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Ba=(n,e)=>e.deleteSet.clients.size===0&&!jh(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Wl(e.deleteSet),dg(n,e),ti(n,e.deleteSet),!0),za=(n,e,t)=>{const r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&kn(n.changed,e,Yn).add(t)},to=(n,e)=>{let t=n[e],r=n[e-1],s=e;for(;s>0;t=r,r=n[--s-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof it&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}const i=e-s;return i&&n.splice(e+1-i,i),i},Dg=(n,e,t)=>{for(const[r,s]of n.clients.entries()){const i=e.clients.get(r);for(let l=s.length-1;l>=0;l--){const a=s[l],c=a.clock+a.len;for(let d=wn(i,a.clock),u=i[d];d<i.length&&u.id.clock<c;u=i[++d]){const h=i[d];if(a.clock+a.len<=h.id.clock)break;h instanceof it&&h.deleted&&!h.keep&&t(h)&&h.gc(e,!1)}}}},Tg=(n,e)=>{n.clients.forEach((t,r)=>{const s=e.clients.get(r);for(let i=t.length-1;i>=0;i--){const l=t[i],a=Nl(s.length-1,1+wn(s,l.clock+l.len-1));for(let c=a,d=s[c];c>0&&d.id.clock>=l.clock;d=s[c])c-=1+to(s,c)}})},_d=(n,e)=>{if(e<n.length){const t=n[e],r=t.doc,s=r.store,i=t.deleteSet,l=t._mergeStructs;try{Wl(i),t.afterState=Uo(t.doc.store),r.emit("beforeObserverCalls",[t,r]);const a=[];t.changed.forEach((c,d)=>a.push(()=>{(d._item===null||!d._item.deleted)&&d._callObserver(t,c)})),a.push(()=>{t.changedParentTypes.forEach((c,d)=>{d._dEH.l.length>0&&(d._item===null||!d._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=d,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),gd(d._dEH,c,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),Hl(a,[]),t._needFormattingCleanup&&Yg(t)}finally{r.gc&&Dg(i,s,r.gcFilter),Tg(i,s),t.afterState.forEach((u,h)=>{const v=t.beforeState.get(h)||0;if(v!==u){const f=s.clients.get(h),g=kr(wn(f,v),1);for(let p=f.length-1;p>=g;)p-=1+to(f,p)}});for(let u=l.length-1;u>=0;u--){const{client:h,clock:v}=l[u].id,f=s.clients.get(h),g=wn(f,v);g+1<f.length&&to(f,g+1)>1||g>0&&to(f,g)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&($f(Yl,Qc,"[yjs] ",$c,ed,"Changed the client-id because another client seems to be using it."),r.clientID=od()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){const u=new Pi;Ba(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){const u=new gr;Ba(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:d}=t;(a.size>0||d.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),d.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:d},r,t]),d.forEach(u=>u.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):_d(n,e+1)}}},Ke=(n,e,t=null,r=!0)=>{const s=n._transactionCleanups;let i=!1,l=null;n._transaction===null&&(i=!0,n._transaction=new Sg(n,t,r),s.push(n._transaction),s.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{l=e(n._transaction)}finally{if(i){const a=n._transaction===s[0];n._transaction=null,a&&_d(s,0)}}return l};function*Mg(n){const e=ue(n.restDecoder);for(let t=0;t<e;t++){const r=ue(n.restDecoder),s=n.readClient();let i=ue(n.restDecoder);for(let l=0;l<r;l++){const a=n.readInfo();if(a===10){const c=ue(n.restDecoder);yield new Yt(De(s,i),c),i+=c}else if((Oo&a)!==0){const c=(a&(En|Nt))===0,d=new it(De(s,i),null,(a&Nt)===Nt?n.readLeftID():null,null,(a&En)===En?n.readRightID():null,c?n.readParentInfo()?n.readString():n.readLeftID():null,c&&(a&mi)===mi?n.readString():null,jd(n,a));yield d,i+=d.length}else{const c=n.readLen();yield new Ht(De(s,i),c),i+=c}}}}class Zl{constructor(e,t){this.gen=Mg(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Yt);return this.curr}}class Ql{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const xg=n=>ho(n,ad,Pi),Ig=(n,e)=>{if(n.constructor===Ht){const{client:t,clock:r}=n.id;return new Ht(De(t,r+e),n.length-e)}else if(n.constructor===Yt){const{client:t,clock:r}=n.id;return new Yt(De(t,r+e),n.length-e)}else{const t=n,{client:r,clock:s}=t.id;return new it(De(r,s+e),null,De(r,s+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},ho=(n,e=Zs,t=gr)=>{if(n.length===1)return n[0];const r=n.map(u=>new e(Xn(u)));let s=r.map(u=>new Zl(u,!0)),i=null;const l=new t,a=new Ql(l);for(;s=s.filter(v=>v.curr!==null),s.sort((v,f)=>{if(v.curr.id.client===f.curr.id.client){const g=v.curr.id.clock-f.curr.id.clock;return g===0?v.curr.constructor===f.curr.constructor?0:v.curr.constructor===Yt?1:-1:g}else return f.curr.id.client-v.curr.id.client}),s.length!==0;){const u=s[0],h=u.curr.id.client;if(i!==null){let v=u.curr,f=!1;for(;v!==null&&v.id.clock+v.length<=i.struct.id.clock+i.struct.length&&v.id.client>=i.struct.id.client;)v=u.next(),f=!0;if(v===null||v.id.client!==h||f&&v.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)Pn(a,i.struct,i.offset),i={struct:v,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<v.id.clock)if(i.struct.constructor===Yt)i.struct.length=v.id.clock+v.length-i.struct.id.clock;else{Pn(a,i.struct,i.offset);const g=v.id.clock-i.struct.id.clock-i.struct.length;i={struct:new Yt(De(h,i.struct.id.clock+i.struct.length),g),offset:0}}else{const g=i.struct.id.clock+i.struct.length-v.id.clock;g>0&&(i.struct.constructor===Yt?i.struct.length-=g:v=Ig(v,g)),i.struct.mergeWith(v)||(Pn(a,i.struct,i.offset),i={struct:v,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let v=u.curr;v!==null&&v.id.client===h&&v.id.clock===i.struct.id.clock+i.struct.length&&v.constructor!==Yt;v=u.next())Pn(a,i.struct,i.offset),i={struct:v,offset:0}}i!==null&&(Pn(a,i.struct,i.offset),i=null),$l(a);const c=r.map(u=>Gl(u)),d=rg(c);return ti(l,d),l.toUint8Array()},Eg=(n,e,t=Zs,r=gr)=>{const s=hd(e),i=new r,l=new Ql(i),a=new t(Xn(n)),c=new Zl(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,v=s.get(h)||0;if(c.curr.constructor===Yt){c.next();continue}if(u.id.clock+u.length>v)for(Pn(l,u,kr(v-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Pn(l,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=v;)c.next()}$l(l);const d=Gl(a);return ti(i,d),i.toUint8Array()},wd=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:Ze(n.encoder.restEncoder)}),n.encoder.restEncoder=_t(),n.written=0)},Pn=(n,e,t)=>{n.written>0&&n.currClient!==e.id.client&&wd(n),n.written===0&&(n.currClient=e.id.client,n.encoder.writeClient(e.id.client),$(n.encoder.restEncoder,e.id.clock+t)),e.write(n.encoder,t),n.written++},$l=n=>{wd(n);const e=n.encoder.restEncoder;$(e,n.clientStructs.length);for(let t=0;t<n.clientStructs.length;t++){const r=n.clientStructs[t];$(e,r.written),Ro(e,r.restEncoder)}},Og=(n,e,t,r)=>{const s=new t(Xn(n)),i=new Zl(s,!1),l=new r,a=new Ql(l);for(let d=i.curr;d!==null;d=i.next())Pn(a,e(d),0);$l(a);const c=Gl(s);return ti(l,c),l.toUint8Array()},Rg=n=>Og(n,If,Zs,Pi),Ka="You must not compute changes after the event-handler fired.";class Lo{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Ag(this.currentTarget,this.target))}deletes(e){return id(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Jn(Ka);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(s=>{if(s!==null){const i=t._map.get(s);let l,a;if(this.adds(i)){let c=i.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(i))if(c!==null&&this.deletes(c))l="delete",a=Yo(c.content.getContent());else return;else c!==null&&this.deletes(c)?(l="update",a=Yo(c.content.getContent())):(l="add",a=void 0)}else if(this.deletes(i))l="delete",a=Yo(i.content.getContent());else return;e.set(s,{action:l,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Jn(Ka);const t=this.target,r=Yn(),s=Yn(),i=[];if(e={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null;const c=()=>{a&&i.push(a)};for(let d=t._start;d!==null;d=d.right)d.deleted?this.deletes(d)&&!this.adds(d)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=d.length,s.add(d)):this.adds(d)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(d.content.getContent()),r.add(d)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=d.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const Ag=(n,e)=>{const t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;t.unshift(r)}e=e._item.parent}return t},bt=()=>{eg("Invalid access: Add Yjs type to a document before reading data.")},yd=80;let ea=0;class Ug{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=ea++}}const Lg=n=>{n.timestamp=ea++},bd=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=ea++},jg=(n,e,t)=>{if(n.length>=yd){const r=n.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return bd(r,e,t),r}else{const r=new Ug(e,t);return n.push(r),r}},jo=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;const t=n._searchMarker.length===0?null:n._searchMarker.reduce((i,l)=>Qi(e-i.index)<Qi(e-l.index)?i:l);let r=n._start,s=0;for(t!==null&&(r=t.p,s=t.index,Lg(t));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return t!==null&&Qi(t.index-s)<r.parent.length/yd?(bd(t,r,s),t):jg(n._searchMarker,r,s)},yi=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){const s=n[r];if(t>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){n.splice(r,1);continue}s.p=i,i.marker=!0}(e<s.index||t>0&&e===s.index)&&(s.index=kr(e,s.index+t))}},Po=(n,e,t)=>{const r=n,s=e.changedParentTypes;for(;kn(s,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;gd(r._eH,t,e)};class gt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ja(),this._dEH=ja(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw mn()}clone(){throw mn()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Pa(this._eH,e)}observeDeep(e){Pa(this._dEH,e)}unobserve(e){Na(this._eH,e)}unobserveDeep(e){Na(this._dEH,e)}toJSON(){}}const Cd=(n,e,t)=>{n.doc??bt(),e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e;const s=[];let i=n._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const l=i.content.getContent();if(l.length<=e)e-=l.length;else{for(let a=e;a<l.length&&r>0;a++)s.push(l[a]),r--;e=0}}i=i.right}return s},kd=n=>{n.doc??bt();const e=[];let t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){const r=t.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}t=t.right}return e},bi=(n,e)=>{let t=0,r=n._start;for(n.doc??bt();r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)e(s[i],t++,n)}r=r.right}},Sd=(n,e)=>{const t=[];return bi(n,(r,s)=>{t.push(e(r,s,n))}),t},Pg=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}const s=t[r++];return t.length<=r&&(t=null),{done:!1,value:s}}}},Dd=(n,e)=>{n.doc??bt();const t=jo(n,e);let r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},fo=(n,e,t,r)=>{let s=t;const i=n.doc,l=i.clientID,a=i.store,c=t===null?e._start:t.right;let d=[];const u=()=>{d.length>0&&(s=new it(De(l,ct(a,l)),s,s&&s.lastId,c,c&&c.id,e,null,new pr(d)),s.integrate(n,0),d=[])};r.forEach(h=>{if(h===null)d.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:d.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:s=new it(De(l,ct(a,l)),s,s&&s.lastId,c,c&&c.id,e,null,new Ni(new Uint8Array(h))),s.integrate(n,0);break;case ni:s=new it(De(l,ct(a,l)),s,s&&s.lastId,c,c&&c.id,e,null,new Fi(h)),s.integrate(n,0);break;default:if(h instanceof gt)s=new it(De(l,ct(a,l)),s,s&&s.lastId,c,c&&c.id,e,null,new jn(h)),s.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Td=()=>Jn("Length exceeded!"),Md=(n,e,t,r)=>{if(t>e._length)throw Td();if(t===0)return e._searchMarker&&yi(e._searchMarker,t,r.length),fo(n,e,null,r);const s=t,i=jo(e,t);let l=e._start;for(i!==null&&(l=i.p,t-=i.index,t===0&&(l=l.prev,t+=l&&l.countable&&!l.deleted?l.length:0));l!==null;l=l.right)if(!l.deleted&&l.countable){if(t<=l.length){t<l.length&&Gn(n,De(l.id.client,l.id.clock+t));break}t-=l.length}return e._searchMarker&&yi(e._searchMarker,s,r.length),fo(n,e,l,r)},Ng=(n,e,t)=>{let s=(e._searchMarker||[]).reduce((i,l)=>l.index>i.index?l:i,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return fo(n,e,s,t)},xd=(n,e,t,r)=>{if(r===0)return;const s=t,i=r,l=jo(e,t);let a=e._start;for(l!==null&&(a=l.p,t-=l.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&Gn(n,De(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Gn(n,De(a.id.client,a.id.clock+r)),a.delete(n),r-=a.length),a=a.right;if(r>0)throw Td();e._searchMarker&&yi(e._searchMarker,s,-i+r)},go=(n,e,t)=>{const r=e._map.get(t);r!==void 0&&r.delete(n)},ta=(n,e,t,r)=>{const s=e._map.get(t)||null,i=n.doc,l=i.clientID;let a;if(r==null)a=new pr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new pr([r]);break;case Uint8Array:a=new Ni(r);break;case ni:a=new Fi(r);break;default:if(r instanceof gt)a=new jn(r);else throw new Error("Unexpected content type")}new it(De(l,ct(i.store,l)),s,s&&s.lastId,null,null,e,t,a).integrate(n,0)},na=(n,e)=>{n.doc??bt();const t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Id=n=>{const e={};return n.doc??bt(),n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Ed=(n,e)=>{n.doc??bt();const t=n._map.get(e);return t!==void 0&&!t.deleted},Fg=(n,e)=>{const t={};return n._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&Ir(i,e)&&(t[s]=i.content.getContent()[i.length-1])}),t},Hi=n=>(n.doc??bt(),tg(n._map.entries(),e=>!e[1].deleted));class Bg extends Lo{}class jr extends gt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new jr;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new jr}clone(){const e=new jr;return e.insert(0,this.toArray().map(t=>t instanceof gt?t.clone():t)),e}get length(){return this.doc??bt(),this._length}_callObserver(e,t){super._callObserver(e,t),Po(this,e,new Bg(this,e))}insert(e,t){this.doc!==null?Ke(this.doc,r=>{Md(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Ke(this.doc,t=>{Ng(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Ke(this.doc,r=>{xd(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Dd(this,e)}toArray(){return kd(this)}slice(e=0,t=this.length){return Cd(this,e,t)}toJSON(){return this.map(e=>e instanceof gt?e.toJSON():e)}map(e){return Sd(this,e)}forEach(e){bi(this,e)}[Symbol.iterator](){return Pg(this)}_write(e){e.writeTypeRef(uv)}}const zg=n=>new jr;class Kg extends Lo{constructor(e,t,r){super(e,t),this.keysChanged=r}}class Wt extends gt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Wt}clone(){const e=new Wt;return this.forEach((t,r)=>{e.set(r,t instanceof gt?t.clone():t)}),e}_callObserver(e,t){Po(this,e,new Kg(this,e,t))}toJSON(){this.doc??bt();const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const s=t.content.getContent()[t.length-1];e[r]=s instanceof gt?s.toJSON():s}}),e}get size(){return[...Hi(this)].length}keys(){return Zo(Hi(this),e=>e[0])}values(){return Zo(Hi(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Zo(Hi(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??bt(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ke(this.doc,t=>{go(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Ke(this.doc,r=>{ta(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return na(this,e)}has(e){return Ed(this,e)}clear(){this.doc!==null?Ke(this.doc,e=>{this.forEach(function(t,r,s){go(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(hv)}}const qg=n=>new Wt,Kn=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&Mf(n,e);class kl{constructor(e,t,r,s){this.left=e,this.right=t,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&_n(),this.right.content.constructor){case ot:this.right.deleted||ri(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const qa=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case ot:e.right.deleted||ri(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&Gn(n,De(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Yi=(n,e,t,r)=>{const s=new Map,i=r?jo(e,t):null;if(i){const l=new kl(i.p.left,i.p,i.index,s);return qa(n,l,t-i.index)}else{const l=new kl(null,e._start,0,s);return qa(n,l,t)}},Od=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===ot&&Kn(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();const s=n.doc,i=s.clientID;r.forEach((l,a)=>{const c=t.left,d=t.right,u=new it(De(i,ct(s.store,i)),c,c&&c.lastId,d,d&&d.id,e,null,new ot(a,l));u.integrate(n,0),t.right=u,t.forward()})},ri=(n,e)=>{const{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},Rd=(n,e)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===ot&&Kn(e[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},Ad=(n,e,t,r)=>{const s=n.doc,i=s.clientID,l=new Map;for(const a in r){const c=r[a],d=t.currentAttributes.get(a)??null;if(!Kn(d,c)){l.set(a,d);const{left:u,right:h}=t;t.right=new it(De(i,ct(s.store,i)),u,u&&u.lastId,h,h&&h.id,e,null,new ot(a,c)),t.right.integrate(n,0),t.forward()}}return l},$o=(n,e,t,r,s)=>{t.currentAttributes.forEach((v,f)=>{s[f]===void 0&&(s[f]=null)});const i=n.doc,l=i.clientID;Rd(t,s);const a=Ad(n,e,t,s),c=r.constructor===String?new yn(r):r instanceof gt?new jn(r):new Sr(r);let{left:d,right:u,index:h}=t;e._searchMarker&&yi(e._searchMarker,t.index,c.getLength()),u=new it(De(l,ct(i.store,l)),d,d&&d.lastId,u,u&&u.id,e,null,c),u.integrate(n,0),t.right=u,t.index=h,t.forward(),Od(n,e,t,a)},Va=(n,e,t,r,s)=>{const i=n.doc,l=i.clientID;Rd(t,s);const a=Ad(n,e,t,s);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===ot));){if(!t.right.deleted)switch(t.right.content.constructor){case ot:{const{key:c,value:d}=t.right.content,u=s[c];if(u!==void 0){if(Kn(u,d))a.delete(c);else{if(r===0)break e;a.set(c,d)}t.right.delete(n)}else t.currentAttributes.set(c,d);break}default:r<t.right.length&&Gn(n,De(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;t.right=new it(De(l,ct(i.store,l)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new yn(c)),t.right.integrate(n,0),t.forward()}Od(n,e,t,a)},Ud=(n,e,t,r,s)=>{let i=e;const l=At();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===ot){const d=i.content;l.set(d.key,d)}i=i.right}let a=0,c=!1;for(;e!==i;){if(t===e&&(c=!0),!e.deleted){const d=e.content;switch(d.constructor){case ot:{const{key:u,value:h}=d,v=r.get(u)??null;(l.get(u)!==d||v===h)&&(e.delete(n),a++,!c&&(s.get(u)??null)===h&&v!==h&&(v===null?s.delete(u):s.set(u,v))),!c&&!e.deleted&&ri(s,d);break}}}e=e.right}return a},Vg=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===ot){const r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},Hg=n=>{let e=0;return Ke(n.doc,t=>{let r=n._start,s=n._start,i=At();const l=ml(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case ot:ri(l,s.content);break;default:e+=Ud(t,r,s,i,l),i=ml(l),r=s;break}s=s.right}}),e},Yg=n=>{const e=new Set,t=n.doc;for(const[r,s]of n.afterState.entries()){const i=n.beforeState.get(r)||0;s!==i&&pd(n,t.store.clients.get(r),i,s,l=>{!l.deleted&&l.content.constructor===ot&&l.constructor!==Ht&&e.add(l.parent)})}Ke(t,r=>{sd(n,n.deleteSet,s=>{if(s instanceof Ht||!s.parent._hasFormatting||e.has(s.parent))return;const i=s.parent;s.content.constructor===ot?e.add(i):Vg(r,s)});for(const s of e)Hg(s)})},Ha=(n,e,t)=>{const r=t,s=ml(e.currentAttributes),i=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case jn:case Sr:case yn:t<e.right.length&&Gn(n,De(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}i&&Ud(n,i,e.right,s,e.currentAttributes);const l=(e.left||e.right).parent;return l._searchMarker&&yi(l._searchMarker,e.index,-r+t),e};class Jg extends Lo{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];Ke(e,r=>{const s=new Map,i=new Map;let l=this.target._start,a=null;const c={};let d="",u=0,h=0;const v=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof d=="object"||d.length>0)&&(f={insert:d},s.size>0&&(f.attributes={},s.forEach((g,p)=>{g!==null&&(f.attributes[p]=g)}))),d="";break;case"retain":u>0&&(f={retain:u},Df(c)||(f.attributes=Cf({},c))),u=0;break}f&&t.push(f),a=null}};for(;l!==null;){switch(l.content.constructor){case jn:case Sr:this.adds(l)?this.deletes(l)||(v(),a="insert",d=l.content.getContent()[0],v()):this.deletes(l)?(a!=="delete"&&(v(),a="delete"),h+=1):l.deleted||(a!=="retain"&&(v(),a="retain"),u+=1);break;case yn:this.adds(l)?this.deletes(l)||(a!=="insert"&&(v(),a="insert"),d+=l.content.str):this.deletes(l)?(a!=="delete"&&(v(),a="delete"),h+=l.length):l.deleted||(a!=="retain"&&(v(),a="retain"),u+=l.length);break;case ot:{const{key:f,value:g}=l.content;if(this.adds(l)){if(!this.deletes(l)){const p=s.get(f)??null;Kn(p,g)?g!==null&&l.delete(r):(a==="retain"&&v(),Kn(g,i.get(f)??null)?delete c[f]:c[f]=g)}}else if(this.deletes(l)){i.set(f,g);const p=s.get(f)??null;Kn(p,g)||(a==="retain"&&v(),c[f]=p)}else if(!l.deleted){i.set(f,g);const p=c[f];p!==void 0&&(Kn(p,g)?p!==null&&l.delete(r):(a==="retain"&&v(),g===null?delete c[f]:c[f]=g))}l.deleted||(a==="insert"&&v(),ri(s,l.content));break}}l=l.right}for(v();t.length>0;){const f=t[t.length-1];if(f.retain!==void 0&&f.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class vr extends gt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??bt(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new vr}clone(){const e=new vr;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new Jg(this,e,t);Po(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??bt();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===yn&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Ke(this.doc,r=>{const s=new kl(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const l=e[i];if(l.insert!==void 0){const a=!t&&typeof l.insert=="string"&&i===e.length-1&&s.right===null&&l.insert.slice(-1)===`
`?l.insert.slice(0,-1):l.insert;(typeof a!="string"||a.length>0)&&$o(r,this,s,a,l.attributes||{})}else l.retain!==void 0?Va(r,this,s,l.retain,l.attributes||{}):l.delete!==void 0&&Ha(r,s,l.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??bt();const s=[],i=new Map,l=this.doc;let a="",c=this._start;function d(){if(a.length>0){const h={};let v=!1;i.forEach((g,p)=>{v=!0,h[p]=g});const f={insert:a};v&&(f.attributes=h),s.push(f),a=""}}const u=()=>{for(;c!==null;){if(Ir(c,e)||t!==void 0&&Ir(c,t))switch(c.content.constructor){case yn:{const h=i.get("ychange");e!==void 0&&!Ir(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(d(),i.set("ychange",r?r("removed",c.id):{type:"removed"})):t!==void 0&&!Ir(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(d(),i.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(d(),i.delete("ychange")),a+=c.content.str;break}case jn:case Sr:{d();const h={insert:c.content.getContent()[0]};if(i.size>0){const v={};h.attributes=v,i.forEach((f,g)=>{v[g]=f})}s.push(h);break}case ot:Ir(c,e)&&(d(),ri(i,c.content));break}c=c.right}d()};return e||t?Ke(l,h=>{e&&bl(h,e),t&&bl(h,t),u()},"cleanup"):u(),s}insert(e,t,r){if(t.length<=0)return;const s=this.doc;s!==null?Ke(s,i=>{const l=Yi(i,this,e,!r);r||(r={},l.currentAttributes.forEach((a,c)=>{r[c]=a})),$o(i,this,l,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){const s=this.doc;s!==null?Ke(s,i=>{const l=Yi(i,this,e,!r);$o(i,this,l,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?Ke(r,s=>{Ha(s,Yi(s,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const s=this.doc;s!==null?Ke(s,i=>{const l=Yi(i,this,e,!1);l.right!==null&&Va(i,this,l,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Ke(this.doc,t=>{go(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Ke(this.doc,r=>{ta(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return na(this,e)}getAttributes(){return Id(this)}_write(e){e.writeTypeRef(fv)}}const Wg=n=>new vr;class el{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??bt()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===Qs||t.constructor===mr)&&t._start!==null)e=t._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class mr extends gt{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new mr}clone(){const e=new mr;return e.insert(0,this.toArray().map(t=>t instanceof gt?t.clone():t)),e}get length(){return this.doc??bt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new el(this,e)}querySelector(e){e=e.toUpperCase();const r=new el(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),On(new el(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Po(this,e,new Zg(this,t,e))}toString(){return Sd(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),bi(this,i=>{s.insertBefore(i.toDOM(e,t,r),null)}),s}insert(e,t){this.doc!==null?Ke(this.doc,r=>{Md(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Ke(this.doc,r=>{const s=e&&e instanceof gt?e._item:e;fo(r,this,s,t)});else{const r=this._prelimContent,s=e===null?0:r.findIndex(i=>i===e)+1;if(s===0&&e!==null)throw Jn("Reference item not found");r.splice(s,0,...t)}}delete(e,t=1){this.doc!==null?Ke(this.doc,r=>{xd(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return kd(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Dd(this,e)}slice(e=0,t=this.length){return Cd(this,e,t)}forEach(e){bi(this,e)}_write(e){e.writeTypeRef(vv)}}const Gg=n=>new mr;class Qs extends mr{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new Qs(this.nodeName)}clone(){const e=new Qs(this.nodeName),t=this.getAttributes();return kf(t,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof gt?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const a in e)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const c=r[a];t.push(c+'="'+e[c]+'"')}const i=this.nodeName.toLocaleLowerCase(),l=t.length>0?" "+t.join(" "):"";return`<${i}${l}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?Ke(this.doc,t=>{go(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Ke(this.doc,r=>{ta(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return na(this,e)}hasAttribute(e){return Ed(this,e)}getAttributes(e){return e?Fg(this,e):Id(this)}toDOM(e=document,t={},r){const s=e.createElement(this.nodeName),i=this.getAttributes();for(const l in i){const a=i[l];typeof a=="string"&&s.setAttribute(l,a)}return bi(this,l=>{s.appendChild(l.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(gv),e.writeKey(this.nodeName)}}const Xg=n=>new Qs(n.readKey());class Zg extends Lo{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class vo extends Wt{constructor(e){super(),this.hookName=e}_copy(){return new vo(this.hookName)}clone(){const e=new vo(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){const s=t[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(mv),e.writeKey(this.hookName)}}const Qg=n=>new vo(n.readKey());class mo extends vr{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new mo}clone(){const e=new mo;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){const s=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{const t=[];for(const s in e.attributes){const i=[];for(const l in e.attributes[s])i.push({key:l,value:e.attributes[s][l]});i.sort((l,a)=>l.key<a.key?-1:1),t.push({nodeName:s,attrs:i})}t.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<t.length;s++){const i=t[s];r+=`<${i.nodeName}`;for(let l=0;l<i.attrs.length;l++){const a=i.attrs[l];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let s=t.length-1;s>=0;s--)r+=`</${t[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(pv)}}const $g=n=>new mo;class ra{constructor(e,t){this.id=e,this.length=t}get deleted(){throw mn()}mergeWith(e){return!1}write(e,t,r){throw mn()}integrate(e,t){throw mn()}}const ev=0;class Ht extends ra{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),md(e.doc.store,this)}write(e,t){e.writeInfo(ev),e.writeLen(this.length-t)}getMissing(e,t){return null}}class Ni{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ni(this.content)}splice(e){throw mn()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}const tv=n=>new Ni(n.readBuf());class Ci{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ci(this.len)}splice(e){const t=new Ci(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){uo(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const nv=n=>new Ci(n.readLen()),Ld=(n,e)=>new ni({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Fi{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Fi(Ld(this.doc.guid,this.opts))}splice(e){throw mn()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const rv=n=>new Fi(Ld(n.readString(),n.readAny()));class Sr{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Sr(this.embed)}splice(e){throw mn()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}const sv=n=>new Sr(n.readJSON());class ot{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ot(this.key,this.value)}splice(e){throw mn()}mergeWith(e){return!1}integrate(e,t){const r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const iv=n=>new ot(n.readKey(),n.readJSON());class po{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new po(this.arr)}splice(e){const t=new po(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){const i=this.arr[s];e.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const ov=n=>{const e=n.readLen(),t=[];for(let r=0;r<e;r++){const s=n.readString();s==="undefined"?t.push(void 0):t.push(JSON.parse(s))}return new po(t)},lv=co("node_env")==="development";class pr{constructor(e){this.arr=e,lv&&Jc(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new pr(this.arr)}splice(e){const t=new pr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){const i=this.arr[s];e.writeAny(i)}}getRef(){return 8}}const av=n=>{const e=n.readLen(),t=[];for(let r=0;r<e;r++)t.push(n.readAny());return new pr(t)};class yn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new yn(this.str)}splice(e){const t=new yn(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",t.str="�"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const cv=n=>new yn(n.readString()),dv=[zg,qg,Wg,Xg,Gg,Qg,$g],uv=0,hv=1,fv=2,gv=3,vv=4,mv=5,pv=6;class jn{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new jn(this.type._copy())}splice(e){throw mn()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const _v=n=>new jn(dv[n.readTypeRef()](n)),_o=(n,e,t)=>{const{client:r,clock:s}=e.id,i=new it(De(r,s+t),e,De(r,s+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=De(e.redone.client,e.redone.clock+t)),e.right=i,i.right!==null&&(i.right.left=i),n._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=t,i};class it extends ra{constructor(e,t,r,s,i,l,a,c){super(e,c.getLength()),this.origin=r,this.left=t,this.right=s,this.rightOrigin=i,this.parent=l,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?ka:0}set marker(e){(this.info&Wo)>0!==e&&(this.info^=Wo)}get marker(){return(this.info&Wo)>0}get keep(){return(this.info&Ca)>0}set keep(e){this.keep!==e&&(this.info^=Ca)}get countable(){return(this.info&ka)>0}get deleted(){return(this.info&Jo)>0}set deleted(e){this.deleted!==e&&(this.info^=Jo)}markDeleted(){this.info|=Jo}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ct(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ct(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Lr&&this.id.client!==this.parent.client&&this.parent.clock>=ct(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Fa(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Gn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Ht||this.right&&this.right.constructor===Ht)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===it?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===it&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Lr){const r=Qo(t,this.parent);r.constructor===Ht?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=Fa(e,e.doc.store,De(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,l=new Set;for(;s!==null&&s!==this.right;){if(l.add(s),i.add(s),Vi(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(Vi(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&l.has(Qo(e.doc.store,s.origin)))i.has(Qo(e.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),md(e.doc.store,this),this.content.integrate(e,this),za(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Ht(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:De(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Vi(e.origin,this.lastId)&&this.right===e&&Vi(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),uo(e.deleteSet,this.id.client,this.id.clock,this.length),za(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw _n();this.content.gc(e),t?kg(e,this,new Ht(this.id,this.length)):this.content=new Ci(this.length)}write(e,t){const r=t>0?De(this.id.client,this.id.clock+t-1):this.origin,s=this.rightOrigin,i=this.parentSub,l=this.content.getRef()&Oo|(r===null?0:Nt)|(s===null?0:En)|(i===null?0:mi);if(e.writeInfo(l),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const d=bg(a);e.writeParentInfo(!0),e.writeString(d)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Lr?(e.writeParentInfo(!1),e.writeLeftID(a)):_n();i!==null&&e.writeString(i)}this.content.write(e,t)}}const jd=(n,e)=>wv[e&Oo](n),wv=[()=>{_n()},nv,ov,tv,cv,sv,iv,_v,av,rv,()=>{_n()}],yv=10;class Yt extends ra{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){_n()}write(e,t){e.writeInfo(yv),$(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const Pd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Nd="__ $YJS$ __";Pd[Nd]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Pd[Nd]=!0;const Fd=new Map;class bv{constructor(e){this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&this.onmessage!==null&&this.onmessage({data:zf(t.newValue||"")}),yf(this._onChange)}postMessage(e){Vc.setItem(this.room,Bf(Lf(e)))}close(){bf(this._onChange)}}const Cv=typeof BroadcastChannel>"u"?bv:BroadcastChannel,sa=n=>kn(Fd,n,()=>{const e=Yn(),t=new Cv(n);return t.onmessage=r=>e.forEach(s=>s(r.data,"broadcastchannel")),{bc:t,subs:e}}),kv=(n,e)=>(sa(n).subs.add(e),e),Sv=(n,e)=>{const t=sa(n),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),Fd.delete(n)),r},Er=(n,e,t=null)=>{const r=sa(n);r.bc.postMessage(e),r.subs.forEach(s=>s(e,t))},Bd=0,ia=1,zd=2,Sl=(n,e)=>{$(n,Bd);const t=wg(e);nt(n,t)},Kd=(n,e,t)=>{$(n,ia),nt(n,vg(e,t))},Dv=(n,e,t)=>Kd(e,t,pt(n)),qd=(n,e,t)=>{try{hg(e,pt(n),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Tv=(n,e)=>{$(n,zd),nt(n,e)},Mv=qd,xv=(n,e,t,r)=>{const s=ue(n);switch(s){case Bd:Dv(n,e,t);break;case ia:qd(n,t,r);break;case zd:Mv(n,t,r);break;default:throw new Error("Unknown message type")}return s},Iv=0,Ev=(n,e,t)=>{switch(ue(n)){case Iv:t(e,Vn(n))}},tl=3e4;class Ov extends Fh{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const t=fr();this.getLocalState()!==null&&tl/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((s,i)=>{i!==this.clientID&&tl<=t-s.lastUpdated&&this.states.has(i)&&r.push(i)}),r.length>0&&oa(this,r,"timeout")},Rn(tl/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,r=this.meta.get(t),s=r===void 0?0:r.clock+1,i=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:fr()});const l=[],a=[],c=[],d=[];e===null?d.push(t):i==null?e!=null&&l.push(t):(a.push(t),ci(i,e)||c.push(t)),(l.length>0||c.length>0||d.length>0)&&this.emit("change",[{added:l,updated:c,removed:d},"local"]),this.emit("update",[{added:l,updated:a,removed:d},"local"])}setLocalStateField(e,t){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}}const oa=(n,e,t)=>{const r=[];for(let s=0;s<e.length;s++){const i=e[s];if(n.states.has(i)){if(n.states.delete(i),i===n.clientID){const l=n.meta.get(i);n.meta.set(i,{clock:l.clock+1,lastUpdated:fr()})}r.push(i)}}r.length>0&&(n.emit("change",[{added:[],updated:[],removed:r},t]),n.emit("update",[{added:[],updated:[],removed:r},t]))},di=(n,e,t=n.states)=>{const r=e.length,s=_t();$(s,r);for(let i=0;i<r;i++){const l=e[i],a=t.get(l)||null,c=n.meta.get(l).clock;$(s,l),$(s,c),dr(s,JSON.stringify(a))}return Ze(s)},Rv=(n,e,t)=>{const r=Xn(e),s=fr(),i=[],l=[],a=[],c=[],d=ue(r);for(let u=0;u<d;u++){const h=ue(r);let v=ue(r);const f=JSON.parse(Vn(r)),g=n.meta.get(h),p=n.states.get(h),w=g===void 0?0:g.clock;(w<v||w===v&&f===null&&n.states.has(h))&&(f===null?h===n.clientID&&n.getLocalState()!=null?v++:n.states.delete(h):n.states.set(h,f),n.meta.set(h,{clock:v,lastUpdated:s}),g===void 0&&f!==null?i.push(h):g!==void 0&&f===null?c.push(h):f!==null&&(ci(f,p)||a.push(h),l.push(h)))}(i.length>0||a.length>0||c.length>0)&&n.emit("change",[{added:i,updated:a,removed:c},t]),(i.length>0||l.length>0||c.length>0)&&n.emit("update",[{added:i,updated:l,removed:c},t])},Av=n=>Sf(n,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),er=0,Vd=3,Pr=1,Uv=2,Bi=[];Bi[er]=(n,e,t,r,s)=>{$(n,er);const i=xv(e,n,t.doc,t);r&&i===ia&&!t.synced&&(t.synced=!0)};Bi[Vd]=(n,e,t,r,s)=>{$(n,Pr),nt(n,di(t.awareness,Array.from(t.awareness.getStates().keys())))};Bi[Pr]=(n,e,t,r,s)=>{Rv(t.awareness,pt(e),t)};Bi[Uv]=(n,e,t,r,s)=>{Ev(e,t.doc,(i,l)=>Lv(t,l))};const Ya=3e4,Lv=(n,e)=>console.warn(`Permission denied to access ${n.url}.
${e}`),Hd=(n,e,t)=>{const r=Xn(e),s=_t(),i=ue(r),l=n.messageHandlers[i];return l?l(s,r,n,t,i):console.error("Unable to compute message"),s},Dl=(n,e,t)=>{e===n.ws&&(n.emit("connection-close",[t,n]),n.ws=null,e.close(),n.wsconnecting=!1,n.wsconnected?(n.wsconnected=!1,n.synced=!1,oa(n.awareness,Array.from(n.awareness.getStates().keys()).filter(r=>r!==n.doc.clientID),n),n.emit("status",[{status:"disconnected"}])):n.wsUnsuccessfulReconnects++,setTimeout(Yd,Nl(Bh(2,n.wsUnsuccessfulReconnects)*100,n.maxBackoffTime),n))},Yd=n=>{if(n.shouldConnect&&n.ws===null){const e=new n._WS(n.url,n.protocols);e.binaryType="arraybuffer",n.ws=e,n.wsconnecting=!0,n.wsconnected=!1,n.synced=!1,e.onmessage=t=>{n.wsLastMessageReceived=fr();const r=Hd(n,new Uint8Array(t.data),!0);Fl(r)>1&&e.send(Ze(r))},e.onerror=t=>{n.emit("connection-error",[t,n])},e.onclose=t=>{Dl(n,e,t)},e.onopen=()=>{n.wsLastMessageReceived=fr(),n.wsconnecting=!1,n.wsconnected=!0,n.wsUnsuccessfulReconnects=0,n.emit("status",[{status:"connected"}]);const t=_t();if($(t,er),Sl(t,n.doc),e.send(Ze(t)),n.awareness.getLocalState()!==null){const r=_t();$(r,Pr),nt(r,di(n.awareness,[n.doc.clientID])),e.send(Ze(r))}},n.emit("status",[{status:"connecting"}])}},nl=(n,e)=>{const t=n.ws;n.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),n.bcconnected&&Er(n.bcChannel,e,n)};class jv extends Pc{constructor(e,t,r,{connect:s=!0,awareness:i=new Ov(r),params:l={},protocols:a=[],WebSocketPolyfill:c=WebSocket,resyncInterval:d=-1,maxBackoffTime:u=2500,disableBc:h=!1}={}){for(super();e[e.length-1]==="/";)e=e.slice(0,e.length-1);this.serverUrl=e,this.bcChannel=e+"/"+t,this.maxBackoffTime=u,this.params=l,this.protocols=a,this.roomname=t,this.doc=r,this._WS=c,this.awareness=i,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=h,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Bi.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=s,this._resyncInterval=0,d>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const v=_t();$(v,er),Sl(v,r),this.ws.send(Ze(v))}},d)),this._bcSubscriber=(v,f)=>{if(f!==this){const g=Hd(this,new Uint8Array(v),!1);Fl(g)>1&&Er(this.bcChannel,Ze(g),this)}},this._updateHandler=(v,f)=>{if(f!==this){const g=_t();$(g,er),Tv(g,v),nl(this,Ze(g))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:v,updated:f,removed:g},p)=>{const w=v.concat(f).concat(g),C=_t();$(C,Pr),nt(C,di(i,w)),nl(this,Ze(C))},this._exitHandler=()=>{oa(this.awareness,[r.clientID],"app closed")},Wn&&typeof process<"u"&&process.on("exit",this._exitHandler),i.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&Ya<fr()-this.wsLastMessageReceived&&Dl(this,this.ws,null)},Ya/10),s&&this.connect()}get url(){const e=Av(this.params);return this.serverUrl+"/"+this.roomname+(e.length===0?"":"?"+e)}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),Wn&&typeof process<"u"&&process.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(kv(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);const e=_t();$(e,er),Sl(e,this.doc),Er(this.bcChannel,Ze(e),this);const t=_t();$(t,er),Kd(t,this.doc),Er(this.bcChannel,Ze(t),this);const r=_t();$(r,Vd),Er(this.bcChannel,Ze(r),this);const s=_t();$(s,Pr),nt(s,di(this.awareness,[this.doc.clientID])),Er(this.bcChannel,Ze(s),this)}disconnectBc(){const e=_t();$(e,Pr),nt(e,di(this.awareness,[this.doc.clientID],new Map)),nl(this,Ze(e)),this.bcconnected&&(Sv(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&Dl(this,this.ws,null)}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Yd(this),this.connectBc())}}function Pv(n,e){const t=new ni,r=new jv(n,e,t,{connect:!0,maxBackoffTime:3e4,params:{}});let s=0;const i=10;let l=1e3;r.on("connection-close",()=>{s++,console.warn(`[WebSocket] Connection closed. Attempt ${s}/${i}`),s>=i?(console.error("[WebSocket] Max reconnection attempts reached. Stopping reconnection."),r.disconnect(),alert("Lost connection to server. Please refresh the page to reconnect.")):(l=Math.min(l*2,3e4),console.log(`[WebSocket] Will retry in ${l}ms`))}),r.on("status",({status:v})=>{v==="connected"&&(s=0,l=1e3,console.log("[WebSocket] Connected successfully"))});const a=t.getArray("rowOrder"),c=t.getArray("colOrder"),d=t.getMap("cells"),u=t.getMap("cardsMetadata"),h=t.getMap("shotTitles");return{doc:t,provider:r,rowOrder:a,colOrder:c,cells:d,cardsMetadata:u,shotTitles:h}}function rl(n){if(!n)return null;if(!(n instanceof Wt))return n;const e={};return n.forEach((t,r)=>{t instanceof vr?e[r]=t.toString():e[r]=t}),e}function no(n,e,t,r){let s=n.cardsMetadata.get(e);s||(s=new Wt,n.cardsMetadata.set(e,s)),s.set(t,r)}function ki(n,e,t){let r=n.cardsMetadata.get(e);r||(r=new Wt,n.cardsMetadata.set(e,r)),Object.keys(t).forEach(s=>{s!=="id"&&s!=="cardId"&&r.set(s,t[s])})}function Nv(n){const e=new Set;return n.cells.forEach(t=>{t&&t.cardId&&e.add(t.cardId)}),Array.from(e)}class Fv{constructor(e,t,r,s,i,l,a,c){this.strategy=e,this.state=t,this.userId=r,this.apiUrl=s,this.getSheet=i,this.getTimeline=l,this.getCardsMetadata=a,this.getOrientation=c}async handleUndo(){if(this.state.undoStack.length===0){console.log("[UndoRedoOperations.handleUndo] Nothing to undo");return}let e=-1;for(let s=this.state.undoStack.length-1;s>=0;s--)if(this.state.undoStack[s].userId===this.userId){e=s;break}if(e===-1){console.log("[UndoRedoOperations.handleUndo] No operations by current user to undo");return}const t=this.state.undoStack.splice(e,1)[0];console.log("[UndoRedoOperations.handleUndo] Undoing operation:",t);const r=this.getSheet();if(!r){console.log("[UndoRedoOperations.handleUndo] No sheet available");return}t.type==="move"?await this.undoMove(t,r):t.type==="delete"?await this.undoDelete(t,r):t.type==="insert"?await this.undoInsert(t,r):t.type==="edit"?await this.undoEdit(t,r):t.type==="reorderColumn"?await this.undoReorderColumn(t,r):t.type==="duplicateColumn"?await this.undoDuplicateColumn(t,r):t.type==="deleteColumn"&&await this.undoDeleteColumn(t,r)}async handleRedo(){if(this.state.redoStack.length===0){console.log("[UndoRedoOperations.handleRedo] Nothing to redo");return}let e=-1;for(let s=this.state.redoStack.length-1;s>=0;s--)if(this.state.redoStack[s].userId===this.userId){e=s;break}if(e===-1){console.log("[UndoRedoOperations.handleRedo] No operations by current user to redo");return}const t=this.state.redoStack.splice(e,1)[0];console.log("[UndoRedoOperations.handleRedo] Redoing operation:",t);const r=this.getSheet();if(!r){console.log("[UndoRedoOperations.handleRedo] No sheet available");return}t.type==="move"?await this.redoMove(t,r):t.type==="delete"?await this.redoDelete(t,r):t.type==="insert"?await this.redoInsert(t,r):t.type==="edit"?await this.redoEdit(t,r):t.type==="reorderColumn"?await this.redoReorderColumn(t,r):t.type==="duplicateColumn"?await this.redoDuplicateColumn(t,r):t.type==="deleteColumn"&&await this.redoDeleteColumn(t,r)}async undoMove(e,t){this.state.redoStack.push(e);const r=this.getOrientation(),s=r==="vertical"?e.toRow:e.toCol,i=r==="vertical"?e.toCol:e.toRow,l=r==="vertical"?e.fromRow:e.fromCol,a=r==="vertical"?e.fromCol:e.fromRow,c=this.strategy.cellKey(s,i),d=t.cells.get(c);if(!d){console.log("[UndoRedoOperations.undoMove] Card not found at target position");return}t.cells.delete(c),console.log("[UndoRedoOperations.undoMove] Removed card from:",c);const u=this.getTimeline(),h=u.indexOf(l),v=u.indexOf(s);for(let g=v+1;g<u.length;g++){const p=this.strategy.cellKey(u[g],i),w=this.strategy.cellKey(u[g-1],i),C=t.cells.get(p);C&&(t.cells.delete(p),t.cells.set(w,C))}for(let g=u.length-1;g>h;g--){const p=this.strategy.cellKey(u[g-1],a),w=this.strategy.cellKey(u[g],a),C=t.cells.get(p);C&&g<u.length&&(t.cells.delete(p),t.cells.set(w,C))}const f=this.strategy.cellKey(l,a);t.cells.set(f,d),console.log("[UndoRedoOperations.undoMove] Restored card to original position:",f)}async undoDelete(e,t){this.state.redoStack.push(e);const r=this.getOrientation(),s=r==="vertical"?e.rowId:e.colId,i=r==="vertical"?e.colId:e.rowId,l=this.getTimeline(),a=l.indexOf(s);for(let d=l.length-1;d>a;d--){const u=this.strategy.cellKey(l[d-1],i),h=this.strategy.cellKey(l[d],i),v=t.cells.get(u);v&&(t.cells.delete(u),t.cells.set(h,v))}const c=this.strategy.cellKey(s,i);t.cells.set(c,{cardId:e.cardId}),console.log("[UndoRedoOperations.undoDelete] Restored card to",c,"and shifted lane forward in time")}async undoInsert(e,t){this.state.redoStack.push(e);const r=this.getOrientation(),s=r==="vertical"?e.rowId:e.colId,i=r==="vertical"?e.colId:e.rowId,l=this.strategy.cellKey(s,i);t.cells.delete(l);const a=this.getTimeline(),c=a.indexOf(s);for(let d=c+1;d<a.length;d++){const u=this.strategy.cellKey(a[d],i),h=this.strategy.cellKey(a[d-1],i),v=t.cells.get(u);v&&(t.cells.delete(u),t.cells.set(h,v))}console.log("[UndoRedoOperations.undoInsert] Deleted inserted card from",l,"and shifted lane backward in time")}async undoEdit(e,t){if(!e.previousState)return;const s=this.getCardsMetadata().get(e.previousState.cardId);try{const i={title:e.previousState.title,color:e.previousState.color,prompt:e.previousState.prompt};"thumb_url"in e.previousState&&(i.thumb_url=e.previousState.thumb_url),"media_url"in e.previousState&&(i.media_url=e.previousState.media_url),"media_type"in e.previousState&&(i.media_type=e.previousState.media_type);const l=await fetch(`${this.apiUrl}/api/cards/${e.previousState.cardId}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(l.ok){const a=await l.json();ki(t,e.previousState.cardId,a),console.log("[UndoRedoOperations.undoEdit] Restored card edit:",e.previousState.cardId),s&&this.state.redoStack.push({type:"edit",userId:this.userId,previousState:{cardId:s.cardId,title:s.title,color:s.color,prompt:s.prompt||"",thumb_url:s.thumb_url,media_url:s.media_url,media_type:s.media_type}})}else console.error("[UndoRedoOperations.undoEdit] Failed to restore card:",l.statusText)}catch(i){console.error("[UndoRedoOperations.undoEdit] Error restoring card:",i)}}async undoReorderColumn(e,t){this.state.redoStack.push(e);const s=this.getOrientation()==="vertical"?t.colOrder:t.rowOrder,i=s.toArray(),[l]=i.splice(e.toIndex,1);i.splice(e.fromIndex,0,l),s.delete(0,s.length),s.push(i),console.log("[UndoRedoOperations.undoReorderColumn] Restored lane order",e.colId,"from",e.toIndex,"to",e.fromIndex)}async undoDuplicateColumn(e,t){this.state.redoStack.push(e);const s=this.getOrientation()==="vertical"?t.colOrder:t.rowOrder,i=s.toArray(),l=i.indexOf(e.colId);l!==-1&&(i.splice(l,1),s.delete(0,s.length),s.push(i),this.getTimeline().forEach(c=>{const d=this.strategy.cellKey(c,e.colId);t.cells.delete(d)}),console.log("[UndoRedoOperations.undoDuplicateColumn] Deleted duplicated lane",e.colId))}async undoDeleteColumn(e,t){this.state.redoStack.push(e);const s=this.getOrientation()==="vertical"?t.colOrder:t.rowOrder,i=s.toArray();i.splice(e.columnIndex,0,e.colId),s.delete(0,s.length),s.push(i),e.columnCells&&e.columnCells.forEach((l,a)=>{t.cells.set(a,{...l})}),console.log("[UndoRedoOperations.undoDeleteColumn] Restored deleted lane",e.colId)}async redoMove(e,t){this.state.undoStack.push(e);const r=this.getOrientation(),s=r==="vertical"?e.fromRow:e.fromCol,i=r==="vertical"?e.fromCol:e.fromRow,l=r==="vertical"?e.toRow:e.toCol,a=r==="vertical"?e.toCol:e.toRow,c=this.strategy.cellKey(s,i),d=t.cells.get(c);if(!d){console.log("[UndoRedoOperations.redoMove] Card not found at source position");return}t.cells.delete(c),console.log("[UndoRedoOperations.redoMove] Removed card from:",c);const u=this.getTimeline(),h=u.indexOf(s),v=u.indexOf(l);for(let g=h+1;g<u.length;g++){const p=this.strategy.cellKey(u[g],i),w=this.strategy.cellKey(u[g-1],i),C=t.cells.get(p);C&&(t.cells.delete(p),t.cells.set(w,C))}for(let g=u.length-1;g>v;g--){const p=this.strategy.cellKey(u[g-1],a),w=this.strategy.cellKey(u[g],a),C=t.cells.get(p);C&&g<u.length&&(t.cells.delete(p),t.cells.set(w,C))}const f=this.strategy.cellKey(l,a);t.cells.set(f,d),console.log("[UndoRedoOperations.redoMove] Re-moved card to:",f)}async redoDelete(e,t){this.state.undoStack.push(e);const r=this.getOrientation(),s=r==="vertical"?e.rowId:e.colId,i=r==="vertical"?e.colId:e.rowId,l=this.strategy.cellKey(s,i);t.cells.delete(l);const a=this.getTimeline(),c=a.indexOf(s);for(let d=c+1;d<a.length;d++){const u=this.strategy.cellKey(a[d],i),h=this.strategy.cellKey(a[d-1],i),v=t.cells.get(u);v&&(t.cells.delete(u),t.cells.set(h,v))}console.log("[UndoRedoOperations.redoDelete] Re-deleted card from",l,"and shifted lane up")}async redoInsert(e,t){this.state.undoStack.push(e);const r=this.getOrientation(),s=r==="vertical"?e.rowId:e.colId,i=r==="vertical"?e.colId:e.rowId,l=this.getTimeline(),a=l.indexOf(s);for(let d=l.length-1;d>a;d--){const u=this.strategy.cellKey(l[d-1],i),h=this.strategy.cellKey(l[d],i),v=t.cells.get(u);v&&(t.cells.delete(u),t.cells.set(h,v))}const c=this.strategy.cellKey(s,i);t.cells.set(c,{cardId:e.cardId}),console.log("[UndoRedoOperations.redoInsert] Re-inserted card to",c,"and shifted lane down")}async redoEdit(e,t){if(!e.previousState)return;const s=this.getCardsMetadata().get(e.previousState.cardId);try{const i={title:e.previousState.title,color:e.previousState.color,prompt:e.previousState.prompt};"thumb_url"in e.previousState&&(i.thumb_url=e.previousState.thumb_url),"media_url"in e.previousState&&(i.media_url=e.previousState.media_url),"media_type"in e.previousState&&(i.media_type=e.previousState.media_type);const l=await fetch(`${this.apiUrl}/api/cards/${e.previousState.cardId}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(l.ok){const a=await l.json();ki(t,e.previousState.cardId,a),console.log("[UndoRedoOperations.redoEdit] Reapplied card edit:",e.previousState.cardId),s&&this.state.undoStack.push({type:"edit",userId:this.userId,previousState:{cardId:s.cardId,title:s.title,color:s.color,prompt:s.prompt||"",thumb_url:s.thumb_url,media_url:s.media_url,media_type:s.media_type}})}else console.error("[UndoRedoOperations.redoEdit] Failed to reapply card:",l.statusText)}catch(i){console.error("[UndoRedoOperations.redoEdit] Error reapplying card:",i)}}async redoReorderColumn(e,t){this.state.undoStack.push(e);const s=this.getOrientation()==="vertical"?t.colOrder:t.rowOrder,i=s.toArray(),[l]=i.splice(e.fromIndex,1);i.splice(e.toIndex,0,l),s.delete(0,s.length),s.push(i),console.log("[UndoRedoOperations.redoReorderColumn] Re-reordered lane",e.colId,"from",e.fromIndex,"to",e.toIndex)}async redoDuplicateColumn(e,t){this.state.undoStack.push(e);const s=this.getOrientation()==="vertical"?t.colOrder:t.rowOrder,i=s.toArray(),l=i.indexOf(e.sourceColId);l!==-1&&(i.splice(l+1,0,e.colId),s.delete(0,s.length),s.push(i),this.getTimeline().forEach(c=>{const d=this.strategy.cellKey(c,e.sourceColId),u=t.cells.get(d);if(u){const h=this.strategy.cellKey(c,e.colId);t.cells.set(h,{...u})}}),console.log("[UndoRedoOperations.redoDuplicateColumn] Re-duplicated lane",e.sourceColId,"to",e.colId))}async redoDeleteColumn(e,t){this.state.undoStack.push(e);const s=this.getOrientation()==="vertical"?t.colOrder:t.rowOrder,i=s.toArray(),l=i.indexOf(e.colId);l!==-1&&(i.splice(l,1),s.delete(0,s.length),s.push(i),this.getTimeline().forEach(c=>{const d=this.strategy.cellKey(c,e.colId);t.cells.delete(d)}),console.log("[UndoRedoOperations.redoDeleteColumn] Re-deleted lane",e.colId))}}class Bv{constructor(e,t,r,s,i,l,a,c,d,u,h,v){this.strategy=e,this.menuState=t,this.callbacks=r,this.userId=s,this.apiUrl=i,this.getSheet=l,this.getCols=a,this.getTimeline=c,this.getCellsMap=d,this.getCardsMetadata=u,this.getShotTitles=h,this.getOrientation=v}deleteColumn(e){const t=this.getSheet();if(!t)return;const s=this.getCols().indexOf(e);if(s===-1)return;const i=this.getOrientation(),l=e,a=new Map,c=this.getTimeline();c.forEach(d=>{const u=this.strategy.cellKey(d,l),h=t.cells.get(u);h&&a.set(u,{...h})}),this.callbacks.onRecordUndo({type:"deleteColumn",userId:this.userId,colId:e,columnIndex:s,columnCells:a}),this.callbacks.onClearRedo(),c.forEach(d=>{const u=this.strategy.cellKey(d,l);t.cells.delete(u)}),t.colOrder.delete(s,1),console.log("[ColumnOperations.deleteColumn] Deleted lane:",l,"saved to undo stack")}duplicateColumn(e){const t=this.getSheet();if(!t)return;const r=t.colOrder.toArray(),s=r.indexOf(e);if(s===-1)return;const i=`c-${Date.now().toString(36)}-${Math.random().toString(36).substring(2,9)}`,l=this.getOrientation(),a=e,c=i;r.splice(s+1,0,i),t.colOrder.delete(0,t.colOrder.length),t.colOrder.push(r),this.callbacks.onRecordUndo({type:"duplicateColumn",userId:this.userId,colId:i,sourceColId:e}),this.callbacks.onClearRedo(),this.getTimeline().forEach(u=>{const h=this.strategy.cellKey(u,a),v=t.cells.get(h);if(v){const f=this.strategy.cellKey(u,c);t.cells.set(f,{...v})}}),console.log("[ColumnOperations.duplicateColumn] Duplicated lane",a,"to",c,"at index",s+1)}async handleColumnDownload(e){if(this.getSheet())try{const r=this.getOrientation(),s=e,l=this.getShotTitles().get(e)||`Shot ${e}`,a=this.getTimeline(),c=this.getCellsMap(),d=this.getCardsMetadata(),u=a.map(p=>{const w=this.strategy.cellKey(p,s),C=c.get(w),U=C==null?void 0:C.cardId;return U?d.get(U):null}).filter(p=>p!==null);if(u.length===0){this.callbacks.showToast("No cards in this column to export");return}this.callbacks.showToast("Downloading...");const h=await fetch(`${this.apiUrl}/api/columns/${e}/download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({columnCards:u,columnTitle:l})});if(!h.ok)throw new Error("Failed to generate download");const v=await h.blob(),f=window.URL.createObjectURL(v),g=document.createElement("a");g.href=f,g.download=`${l.replace(/\s+/g,"_")}.zip`,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(f),console.log("[ColumnOperations.handleColumnDownload] Downloaded column:",e),this.callbacks.showToast("Download complete!")}catch(r){console.error("[ColumnOperations.handleColumnDownload] Error downloading column:",r),this.callbacks.showToast("Failed to download column")}}toggleColumnMenu(e,t){t.stopPropagation(),this.menuState.openColumnMenu=this.menuState.openColumnMenu===e?null:e}closeColumnMenu(){this.menuState.openColumnMenu=null}}class zv{constructor(e,t,r,s,i,l,a,c,d,u){this.cardTitleDebounceTimers=new Map,this.cardTitlePreviousValues=new Map,this.strategy=e,this.modalState=t,this.callbacks=r,this.userId=s,this.apiUrl=i,this.getSheet=l,this.getTimeline=a,this.getCellsMap=c,this.getCardsMetadata=d,this.getOrientation=u}handleDeleteCard(e,t){const r=this.getSheet();if(!r)return;const s=this.getOrientation(),i=s==="vertical"?e:t,l=s==="vertical"?t:e,a=this.getTimeline();if(a.length>0&&i===a[0]){const d=this.getCellsMap(),u=a.filter(h=>{const v=this.strategy.cellKey(h,l),f=d.get(v);return f&&f.cardId}).length;this.callbacks.showConfirm(`Delete this entire lane? This will delete ${u} card${u!==1?"s":""} and cannot be undone.`,()=>{this.callbacks.onDeleteColumn?this.callbacks.onDeleteColumn(t):console.error("[CardOperations.handleDeleteCard] onDeleteColumn callback not provided")})}else{const d=this.getCellsMap(),u=this.strategy.cellKey(i,l),h=d.get(u);if(a.filter(w=>{const C=this.strategy.cellKey(w,l);return d.get(C)!==void 0}).length===1&&h&&h.cardId){const U=(s==="vertical"?r.colOrder:r.rowOrder).toArray().indexOf(l);this.callbacks.onRecordUndo({type:"deleteColumn",userId:this.userId,rowId:e,colId:t,cardId:h.cardId,columnIndex:U,columnCells:new Map([[u,{cardId:h.cardId}]])}),this.callbacks.onClearRedo(),console.log("[CardOperations.handleDeleteCard] Saved lane deletion to undo stack")}else h&&h.cardId&&(this.callbacks.onRecordUndo({type:"delete",userId:this.userId,rowId:e,colId:t,cardId:h.cardId}),this.callbacks.onClearRedo(),console.log("[CardOperations.handleDeleteCard] Saved card deletion to undo stack"));r.cells.delete(u);const f=a,g=f.indexOf(i);for(let w=g+1;w<f.length;w++){const C=this.strategy.cellKey(f[w],l),U=this.strategy.cellKey(f[w-1],l),N=r.cells.get(C);N&&(r.cells.delete(C),r.cells.set(U,N))}if(console.log("[CardOperations.handleDeleteCard] Deleted card and shifted lane up:",i,l),!f.some(w=>{const C=this.strategy.cellKey(w,l);return r.cells.get(C)!==void 0})){console.log("[CardOperations.handleDeleteCard] Lane is empty, removing:",l);const w=s==="vertical"?r.colOrder:r.rowOrder,U=w.toArray().indexOf(l);U!==-1&&(w.delete(U,1),console.log("[CardOperations.handleDeleteCard] Removed empty lane at index:",U))}}}handleCardDoubleClick(e){const r=this.getCardsMetadata().get(e);this.modalState.modalCardId=e,this.modalState.modalMediaId=`${e}_default`,this.modalState.modalTitle=(r==null?void 0:r.title)||"",this.modalState.modalColor=(r==null?void 0:r.color)||"#CCCCCC",this.modalState.modalPrompt=(r==null?void 0:r.prompt)||"",this.modalState.modalMediaUrl=(r==null?void 0:r.media_url)||null,this.modalState.modalMediaType=(r==null?void 0:r.media_type)||null,this.modalState.modalThumbUrl=(r==null?void 0:r.thumb_url)||null,this.modalState.attachments=(r==null?void 0:r.attachments)||[],this.modalState.showModal=!0,console.log("[CardOperations.handleCardDoubleClick] Opened modal for card:",e)}handleCardTitleInput(e,t){const s=this.getCardsMetadata().get(e);if(!s)return;this.cardTitlePreviousValues.has(e)||this.cardTitlePreviousValues.set(e,s.title);const i=this.getSheet();i&&no(i,e,"title",t);const l=this.cardTitleDebounceTimers.get(e);l&&clearTimeout(l);const a=setTimeout(async()=>{await this.saveCardTitleToBackend(e,t),this.cardTitleDebounceTimers.delete(e)},500);this.cardTitleDebounceTimers.set(e,a)}async handleCardTitleChange(e,t){const r=this.cardTitleDebounceTimers.get(e);r&&(clearTimeout(r),this.cardTitleDebounceTimers.delete(e)),await this.saveCardTitleToBackend(e,t)}async saveCardTitleToBackend(e,t){const r=this.cardTitlePreviousValues.get(e),i=this.getCardsMetadata().get(e);if(i){if(r&&r===t){this.cardTitlePreviousValues.delete(e);return}console.log("[CardOperations.saveCardTitleToBackend] Saving card title:",e,t),r&&(this.callbacks.onRecordUndo({type:"edit",userId:this.userId,previousState:{cardId:e,title:r,color:i.color,prompt:i.prompt||""}}),this.callbacks.onClearRedo(),this.cardTitlePreviousValues.delete(e),console.log("[CardOperations.saveCardTitleToBackend] Saved to undo stack"));try{const l=await fetch(`${this.apiUrl}/api/cards/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t,color:i.color,prompt:i.prompt||""})});l.ok?console.log("[CardOperations.saveCardTitleToBackend] Card title updated successfully"):console.error("[CardOperations.saveCardTitleToBackend] Failed to update card:",l.statusText)}catch(l){console.error("[CardOperations.saveCardTitleToBackend] Error updating card:",l)}}}async handleSetCoverImage(e){const t=this.getSheet();if(!t)return;const r=this.getCardsMetadata(),s=r.get(e);if(!s){this.callbacks.showToast("Card not found");return}const i=this.getOrientation(),l=this.getCellsMap();for(const[a,c]of l.entries())if(c.cardId===e){const[d,u]=a.split(":"),h=i==="vertical"?u:d,f=this.getTimeline()[0],g=i==="vertical"?`${f}:${h}`:`${h}:${f}`,p=l.get(g);if(p&&p.cardId){const w=p.cardId,C=r.get(w);if(C){this.callbacks.onRecordUndo({type:"edit",userId:this.userId,previousState:{cardId:w,title:C.title,color:C.color,prompt:C.prompt||"",thumb_url:C.thumb_url,media_url:C.media_url,media_type:C.media_type}}),this.callbacks.onClearRedo();let U,N;console.log("[CardOperations.handleSetCoverImage] Source card:",s),console.log("[CardOperations.handleSetCoverImage] Has thumb_url:",!!s.thumb_url),s.thumb_url?(U={thumb_url:s.thumb_url,media_url:s.media_url,media_type:s.media_type,color:s.color},N={thumb_url:s.thumb_url,media_url:s.media_url,media_type:s.media_type,color:s.color}):(U={color:s.color,thumb_url:null,media_url:null,media_type:null},N={color:s.color,thumb_url:null,media_url:null,media_type:null}),console.log("[CardOperations.handleSetCoverImage] Frozen card ID:",w),console.log("[CardOperations.handleSetCoverImage] Yjs updates:",U);const q=t.cardsMetadata.get(w);console.log("[CardOperations.handleSetCoverImage] Card map exists:",!!q),q&&(t.doc.transact(()=>{for(const[K,F]of Object.entries(U))F===null?q.has(K)&&(console.log(`[CardOperations.handleSetCoverImage] Deleting field ${K}`),q.delete(K)):(console.log(`[CardOperations.handleSetCoverImage] Setting field ${K} to`,F),q.set(K,F))}),console.log("[CardOperations.handleSetCoverImage] After update - color:",q.get("color")),console.log("[CardOperations.handleSetCoverImage] After update - thumb_url:",q.get("thumb_url")));try{console.log("[CardOperations.handleSetCoverImage] Sending to backend:",N);const K=await fetch(`${this.apiUrl}/api/cards/${w}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)});if(K.ok)console.log("[CardOperations.handleSetCoverImage] Backend update successful");else{const F=await K.text();console.error("[CardOperations.handleSetCoverImage] Backend error:",K.status,F),this.callbacks.showToast("Failed to update cover")}}catch(K){console.error("[CardOperations.handleSetCoverImage] Error:",K),this.callbacks.showToast("Failed to update cover")}}}break}}async handleDownloadCard(e){const r=this.getCardsMetadata().get(e);if(!r)return;const s=r.title||"card";if(r.media_url)try{const u=await(await fetch(r.media_url)).blob(),h=r.media_type==="video"?"mp4":"png",v=window.URL.createObjectURL(u),f=document.createElement("a");f.href=v,f.download=`${s}.${h}`,document.body.appendChild(f),f.click(),window.URL.revokeObjectURL(v),document.body.removeChild(f)}catch(d){console.error("[CardOperations.handleDownloadCard] Failed to download media:",d)}const i={cardId:r.cardId,title:r.title,color:r.color,prompt:r.prompt,media_url:r.media_url,thumb_url:r.thumb_url,media_type:r.media_type},l=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),a=window.URL.createObjectURL(l),c=document.createElement("a");c.href=a,c.download=`${s}.json`,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(a),document.body.removeChild(c),this.callbacks.showToast("Card downloaded")}}var Kv=(n,e)=>e.onSetOrientation("vertical"),qv=(n,e)=>e.onSetOrientation("horizontal"),Vv=(n,e)=>{n.stopPropagation(),e.onToggleThumbnailMenu()},Hv=B("<button> </button>"),Yv=B('<div class="thumbnail-menu svelte-alwtsq"></div>'),Jv=(n,e)=>e.onShowToast("Archive feature not yet implemented"),Wv=Cr('<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 4L6 8H3V12H6L10 16V4Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M13 8L17 12M17 8L13 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>'),Gv=Cr('<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 4L6 8H3V12H6L10 16V4Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M14 7C14.6 8 15 9.5 15 10C15 10.5 14.6 12 14 13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>'),Xv=(n,e)=>e.onToggleEllipsisMenu("toolbar"),Zv=(n,e)=>{e.onToggleStickyTopRow(),e.onToggleEllipsisMenu("toolbar")},Qv=B('<div class="ellipsis-menu svelte-alwtsq"><button class="ellipsis-menu-item svelte-alwtsq"><span class="menu-checkbox svelte-alwtsq"> </span> Sticky top row</button></div>'),$v=B('<div class="toolbar svelte-alwtsq"><div class="toolbar-left svelte-alwtsq"><span class="app-title svelte-alwtsq">Storyboard</span></div> <div class="toolbar-right svelte-alwtsq"><button class="icon-btn svelte-alwtsq" title="Undo"><svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M8 4L4 8L8 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M4 8H14C15.1046 8 16 8.89543 16 10V12C16 13.1046 15.1046 14 14 14H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <button class="icon-btn svelte-alwtsq" title="Redo"><svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M12 4L16 8L12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M16 8H6C4.89543 8 4 8.89543 4 10V12C4 13.1046 4.89543 14 6 14H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <div class="toolbar-divider svelte-alwtsq"></div> <button title="Vertical orientation"><svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="3" y="4" width="14" height="12" stroke="currentColor" stroke-width="1.5" rx="1"></rect><line x1="10" y1="4" x2="10" y2="16" stroke="currentColor" stroke-width="1.5"></line></svg></button> <button title="Horizontal orientation"><svg width="20" height="20" viewBox="0 0 20 20" fill="none"><rect x="4" y="3" width="12" height="14" stroke="currentColor" stroke-width="1.5" rx="1"></rect><line x1="4" y1="10" x2="16" y2="10" stroke="currentColor" stroke-width="1.5"></line></svg></button> <div class="toolbar-divider svelte-alwtsq"></div> <div class="thumbnail-dropdown svelte-alwtsq"><button class="btn-size-display svelte-alwtsq"> <svg width="12" height="12" viewBox="0 0 12 12" fill="none" style="margin-left: 4px;"><path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <!></div> <button class="btn-toolbar svelte-alwtsq">Archive</button> <button class="icon-btn svelte-alwtsq"><!></button> <div class="ellipsis-menu-container svelte-alwtsq"><button class="icon-btn svelte-alwtsq" title="More options"><svg width="20" height="20" viewBox="0 0 20 20" fill="none"><circle cx="10" cy="4" r="1.5" fill="currentColor"></circle><circle cx="10" cy="10" r="1.5" fill="currentColor"></circle><circle cx="10" cy="16" r="1.5" fill="currentColor"></circle></svg></button> <!></div> <button class="icon-btn svelte-alwtsq" title="Regenerate (Dev)"><svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C12.7614 3 15.1355 4.63 16.2686 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path><path d="M17 4V7H14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <div class="profile-badge svelte-alwtsq"><div class="profile-info svelte-alwtsq"><span class="plan-name svelte-alwtsq">ULTRA</span> <div class="profile-pic svelte-alwtsq">SP</div></div></div></div></div>');function em(n,e){Xt(e,!0);var t=$v(),r=E(I(t),2),s=I(r);s.__click=function(...V){var G;(G=e.onUndo)==null||G.apply(this,V)};var i=E(s,2);i.__click=function(...V){var G;(G=e.onRedo)==null||G.apply(this,V)};var l=E(i,4);let a;l.__click=[Kv,e];var c=E(l,2);let d;c.__click=[qv,e];var u=E(c,4),h=I(u);h.__click=[Vv,e];var v=I(h),f=E(h,2);{var g=V=>{var G=Yv();gn(G,21,()=>ao,Io,(Te,Ne,Fe)=>{var M=Hv();let W;M.__click=()=>e.onSelectThumbnailSize(Fe);var ne=I(M);le(Me=>{W=Rt(M,1,"thumbnail-menu-item svelte-alwtsq",null,W,Me),In(ne,o(Ne).label)},[()=>({selected:e.selectedThumbnailSize===Fe})]),T(Te,M)}),T(V,G)};Z(f,V=>{e.showThumbnailMenu&&V(g)})}var p=E(u,2);p.__click=[Jv,e];var w=E(p,2);w.__click=function(...V){var G;(G=e.onToggleSound)==null||G.apply(this,V)};var C=I(w);{var U=V=>{var G=Wv();T(V,G)},N=V=>{var G=Gv();T(V,G)};Z(C,V=>{e.isSoundMuted?V(U):V(N,!1)})}var q=E(w,2),K=I(q);K.__click=[Xv,e];var F=E(K,2);{var te=V=>{var G=Qv(),Te=I(G);Te.__click=[Zv,e];var Ne=I(Te),Fe=I(Ne);le(()=>In(Fe,e.stickyTopRow?"✓":"")),T(V,G)};Z(F,V=>{e.openEllipsisMenu==="toolbar"&&V(te)})}var J=E(q,2);J.__click=function(...V){var G;(G=e.onRegenerate)==null||G.apply(this,V)},le((V,G)=>{a=Rt(l,1,"icon-btn svelte-alwtsq",null,a,V),d=Rt(c,1,"icon-btn svelte-alwtsq",null,d,G),In(v,`${ao[e.selectedThumbnailSize].label??""} `),Ye(w,"title",e.isSoundMuted?"Unmute":"Mute")},[()=>({active:e.orientation==="vertical"}),()=>({active:e.orientation==="horizontal"})]),T(n,t),Zt()}Cn(["click"]);function tm(n,e){const t=n.target;e.onProjectNameChange&&e.onProjectNameChange(t.value)}var nm=B("<button> </button>"),rm=B('<aside class="sidebar svelte-tww6lr"><div class="project-name svelte-tww6lr"><input type="text" class="project-name-input svelte-tww6lr"/></div> <nav class="nav-sheets svelte-tww6lr"></nav></aside>');function sm(n,e){Xt(e,!0);function t(a){e.onLevelClick&&e.onLevelClick(a)}var r=rm(),s=I(r),i=I(s);i.__input=[tm,e];var l=E(s,2);gn(l,21,()=>e.levels,Io,(a,c,d)=>{var u=nm();let h;u.__click=()=>t(d);var v=I(u);le(f=>{h=Rt(u,1,"nav-item svelte-tww6lr",null,h,f),In(v,`${o(c).name??""} (${o(c).count??""})`)},[()=>({active:o(c).active})]),T(a,u)}),le(()=>{rn(i,e.projectName),Ye(i,"title",e.projectName)}),T(n,r),Zt()}Cn(["input","click"]);var im=B('<span class="breadcrumb-separator svelte-1xfbg96"><svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M4 2L8 6L4 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></span>'),om=(n,e,t)=>e(o(t)),lm=B("<!> <button> </button>",1),am=B('<nav class="breadcrumb svelte-1xfbg96"><div class="breadcrumb-container svelte-1xfbg96"></div></nav>');function cm(n,e){Xt(e,!0);function t(i){i.onclick&&i.onclick()}var r=am(),s=I(r);gn(s,21,()=>e.breadcrumbs,Io,(i,l,a)=>{var c=lm(),d=$e(c);{var u=g=>{var p=im();T(g,p)};Z(d,g=>{a>0&&g(u)})}var h=E(d,2);let v;h.__click=[om,t,l];var f=I(h);le(g=>{v=Rt(h,1,"breadcrumb-item svelte-1xfbg96",null,v,g),h.disabled=!o(l).onclick,In(f,o(l).label)},[()=>({clickable:o(l).onclick!==void 0,last:a===e.breadcrumbs.length-1})]),T(i,c)}),T(n,r),Zt()}Cn(["click"]);var dm=B('<div class="app-container svelte-3vnwe4"><!> <!> <div class="main-layout svelte-3vnwe4"><!> <main class="content svelte-3vnwe4"><!></main></div></div>');function um(n,e){Xt(e,!0);let t=k(e,"breadcrumbs",19,()=>[]);var r=dm(),s=I(r);em(s,{get selectedThumbnailSize(){return e.selectedThumbnailSize},get showThumbnailMenu(){return e.showThumbnailMenu},get isSoundMuted(){return e.isSoundMuted},get stickyTopRow(){return e.stickyTopRow},get openEllipsisMenu(){return e.openEllipsisMenu},get orientation(){return e.orientation},get onUndo(){return e.onUndo},get onRedo(){return e.onRedo},get onSetOrientation(){return e.onSetOrientation},get onRegenerate(){return e.onRegenerate},get onToggleThumbnailMenu(){return e.onToggleThumbnailMenu},get onSelectThumbnailSize(){return e.onSelectThumbnailSize},get onToggleSound(){return e.onToggleSound},get onToggleStickyTopRow(){return e.onToggleStickyTopRow},get onToggleEllipsisMenu(){return e.onToggleEllipsisMenu},get onShowToast(){return e.onShowToast}});var i=E(s,2);{var l=h=>{cm(h,{get breadcrumbs(){return t()}})};Z(i,h=>{t().length>0&&h(l)})}var a=E(i,2),c=I(a);sm(c,{get projectName(){return e.projectName},get levels(){return e.levels},get onProjectNameChange(){return e.onProjectNameChange},get onLevelClick(){return e.onLevelClick}});var d=E(c,2),u=I(d);mh(u,()=>e.children),T(n,r),Zt()}function hm(n){const e=n-1;return e*e*e+1}function Tl(n,{from:e,to:t},r={}){var{delay:s=0,duration:i=F=>Math.sqrt(F)*120,easing:l=hm}=r,a=getComputedStyle(n),c=a.transform==="none"?"":a.transform,[d,u]=a.transformOrigin.split(" ").map(parseFloat);d/=n.clientWidth,u/=n.clientHeight;var h=fm(n),v=n.clientWidth/t.width/h,f=n.clientHeight/t.height/h,g=e.left+e.width*d,p=e.top+e.height*u,w=t.left+t.width*d,C=t.top+t.height*u,U=(g-w)*v,N=(p-C)*f,q=e.width/t.width,K=e.height/t.height;return{delay:s,duration:typeof i=="function"?i(Math.sqrt(U*U+N*N)):i,easing:l,css:(F,te)=>{var J=te*U,V=te*N,G=F+te*q,Te=F+te*K;return`transform: ${c} translate(${J}px, ${V}px) scale(${G}, ${Te});`}}}function fm(n){if("currentCSSZoom"in n)return n.currentCSSZoom;for(var e=n,t=1;e!==null;)t*=+getComputedStyle(e).zoom,e=e.parentElement;return t}function gm(n,e,t){o(e)&&(n.target.closest(".video-controls")||(n.stopPropagation(),t(n)))}function vm(n){n.stopPropagation(),n.preventDefault()}var mm=B('<button class="big-play-button svelte-jebioi" title="Play"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="svelte-jebioi"><path d="M8 5v14l11-7z"></path></svg></button>'),pm=B('<button class="exit-play-mode-button svelte-jebioi" title="Exit video (Esc)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="svelte-jebioi"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></button>'),_m=Cr('<path d="M8 5v14l11-7z"></path>'),wm=Cr('<path d="M6 4h4v16H6zm8 0h4v16h-4z"></path>'),ym=Cr('<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path>'),bm=Cr('<path d="M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z"></path>'),Cm=Cr('<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path>'),km=B('<div class="video-controls svelte-jebioi"><div class="timeline-container svelte-jebioi"><div class="timeline-track svelte-jebioi"></div> <div class="timeline-progress svelte-jebioi"></div> <input type="range" class="timeline svelte-jebioi" min="0" step="0.1"/></div> <div class="controls-bar svelte-jebioi"><button class="control-button svelte-jebioi"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="svelte-jebioi"><!></svg></button> <div class="volume-control-container svelte-jebioi"><button class="control-button volume-button svelte-jebioi"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><!></svg></button> <input type="range" min="0" max="1" step="0.01"/></div> <div class="time-display svelte-jebioi"> </div></div></div>'),Sm=B('<div class="video-container svelte-jebioi" role="button" tabindex="0"><video class="card-video svelte-jebioi" playsinline=""><track kind="captions"/></video> <!> <!> <!></div>',2);function ui(n,e){Xt(e,!0);let t=null,r=P(!1),s=P(!0),i=P(!1),l=P(1),a=P(0),c=P(0),d=P(!1),u=P(!1),h=P(!1),v=P(!1),f=e.thumbnail;function g(Q){Q.stopPropagation(),S(r,!0),t&&t.play().then(()=>{S(s,!1)}).catch(y=>{console.error("[VIDEO] Play failed:",y)})}function p(Q){Q&&Q.stopPropagation(),S(r,!1),S(s,!0),t&&(t.pause(),t.currentTime=0,t.poster=f,t.load())}function w(Q){Q.key==="Escape"&&o(r)&&p()}function C(Q){Q.stopPropagation(),t&&(o(s)?t.play():t.pause())}function U(Q){Q.stopPropagation(),S(i,!o(i)),t&&(t.muted=o(i))}function N(Q){Q.stopPropagation(),t&&(t.volume=o(l),o(l)>0&&o(i)&&(S(i,!1),t.muted=!1))}function q(Q){Q.stopPropagation(),t&&(t.currentTime=o(a))}function K(Q){Q.stopPropagation(),Q.preventDefault(),S(u,!0),S(h,!o(s)),t&&!o(s)&&t.pause()}function F(Q){Q.stopPropagation(),S(u,!1),t&&o(h)&&(t.play(),S(h,!1))}function te(){S(s,!1)}function J(){S(s,!0)}function V(){!o(u)&&t&&S(a,t.currentTime,!0)}function G(){t&&S(c,t.duration,!0)}function Te(){p()}function Ne(Q){if(!isFinite(Q))return"0:00";const y=Math.floor(Q/60),A=Math.floor(Q%60);return`${y}:${A.toString().padStart(2,"0")}`}var Fe=Sm();H("keydown",hi,w),Fe.__click=[gm,r,C];var M=I(Fe);vi(M,Q=>t=Q,()=>t);var W=E(M,2);{var ne=Q=>{var y=mm();y.__click=g,T(Q,y)};Z(W,Q=>{o(r)||Q(ne)})}var Me=E(W,2);{var ce=Q=>{var y=pm();y.__click=p,T(Q,y)};Z(Me,Q=>{o(r)&&o(d)&&Q(ce)})}var pe=E(Me,2);{var Ae=Q=>{var y=km(),A=I(y),ke=E(I(A),2),me=E(ke,2);me.__input=q,me.__mousedown=K,me.__mouseup=F;var Ue=E(A,2),_e=I(Ue);_e.__click=C;var ie=I(_e),L=I(ie);{var R=se=>{var j=_m();T(se,j)},ee=se=>{var j=wm();T(se,j)};Z(L,se=>{o(s)?se(R):se(ee,!1)})}var ae=E(_e,2),et=I(ae);et.__click=U;var dt=I(et);let be;var z=I(dt);{var de=se=>{var j=ym();T(se,j)},fe=se=>{var j=ft(),we=$e(j);{var ge=Ie=>{var X=bm();T(Ie,X)},Ge=Ie=>{var X=Cm();T(Ie,X)};Z(we,Ie=>{o(l)<.5?Ie(ge):Ie(Ge,!1)},!0)}T(se,j)};Z(z,se=>{o(i)||o(l)===0?se(de):se(fe,!1)})}var xe=E(et,2);let je;xe.__input=N,xe.__mousedown=[vm];var re=E(ae,2),oe=I(re);le((se,j,we,ge)=>{ze(ke,`width: ${o(c)>0?o(a)/o(c)*100:0}%`),Ye(me,"max",o(c)||0),Ye(_e,"title",o(s)?"Play":"Pause"),Ye(et,"title",o(i)?"Unmute":"Mute"),be=Rt(dt,0,"volume-icon svelte-jebioi",null,be,se),je=Rt(xe,1,"volume-slider svelte-jebioi",null,je,j),In(oe,`${we??""} / ${ge??""}`)},[()=>({muted:o(i)}),()=>({visible:o(v)}),()=>Ne(o(a)),()=>Ne(o(c))]),H("dragstart",me,se=>se.preventDefault()),lo(me,()=>o(a),se=>S(a,se)),H("mouseenter",ae,()=>S(v,!0)),H("mouseleave",ae,()=>S(v,!1)),H("dragstart",xe,se=>se.preventDefault()),lo(xe,()=>o(l),se=>S(l,se)),T(Q,y)};Z(pe,Q=>{o(r)&&o(d)&&Q(Ae)})}le(()=>{Ye(M,"src",e.src),Ye(M,"poster",e.thumbnail),M.muted=o(i)}),H("mouseenter",Fe,()=>S(d,!0)),H("mouseleave",Fe,()=>S(d,!1)),H("play",M,te),H("pause",M,J),H("timeupdate",M,V),H("loadedmetadata",M,G),H("ended",M,Te),T(n,Fe),Zt()}Cn(["click","input","mousedown","mouseup"]);function Dm(n,e,t){var r;(r=document.getElementById(`upload-${e()}-${t()}`))==null||r.click()}var Tm=(n,e,t)=>e()(t(),n.currentTarget.value),Mm=B('<div class="shot-header-title svelte-ijtkkp"><input type="text" class="shot-title-input svelte-ijtkkp" placeholder="Shot title"/></div>'),xm=(n,e,t)=>{n.preventDefault(),e()(n,t())},Im=B('<div class="upload-loading svelte-ijtkkp"><div class="loading-spinner svelte-ijtkkp"></div></div>'),Em=B('<div class="svelte-ijtkkp"><!></div>'),Om=B('<img class="card-thumbnail svelte-ijtkkp" loading="lazy" decoding="async"/>'),Rm=(n,e,t)=>e()(t(),n.currentTarget.value),Am=(n,e,t)=>e()(t(),n.currentTarget.value),Um=n=>n.stopPropagation(),Lm=B('<div class="card-title-container svelte-ijtkkp"><input type="text" class="shot-title-input card-title-input svelte-ijtkkp"/></div>'),jm=B('<div draggable="true"><!> <!> <button class="btn-delete svelte-ijtkkp">×</button></div>'),Pm=(n,e,t,r)=>e()(n,t(),r()),Nm=B('<div class="blank-cell svelte-ijtkkp"><input type="file" accept="image/png,image/jpeg,image/jpg,image/webp,image/gif,video/mp4,video/quicktime,video/webm" multiple style="display: none" class="svelte-ijtkkp"/> <button class="cell-action-btn upload-btn svelte-ijtkkp" title="Upload media"><span class="material-symbols-outlined svelte-ijtkkp">upload</span></button> <button class="cell-action-btn generate-btn svelte-ijtkkp" title="Generate (coming soon)" disabled><span class="material-symbols-outlined svelte-ijtkkp">add</span></button></div>'),Fm=B('<div class="cell-wrapper svelte-ijtkkp"><!> <!> <!> <!></div>');function Bm(n,e){Xt(e,!1);const t=vn(),r=vn();let s=k(e,"card",8,null),i=k(e,"rowId",8),l=k(e,"colId",8),a=k(e,"cardId",8,""),c=k(e,"isFirstRow",8,!1),d=k(e,"stickyTopRow",8,!0),u=k(e,"thumbnailSize",8),h=k(e,"isDragging",8,!1),v=k(e,"draggedCard",8,null),f=k(e,"isColumnDragging",8,!1);k(e,"dragPreview",8,null);let g=k(e,"showShotHeader",8,!1),p=k(e,"shotTitle",8,""),w=k(e,"onDragStart",8),C=k(e,"onDragOver",8),U=k(e,"onDrop",8),N=k(e,"onDragEnd",8),q=k(e,"onColumnDragStart",8),K=k(e,"onColumnDragOver",8),F=k(e,"onColumnDrop",8),te=k(e,"onResetColumnDrag",8),J=k(e,"onCardDoubleClick",8),V=k(e,"onDeleteCard",8),G=k(e,"onCardTitleInput",8),Te=k(e,"onCardTitleChange",8),Ne=k(e,"onFileUpload",8),Fe=k(e,"onShotTitleChange",8),M=k(e,"onCardContextMenu",8),W=!1,ne=null,Me=0;function ce(ie){ie.stopPropagation();const L=Date.now();L-Me<300||(Me=L,V()(i(),l()),W=!0,ne&&clearTimeout(ne),ne=setTimeout(()=>{W=!1},800))}function pe(){W||J()(a())}Gs(()=>(b(h()),b(v()),b(a())),()=>{var ie;S(t,h()&&((ie=v())==null?void 0:ie.cardId)===a())}),Gs(()=>(b(d()),b(c())),()=>{S(r,!d()&&c())}),Mo(),Eo();var Ae=Fm(),Q=I(Ae);{var y=ie=>{var L=Mm(),R=I(L);R.__change=[Tm,Fe,l],le(()=>rn(R,p())),T(ie,L)};Z(Q,ie=>{g()&&ie(y)})}var A=E(Q,2);Z(A,ie=>{});var ke=E(A,2);{var me=ie=>{var L=jm();L.__dblclick=pe,L.__contextmenu=[xm,M,a];var R=I(L);{var ee=z=>{var de=Im();T(z,de)},ae=z=>{var de=ft(),fe=$e(de);{var xe=re=>{var oe=Em(),se=I(oe);ui(se,{get src(){return b(s()),_(()=>s().media_url)},get thumbnail(){return b(s()),_(()=>s().thumb_url)}}),H("dragstart",oe,j=>j.preventDefault()),T(re,oe)},je=re=>{var oe=ft(),se=$e(oe);{var j=we=>{var ge=Om();le(()=>{Ye(ge,"src",(b(s()),_(()=>s().thumb_url))),Ye(ge,"alt",(b(s()),_(()=>s().title)))}),H("dragstart",ge,Ge=>Ge.preventDefault()),T(we,ge)};Z(se,we=>{b(s()),_(()=>s().thumb_url)&&we(j)},!0)}T(re,oe)};Z(fe,re=>{b(s()),_(()=>s().media_type==="video"&&s().media_url&&s().thumb_url)?re(xe):re(je,!1)},!0)}T(z,de)};Z(R,z=>{b(s()),_(()=>s().isLoading)?z(ee):z(ae,!1)})}var et=E(R,2);{var dt=z=>{var de=Lm(),fe=I(de);fe.__input=[Rm,G,a],fe.__change=[Am,Te,a],fe.__click=[Um],le(()=>rn(fe,(b(s()),_(()=>s().title)))),T(z,de)};Z(et,z=>{b(s()),_(()=>!s().thumb_url&&!s().media_url&&!s().isLoading)&&z(dt)})}var be=E(et,2);be.__click=ce,le(()=>{Rt(L,1,`shot-card ${o(t)?"dragging":""} ${o(r)?"column-drag-handle":""}`,"svelte-ijtkkp"),ze(L,`background-color: ${b(s()),_(()=>s().thumb_url?"rgba(0, 0, 0, 0.3)":s().color)??""}; width: ${b(u()),_(()=>u().width)??""}px; height: ${b(u()),_(()=>u().height)??""}px`)}),H("dragstart",L,z=>o(r)?q()(z,l()):w()(z,i(),l(),a())),H("dragover",L,z=>{if(f()){z.preventDefault();return}o(r)?K()(z,l()):C()(z,i(),l(),z.currentTarget)}),H("drop",L,z=>{f()||(z.stopPropagation(),o(r)?F()(z,l()):U()(z,i(),l()))}),H("dragend",L,z=>o(r)?te()():N()(z)),T(ie,L)},Ue=ie=>{var L=Nm(),R=I(L);R.__change=[Pm,Ne,i,l];var ee=E(R,2);ee.__click=[Dm,i,l],le(()=>{ze(L,`width: ${b(u()),_(()=>u().width)??""}px; height: ${b(u()),_(()=>u().height)??""}px`),Ye(R,"id",`upload-${i()??""}-${l()??""}`)}),H("dragover",L,ae=>{if(f()){ae.preventDefault();return}C()(ae,i(),l(),ae.currentTarget)}),H("drop",L,ae=>{f()||U()(ae,i(),l())}),T(ie,L)};Z(ke,ie=>{s()?ie(me):ie(Ue,!1)})}var _e=E(ke,2);Z(_e,ie=>{}),le(()=>{Ye(Ae,"data-row",i()),Ye(Ae,"data-col",l())}),T(n,Ae),Zt()}Cn(["change","dblclick","contextmenu","input","click"]);var zm=B('<div class="column-drop-indicator svelte-1x2zv65"></div>'),Km=(n,e,t)=>e()(t(),n.currentTarget.value),qm=(n,e,t)=>e()(t(),n),Vm=n=>n.stopPropagation(),Hm=(n,e,t,r)=>{e()(t()),r()()},Ym=(n,e,t,r)=>{e()(t()),r()()},Jm=(n,e,t,r)=>{e()(t()),r()()},Wm=B('<div class="column-dropdown-menu svelte-1x2zv65"><button class="menu-item svelte-1x2zv65"><span class="material-symbols-outlined svelte-1x2zv65">content_copy</span> <span class="svelte-1x2zv65">Duplicate</span></button> <button class="menu-item svelte-1x2zv65"><span class="material-symbols-outlined svelte-1x2zv65">comment</span> <span class="svelte-1x2zv65">Comment</span></button> <button class="menu-item svelte-1x2zv65"><span class="material-symbols-outlined svelte-1x2zv65">file_download</span> <span class="svelte-1x2zv65">Download</span></button> <button class="menu-item delete-item svelte-1x2zv65"><span class="material-symbols-outlined svelte-1x2zv65">delete</span> <span class="svelte-1x2zv65">Delete</span></button></div>'),Gm=B('<div class="shot-header-title svelte-1x2zv65"><input type="text" class="shot-title-input svelte-1x2zv65" placeholder="Shot title"/> <div class="shot-header-menu svelte-1x2zv65"><button class="icon-btn-header menu-btn svelte-1x2zv65" title="Column options"><span class="material-symbols-outlined svelte-1x2zv65">more_vert</span></button> <!></div></div>'),Xm=B("<!> <!>",1),Zm=B("<div><!></div>"),Qm=B('<div class="column-drop-indicator svelte-1x2zv65"></div>'),$m=B('<div class="column-wrapper svelte-1x2zv65"><!> <div></div> <!></div>');function ep(n,e){Xt(e,!1);const t=vn();let r=k(e,"colId",8),s=k(e,"colIndex",8),i=k(e,"displayRows",8),l=k(e,"stickyTopRow",8,!0),a=k(e,"rows",8),c=k(e,"cellsMap",8),d=k(e,"cardsMetadata",8),u=k(e,"thumbnailSize",8),h=k(e,"shotTitles",8),v=k(e,"draggedColumn",8),f=k(e,"isColumnDragging",8),g=k(e,"columnDragPreview",8),p=k(e,"isDragging",8),w=k(e,"draggedCard",8),C=k(e,"dragPreview",8),U=k(e,"openColumnMenu",8),N=k(e,"onColumnDragStart",8),q=k(e,"onColumnDragOver",8),K=k(e,"onColumnDrop",8),F=k(e,"onResetColumnDrag",8),te=k(e,"onDragStart",8),J=k(e,"onDragOver",8),V=k(e,"onDrop",8),G=k(e,"onDragEnd",8),Te=k(e,"onCardDoubleClick",8),Ne=k(e,"onDeleteCard",8),Fe=k(e,"onCardTitleInput",8),M=k(e,"onCardTitleChange",8),W=k(e,"onFileUpload",8),ne=k(e,"onShotTitleChange",8),Me=k(e,"onToggleColumnMenu",8),ce=k(e,"onCloseColumnMenu",8),pe=k(e,"onDuplicateColumn",8),Ae=k(e,"onDeleteColumn",8),Q=k(e,"onColumnDownload",8),y=k(e,"onCardContextMenu",8);function A(R,ee){return`${R}:${ee}`}Gs(()=>(b(p()),b(C()),b(w()),b(l()),b(i()),b(r())),()=>{S(t,(()=>{if(!p()||!C()||!w())return l()?i().slice(1):i();if(C().targetLane!==r())return w().laneId===r()?(l()?i().slice(1):i()).filter(be=>be!==w().timeId):l()?i().slice(1):i();const R=l()?i().slice(1):i(),ee=R.indexOf(C().targetTime),ae=C().insertBefore?ee:ee+1;if(w().laneId===r()){const dt=R.indexOf(w().timeId);if(Math.abs(ae-dt)<=1)return R}const et=[...R];return ae>=0&&ae<=et.length&&et.splice(ae,0,`virtual-${w().cardId}`),et})())}),Mo(),Eo();var ke=$m(),me=I(ke);{var Ue=R=>{var ee=zm();le(()=>ze(ee,`min-width: ${b(u()),_(()=>u().width)??""}px;`)),H("dragover",ee,ae=>{ae.preventDefault(),q()(ae,r())}),H("drop",ee,ae=>K()(ae,r())),T(R,ee)};Z(me,R=>{b(g()),b(s()),_(()=>g()&&g().targetColIndex===s()&&g().insertBefore)&&R(Ue)})}var _e=E(me,2);gn(_e,13,()=>o(t),R=>R,(R,ee)=>{const ae=He(()=>(o(ee),_(()=>o(ee).startsWith("virtual-")))),et=He(()=>(o(ee),b(r()),_(()=>A(o(ee),r())))),dt=He(()=>(b(c()),b(o(et)),_(()=>c().get(o(et))))),be=He(()=>(b(o(dt)),_(()=>{var re;return(re=o(dt))==null?void 0:re.cardId}))),z=He(()=>(b(o(be)),b(d()),_(()=>o(be)?d().get(o(be)):null))),de=He(()=>(o(ee),b(a()),_(()=>o(ee)===a()[0])));var fe=Zm(),xe=I(fe);{var je=re=>{var oe=Xm(),se=$e(oe);{var j=ge=>{var Ge=Gm(),Ie=I(Ge);Ie.__change=[Km,ne,r];var X=E(Ie,2),ve=I(X);ve.__click=[qm,Me,r];var tt=E(ve,2);{var qe=rt=>{var Ve=Wm();Ve.__click=[Vm];var Ct=I(Ve);Ct.__click=[Hm,pe,r,ce];var Je=E(Ct,2);Je.__click=function(...Oe){var he;(he=ce())==null||he.apply(this,Oe)};var Pe=E(Je,2);Pe.__click=[Ym,Q,r,ce];var Ee=E(Pe,2);Ee.__click=[Jm,Ae,r,ce],T(rt,Ve)};Z(tt,rt=>{U()===r()&&rt(qe)})}le(rt=>rn(Ie,rt),[()=>(b(h()),b(r()),_(()=>h().get(r())||`Shot ${r().replace("c-","").replace("media","1").replace("alt","2").replace("notes","3")}`))]),T(ge,Ge)};Z(se,ge=>{b(l()),b(o(de)),b(r()),_(()=>!l()&&o(de)&&!r().startsWith("phantom-"))&&ge(j)})}var we=E(se,2);Bm(we,{get card(){return o(z)},get rowId(){return o(ee)},get colId(){return r()},get cardId(){return o(be)},get isFirstRow(){return o(de)},get stickyTopRow(){return l()},get thumbnailSize(){return u()},get isDragging(){return p()},get draggedCard(){return w()},get isColumnDragging(){return f()},get dragPreview(){return C()},showShotHeader:!1,shotTitle:"",onDragStart:(ge,Ge,Ie,X)=>!l()&&o(de)?N()(ge,r()):te()(ge,Ge,Ie,X),onDragOver:(ge,Ge,Ie,X)=>{if(f()){ge.preventDefault();return}!l()&&o(de)?q()(ge,r()):J()(ge,Ge,Ie,X)},onDrop:(ge,Ge,Ie)=>{f()||(!l()&&o(de)?K()(ge,r()):V()(ge,Ge,Ie))},onDragEnd:ge=>!l()&&o(de)?F()():G()(ge),get onColumnDragStart(){return N()},get onColumnDragOver(){return q()},get onColumnDrop(){return K()},get onResetColumnDrag(){return F()},get onCardDoubleClick(){return Te()},get onDeleteCard(){return Ne()},get onCardTitleInput(){return Fe()},get onCardTitleChange(){return M()},get onFileUpload(){return W()},get onShotTitleChange(){return ne()},get onCardContextMenu(){return y()}}),T(re,oe)};Z(xe,re=>{o(ae)||re(je)})}le(()=>{Rt(fe,1,o(ae)?"drag-placeholder-space":"card-animation-wrapper","svelte-1x2zv65"),ze(fe,(b(o(ae)),b(u()),_(()=>o(ae)?`width: ${u().width}px; height: ${u().height}px`:"")))}),H("dragover",fe,re=>{o(ae)&&re.preventDefault()}),H("drop",fe,re=>{o(ae)&&(re.preventDefault(),re.stopPropagation(),V()(re,o(ee),r()))}),vl(fe,()=>Tl,()=>({duration:o(ae)?0:300})),T(R,fe)});var ie=E(_e,2);{var L=R=>{var ee=Qm();le(()=>ze(ee,`min-width: ${b(u()),_(()=>u().width)??""}px;`)),H("dragover",ee,ae=>{ae.preventDefault(),q()(ae,r())}),H("drop",ee,ae=>K()(ae,r())),T(R,ee)};Z(ie,R=>{b(g()),b(s()),_(()=>g()&&g().targetColIndex===s()&&!g().insertBefore)&&R(L)})}le(()=>{Rt(_e,1,`column ${v()===r()?"column-dragging":""}`,"svelte-1x2zv65"),ze(_e,`width: ${b(u()),_(()=>u().width)??""}px; gap: ${b(u()),_(()=>u().width*.035)??""}px`)}),H("dragover",_e,R=>q()(R,r())),H("drop",_e,R=>K()(R,r())),T(n,ke),Zt()}Cn(["change","click"]);var tp=B('<div class="column-drop-indicator svelte-otng0r"></div>'),np=(n,e,t)=>e()(o(t),n.currentTarget.value),rp=(n,e,t)=>e()(o(t),n),sp=n=>n.stopPropagation(),ip=(n,e,t,r)=>{e()(o(t)),r()()},op=(n,e,t,r)=>{e()(o(t)),r()()},lp=(n,e,t,r)=>{e()(o(t)),r()()},ap=B('<div class="column-dropdown-menu svelte-otng0r"><button class="menu-item svelte-otng0r"><span class="material-symbols-outlined svelte-otng0r">content_copy</span> <span class="svelte-otng0r">Duplicate</span></button> <button class="menu-item svelte-otng0r"><span class="material-symbols-outlined svelte-otng0r">comment</span> <span class="svelte-otng0r">Comment</span></button> <button class="menu-item svelte-otng0r"><span class="material-symbols-outlined svelte-otng0r">file_download</span> <span class="svelte-otng0r">Download</span></button> <button class="menu-item delete-item svelte-otng0r"><span class="material-symbols-outlined svelte-otng0r">delete</span> <span class="svelte-otng0r">Delete</span></button></div>'),cp=B('<div class="shot-header-menu svelte-otng0r"><button class="icon-btn-header menu-btn svelte-otng0r" title="Column options"><span class="material-symbols-outlined svelte-otng0r">more_vert</span></button> <!></div>'),dp=(n,e,t)=>e()(o(t)),up=B('<div class="upload-loading svelte-otng0r"><div class="loading-spinner svelte-otng0r"></div></div>'),hp=B('<div class="svelte-otng0r"><!></div>'),fp=B('<img class="card-thumbnail svelte-otng0r" loading="lazy" decoding="async"/>'),gp=(n,e,t)=>e()(o(t),n.currentTarget.value),vp=(n,e,t)=>e()(o(t),n.currentTarget.value),mp=n=>n.stopPropagation(),pp=B('<div class="card-title-container svelte-otng0r"><input type="text" class="shot-title-input card-title-input svelte-otng0r"/></div>'),_p=(n,e,t,r)=>e(n,o(t),o(r)),wp=B('<div class="shot-card column-drag-handle svelte-otng0r" draggable="true"><!> <!> <button class="btn-delete svelte-otng0r">×</button></div>'),yp=B('<div class="column-drop-indicator svelte-otng0r"></div>'),bp=B('<div class="column-wrapper svelte-otng0r"><!> <div><div class="shot-header-title svelte-otng0r"><input type="text" class="shot-title-input svelte-otng0r"/> <!></div> <!></div> <!></div>'),Cp=B('<div class="frozen-row svelte-otng0r"></div>'),kp=B('<!> <div class="columns-container svelte-otng0r"></div>',1),Sp=(n,e,t)=>e()(o(t),n.currentTarget.value),Dp=(n,e,t)=>e()(o(t)),Tp=(n,e,t)=>e()(n,o(t)),Mp=B('<div class="upload-loading svelte-otng0r"><div class="loading-spinner svelte-otng0r"></div></div>'),xp=B('<div class="svelte-otng0r"><!></div>'),Ip=B('<img class="card-thumbnail svelte-otng0r" loading="lazy" decoding="async"/>'),Ep=(n,e,t)=>e()(o(t),n.currentTarget.value),Op=(n,e,t)=>e()(o(t),n.currentTarget.value),Rp=n=>n.stopPropagation(),Ap=B('<div class="card-title-container svelte-otng0r"><input type="text" class="shot-title-input card-title-input svelte-otng0r"/></div>'),Up=(n,e,t,r)=>e(n,o(t),o(r)),Lp=B('<div class="shot-card svelte-otng0r" draggable="true"><!> <!> <button class="btn-delete svelte-otng0r">×</button></div>'),jp=(n,e,t,r)=>e()(n,o(t),o(r)),Pp=B('<div class="empty-cell svelte-otng0r"><label class="upload-label svelte-otng0r"><input type="file" accept="image/*,video/*" class="svelte-otng0r"/> <span class="material-symbols-outlined svelte-otng0r">add_photo_alternate</span></label></div>'),Np=B('<div class="lane-header-row svelte-otng0r"><div class="lane-title svelte-otng0r"><input type="text" class="shot-title-input horizontal-title svelte-otng0r"/></div> <!></div>'),Fp=B('<div class="frozen-column svelte-otng0r"></div>'),Bp=(n,e,t)=>e()(o(t)),zp=(n,e,t)=>e()(n,o(t)),Kp=B('<div class="upload-loading svelte-otng0r"><div class="loading-spinner svelte-otng0r"></div></div>'),qp=B('<div class="svelte-otng0r"><!></div>'),Vp=B('<img class="card-thumbnail svelte-otng0r" loading="lazy" decoding="async"/>'),Hp=(n,e,t)=>e()(o(t),n.currentTarget.value),Yp=(n,e,t)=>e()(o(t),n.currentTarget.value),Jp=n=>n.stopPropagation(),Wp=B('<div class="card-title-container svelte-otng0r"><input type="text" class="shot-title-input card-title-input svelte-otng0r"/></div>'),Gp=(n,e,t,r)=>e(n,o(t),o(r)),Xp=B('<div class="shot-card svelte-otng0r" draggable="true"><!> <!> <button class="btn-delete svelte-otng0r">×</button></div>'),Zp=(n,e,t,r)=>e()(n,o(t),o(r)),Qp=B('<div class="empty-cell svelte-otng0r"><label class="upload-label svelte-otng0r"><input type="file" accept="image/*,video/*" class="svelte-otng0r"/> <span class="material-symbols-outlined svelte-otng0r">add_photo_alternate</span></label></div>'),$p=B("<div><!></div>"),e_=B('<div class="horizontal-row svelte-otng0r"></div>'),t_=B('<div class="horizontal-container svelte-otng0r"><!> <div class="rows-container svelte-otng0r"></div></div>'),n_=B('<div class="sheet-view svelte-otng0r"><!></div>');function r_(n,e){Xt(e,!1);const t=vn(),r=vn();let s=k(e,"displayCols",8),i=k(e,"displayRows",8),l=k(e,"rows",8),a=k(e,"stickyTopRow",8),c=k(e,"orientation",8,"vertical"),d=k(e,"cellsMap",8),u=k(e,"cardsMetadata",8),h=k(e,"thumbnailSize",8),v=k(e,"shotTitles",8),f=k(e,"draggedColumn",8),g=k(e,"isColumnDragging",8),p=k(e,"columnDragPreview",8),w=k(e,"isDragging",8),C=k(e,"draggedCard",8),U=k(e,"dragPreview",8),N=k(e,"openColumnMenu",8),q=k(e,"timeline",8),K=k(e,"frozenRowRef",12,null),F=k(e,"columnsContainerRef",12,null),te=k(e,"onSyncColumnsScroll",8),J=k(e,"onColumnDragStart",8),V=k(e,"onColumnDragOver",8),G=k(e,"onColumnDrop",8),Te=k(e,"onResetColumnDrag",8),Ne=k(e,"onDragStart",8),Fe=k(e,"onDragOver",8),M=k(e,"onDrop",8),W=k(e,"onDragEnd",8),ne=k(e,"onCardDoubleClick",8),Me=k(e,"onDeleteCard",8),ce=k(e,"onCardTitleInput",8),pe=k(e,"onCardTitleChange",8),Ae=k(e,"onFileUpload",8),Q=k(e,"onShotTitleChange",8),y=k(e,"onToggleColumnMenu",8),A=k(e,"onCloseColumnMenu",8),ke=k(e,"onDuplicateColumn",8),me=k(e,"onDeleteColumn",8),Ue=k(e,"onColumnDownload",8),_e=k(e,"onCardContextMenu",8);function ie(z,de){return`${z}:${de}`}let L=0;function R(z,de,fe){z.stopPropagation();const xe=Date.now();xe-L<300||(L=xe,Me()(de,fe))}function ee(z){F()&&Math.abs(z.deltaY)>0&&(z.preventDefault(),F(F().scrollTop+=z.deltaY,!0))}Gs(()=>b(h()),()=>{S(t,h().width*.05)}),Gs(()=>(b(s()),b(a()),b(i()),b(w()),b(U()),b(C())),()=>{S(r,(()=>{const z=new Map;return s().forEach(de=>{const fe=a()?i().slice(1):i();if(!w()||!U()||!C()){z.set(de,fe);return}if(U().targetLane!==de){C().laneId===de?z.set(de,fe.filter(oe=>oe!==C().timeId)):z.set(de,fe);return}const xe=fe.indexOf(U().targetTime),je=U().insertBefore?xe:xe+1;if(C().laneId===de){const oe=fe.indexOf(C().timeId);if(Math.abs(je-oe)<=1){z.set(de,fe);return}}const re=[...fe];je>=0&&je<=re.length&&re.splice(je,0,`virtual-${C().cardId}`),z.set(de,re)}),z})())}),Mo(),Eo();var ae=n_(),et=I(ae);{var dt=z=>{var de=kp(),fe=$e(de);{var xe=re=>{var oe=Cp();gn(oe,15,s,se=>se,(se,j,we)=>{var ge=bp(),Ge=I(ge);{var Ie=Ee=>{var Oe=tp();le(()=>ze(Oe,`min-width: ${b(h()),_(()=>h().width)??""}px;`)),H("dragover",Oe,he=>{he.preventDefault(),V()(he,o(j))}),H("drop",Oe,he=>{console.log("[frozen drop indicator before ondrop]"),G()(he,o(j))}),T(Ee,Oe)};Z(Ge,Ee=>{b(p()),b(o(we)),_(()=>p()&&p().targetColIndex===o(we)&&p().insertBefore)&&Ee(Ie)})}var X=E(Ge,2),ve=I(X),tt=I(ve);tt.__change=[np,Q,j];var qe=E(tt,2);{var rt=Ee=>{var Oe=cp(),he=I(Oe);he.__click=[rp,y,j];var Bt=E(he,2);{var Mt=ye=>{var Le=ap();Le.__click=[sp];var ut=I(Le);ut.__click=[ip,ke,j,A];var Ut=E(ut,2);Ut.__click=function(...lt){var Lt;(Lt=A())==null||Lt.apply(this,lt)};var Re=E(Ut,2);Re.__click=[op,Ue,j,A];var Xe=E(Re,2);Xe.__click=[lp,me,j,A],T(ye,Le)};Z(Bt,ye=>{N()===o(j)&&ye(Mt)})}T(Ee,Oe)};Z(qe,Ee=>{o(j),_(()=>!o(j).startsWith("phantom-"))&&Ee(rt)})}var Ve=E(ve,2);{var Ct=Ee=>{const Oe=He(()=>(b(q()),_(()=>q()[0]))),he=He(()=>(b(o(Oe)),o(j),_(()=>ie(o(Oe),o(j))))),Bt=He(()=>(b(d()),b(o(he)),_(()=>d().get(o(he))))),Mt=He(()=>(b(o(Bt)),_(()=>{var Re;return(Re=o(Bt))==null?void 0:Re.cardId}))),ye=He(()=>(b(o(Mt)),b(u()),_(()=>o(Mt)?u().get(o(Mt)):null)));var Le=ft(),ut=$e(Le);{var Ut=Re=>{var Xe=wp();Xe.__dblclick=[dp,ne,Mt];var lt=I(Xe);{var Lt=We=>{var xt=up();T(We,xt)},Zn=We=>{var xt=ft(),Qt=$e(xt);{var No=Dr=>{var Tr=hp(),Fo=I(Tr);ui(Fo,{get src(){return b(o(ye)),_(()=>o(ye).media_url)},get thumbnail(){return b(o(ye)),_(()=>o(ye).thumb_url)}}),H("dragstart",Tr,Bo=>Bo.preventDefault()),T(Dr,Tr)},Jd=Dr=>{var Tr=ft(),Fo=$e(Tr);{var Bo=zo=>{var zi=fp();le(()=>{Ye(zi,"src",(b(o(ye)),_(()=>o(ye).thumb_url))),Ye(zi,"alt",(b(o(ye)),_(()=>o(ye).title)))}),H("dragstart",zi,Wd=>Wd.preventDefault()),T(zo,zi)};Z(Fo,zo=>{b(o(ye)),_(()=>o(ye).thumb_url)&&zo(Bo)},!0)}T(Dr,Tr)};Z(Qt,Dr=>{b(o(ye)),_(()=>o(ye).media_type==="video"&&o(ye).media_url&&o(ye).thumb_url)?Dr(No):Dr(Jd,!1)},!0)}T(We,xt)};Z(lt,We=>{b(o(ye)),_(()=>o(ye).isLoading)?We(Lt):We(Zn,!1)})}var jt=E(lt,2);{var zt=We=>{var xt=pp(),Qt=I(xt);Qt.__input=[gp,ce,Mt],Qt.__change=[vp,pe,Mt],Qt.__click=[mp],le(()=>rn(Qt,(b(o(ye)),_(()=>o(ye).title)))),T(We,xt)};Z(jt,We=>{b(o(ye)),_(()=>!o(ye).thumb_url&&!o(ye).media_url&&!o(ye).isLoading)&&We(zt)})}var on=E(jt,2);on.__click=[_p,R,Oe,j],le(()=>ze(Xe,`background-color: ${b(o(ye)),_(()=>o(ye).thumb_url?"rgba(0, 0, 0, 0.3)":o(ye).color)??""}; width: ${b(h()),_(()=>h().width)??""}px; height: ${b(h()),_(()=>h().height)??""}px`)),H("dragstart",Xe,We=>J()(We,o(j))),H("dragover",Xe,We=>V()(We,o(j))),H("drop",Xe,We=>G()(We,o(j))),H("dragend",Xe,function(...We){var xt;(xt=Te())==null||xt.apply(this,We)}),T(Re,Xe)};Z(ut,Re=>{o(ye)&&Re(Ut)})}T(Ee,Le)};Z(Ve,Ee=>{b(q()),_(()=>q().length>0)&&Ee(Ct)})}var Je=E(X,2);{var Pe=Ee=>{var Oe=yp();le(()=>ze(Oe,`min-width: ${b(h()),_(()=>h().width)??""}px;`)),H("dragover",Oe,he=>{he.preventDefault(),V()(he,o(j))}),H("drop",Oe,he=>{console.log("[drop indicator after ondrop]"),G()(he,o(j))}),T(Ee,Oe)};Z(Je,Ee=>{b(p()),b(o(we)),_(()=>p()&&p().targetColIndex===o(we)&&!p().insertBefore)&&Ee(Pe)})}le((Ee,Oe,he)=>{Rt(X,1,`shot-column ${f()===o(j)?"column-dragging":""}`,"svelte-otng0r"),ze(X,`width: ${b(h()),_(()=>h().width)??""}px`),rn(tt,Ee),Ye(tt,"placeholder",Oe),tt.disabled=he},[()=>(o(j),b(v()),_(()=>o(j).startsWith("phantom-")?"":v().get(o(j))||`Shot ${o(j).replace("c-","").replace("media","1").replace("alt","2").replace("notes","3")}`)),()=>(o(j),_(()=>o(j).startsWith("phantom-")?"New column":"Shot title")),()=>(o(j),_(()=>o(j).startsWith("phantom-")))]),H("dragover",X,Ee=>V()(Ee,o(j))),H("drop",X,Ee=>G()(Ee,o(j))),vl(ge,()=>Tl,()=>({duration:300})),T(se,ge)}),vi(oe,se=>K(se),()=>K()),le(()=>ze(oe,`gap: ${o(t)??""}px`)),H("scroll",oe,function(...se){var j;(j=te())==null||j.apply(this,se)}),H("wheel",oe,ee),T(re,oe)};Z(fe,re=>{a()&&re(xe)})}var je=E(fe,2);gn(je,7,s,re=>re,(re,oe,se)=>{ep(re,{get colId(){return o(oe)},get colIndex(){return o(se)},get displayRows(){return i()},get stickyTopRow(){return a()},get rows(){return l()},get cellsMap(){return d()},get cardsMetadata(){return u()},get thumbnailSize(){return h()},get shotTitles(){return v()},get draggedColumn(){return f()},get isColumnDragging(){return g()},get columnDragPreview(){return p()},get isDragging(){return w()},get draggedCard(){return C()},get dragPreview(){return U()},get openColumnMenu(){return N()},get onColumnDragStart(){return J()},get onColumnDragOver(){return V()},get onColumnDrop(){return G()},get onResetColumnDrag(){return Te()},get onDragStart(){return Ne()},get onDragOver(){return Fe()},get onDrop(){return M()},get onDragEnd(){return W()},get onCardDoubleClick(){return ne()},get onDeleteCard(){return Me()},get onCardTitleInput(){return ce()},get onCardTitleChange(){return pe()},get onFileUpload(){return Ae()},get onShotTitleChange(){return Q()},get onToggleColumnMenu(){return y()},get onCloseColumnMenu(){return A()},get onDuplicateColumn(){return ke()},get onDeleteColumn(){return me()},get onColumnDownload(){return Ue()},get onCardContextMenu(){return _e()}})}),vi(je,re=>F(re),()=>F()),le(()=>ze(je,`gap: ${o(t)??""}px`)),H("scroll",je,function(...re){var oe;(oe=te())==null||oe.apply(this,re)}),T(z,de)},be=z=>{var de=t_(),fe=I(de);{var xe=re=>{var oe=Fp();gn(oe,5,s,se=>se,(se,j)=>{const we=He(()=>(b(i()),_(()=>i()[0]))),ge=He(()=>(b(o(we)),o(j),_(()=>ie(o(we),o(j))))),Ge=He(()=>(b(d()),b(o(ge)),_(()=>d().get(o(ge))))),Ie=He(()=>(b(o(Ge)),_(()=>{var Je;return(Je=o(Ge))==null?void 0:Je.cardId}))),X=He(()=>(b(o(Ie)),b(u()),_(()=>o(Ie)?u().get(o(Ie)):null)));var ve=Np(),tt=I(ve),qe=I(tt);qe.__change=[Sp,Q,j];var rt=E(tt,2);{var Ve=Je=>{var Pe=Lp();Pe.__dblclick=[Dp,ne,Ie],Pe.__contextmenu=[Tp,_e,Ie];var Ee=I(Pe);{var Oe=Le=>{var ut=Mp();T(Le,ut)},he=Le=>{var ut=ft(),Ut=$e(ut);{var Re=lt=>{var Lt=xp(),Zn=I(Lt);ui(Zn,{get src(){return b(o(X)),_(()=>o(X).media_url)},get thumbnail(){return b(o(X)),_(()=>o(X).thumb_url)}}),H("dragstart",Lt,jt=>jt.preventDefault()),T(lt,Lt)},Xe=lt=>{var Lt=ft(),Zn=$e(Lt);{var jt=zt=>{var on=Ip();le(()=>{Ye(on,"src",(b(o(X)),_(()=>o(X).thumb_url))),Ye(on,"alt",(b(o(X)),_(()=>o(X).title)))}),H("dragstart",on,We=>We.preventDefault()),T(zt,on)};Z(Zn,zt=>{b(o(X)),_(()=>o(X).thumb_url)&&zt(jt)},!0)}T(lt,Lt)};Z(Ut,lt=>{b(o(X)),_(()=>o(X).media_type==="video"&&o(X).media_url&&o(X).thumb_url)?lt(Re):lt(Xe,!1)},!0)}T(Le,ut)};Z(Ee,Le=>{b(o(X)),_(()=>o(X).isLoading)?Le(Oe):Le(he,!1)})}var Bt=E(Ee,2);{var Mt=Le=>{var ut=Ap(),Ut=I(ut);Ut.__input=[Ep,ce,Ie],Ut.__change=[Op,pe,Ie],Ut.__click=[Rp],le(()=>rn(Ut,(b(o(X)),_(()=>o(X).number?`${o(X).title} ${o(X).number}`:o(X).title)))),T(Le,ut)};Z(Bt,Le=>{b(o(X)),_(()=>!o(X).thumb_url&&!o(X).media_url&&!o(X).isLoading)&&Le(Mt)})}var ye=E(Bt,2);ye.__click=[Up,R,we,j],le(()=>ze(Pe,`background-color: ${b(o(X)),_(()=>o(X).thumb_url?"rgba(0, 0, 0, 0.3)":o(X).color)??""}; width: ${b(h()),_(()=>h().width)??""}px; height: ${b(h()),_(()=>h().height)??""}px`)),H("dragstart",Pe,Le=>Ne()(Le,o(we),o(j),o(Ie))),H("dragover",Pe,Le=>Fe()(Le,o(we),o(j),Le.currentTarget)),H("drop",Pe,Le=>M()(Le,o(we),o(j))),H("dragend",Pe,function(...Le){var ut;(ut=W())==null||ut.apply(this,Le)}),T(Je,Pe)},Ct=Je=>{var Pe=Pp(),Ee=I(Pe),Oe=I(Ee);Oe.__change=[jp,Ae,we,j],le(()=>ze(Pe,`width: ${b(h()),_(()=>h().width)??""}px; height: ${b(h()),_(()=>h().height)??""}px`)),H("dragover",Pe,he=>Fe()(he,o(we),o(j),he.currentTarget)),H("drop",Pe,he=>M()(he,o(we),o(j))),T(Je,Pe)};Z(rt,Je=>{o(X)?Je(Ve):Je(Ct,!1)})}le((Je,Pe,Ee)=>{ze(ve,`gap: ${o(t)??""}px`),ze(tt,`width: ${b(h()),_(()=>h().width*.6)??""}px`),rn(qe,Je),Ye(qe,"placeholder",Pe),qe.disabled=Ee},[()=>(o(j),b(v()),_(()=>o(j).startsWith("phantom-")?"":v().get(o(j))||`Lane ${o(j).replace("c-","")}`)),()=>(o(j),_(()=>o(j).startsWith("phantom-")?"New lane":"Lane title")),()=>(o(j),_(()=>o(j).startsWith("phantom-")))]),T(se,ve)}),le(()=>ze(oe,`gap: ${o(t)??""}px`)),T(re,oe)};Z(fe,re=>{a()&&re(xe)})}var je=E(fe,2);gn(je,5,s,re=>re,(re,oe)=>{var se=e_();gn(se,13,()=>(o(r),o(oe),_(()=>o(r).get(o(oe))||[])),j=>j,(j,we)=>{const ge=He(()=>(o(we),_(()=>o(we).startsWith("virtual-")))),Ge=He(()=>(o(we),o(oe),_(()=>ie(o(we),o(oe))))),Ie=He(()=>(b(d()),b(o(Ge)),_(()=>d().get(o(Ge))))),X=He(()=>(b(o(Ie)),_(()=>{var Ve;return(Ve=o(Ie))==null?void 0:Ve.cardId}))),ve=He(()=>(b(o(X)),b(u()),_(()=>o(X)?u().get(o(X)):null)));var tt=$p(),qe=I(tt);{var rt=Ve=>{var Ct=ft(),Je=$e(Ct);{var Pe=Oe=>{var he=Xp();he.__dblclick=[Bp,ne,X],he.__contextmenu=[zp,_e,X];var Bt=I(he);{var Mt=Re=>{var Xe=Kp();T(Re,Xe)},ye=Re=>{var Xe=ft(),lt=$e(Xe);{var Lt=jt=>{var zt=qp(),on=I(zt);ui(on,{get src(){return b(o(ve)),_(()=>o(ve).media_url)},get thumbnail(){return b(o(ve)),_(()=>o(ve).thumb_url)}}),H("dragstart",zt,We=>We.preventDefault()),T(jt,zt)},Zn=jt=>{var zt=ft(),on=$e(zt);{var We=xt=>{var Qt=Vp();le(()=>{Ye(Qt,"src",(b(o(ve)),_(()=>o(ve).thumb_url))),Ye(Qt,"alt",(b(o(ve)),_(()=>o(ve).title)))}),H("dragstart",Qt,No=>No.preventDefault()),T(xt,Qt)};Z(on,xt=>{b(o(ve)),_(()=>o(ve).thumb_url)&&xt(We)},!0)}T(jt,zt)};Z(lt,jt=>{b(o(ve)),_(()=>o(ve).media_type==="video"&&o(ve).media_url&&o(ve).thumb_url)?jt(Lt):jt(Zn,!1)},!0)}T(Re,Xe)};Z(Bt,Re=>{b(o(ve)),_(()=>o(ve).isLoading)?Re(Mt):Re(ye,!1)})}var Le=E(Bt,2);{var ut=Re=>{var Xe=Wp(),lt=I(Xe);lt.__input=[Hp,ce,X],lt.__change=[Yp,pe,X],lt.__click=[Jp],le(()=>rn(lt,(b(o(ve)),_(()=>o(ve).number?`${o(ve).title} ${o(ve).number}`:o(ve).title)))),T(Re,Xe)};Z(Le,Re=>{b(o(ve)),_(()=>!o(ve).thumb_url&&!o(ve).media_url&&!o(ve).isLoading)&&Re(ut)})}var Ut=E(Le,2);Ut.__click=[Gp,R,we,oe],le(()=>ze(he,`background-color: ${b(o(ve)),_(()=>o(ve).thumb_url?"rgba(0, 0, 0, 0.3)":o(ve).color)??""}; width: ${b(h()),_(()=>h().width)??""}px; height: ${b(h()),_(()=>h().height)??""}px`)),H("dragstart",he,Re=>Ne()(Re,o(we),o(oe),o(X))),H("dragover",he,Re=>Fe()(Re,o(we),o(oe),Re.currentTarget)),H("drop",he,Re=>M()(Re,o(we),o(oe))),H("dragend",he,function(...Re){var Xe;(Xe=W())==null||Xe.apply(this,Re)}),T(Oe,he)},Ee=Oe=>{var he=Qp(),Bt=I(he),Mt=I(Bt);Mt.__change=[Zp,Ae,we,oe],le(()=>ze(he,`width: ${b(h()),_(()=>h().width)??""}px; height: ${b(h()),_(()=>h().height)??""}px`)),H("dragover",he,ye=>Fe()(ye,o(we),o(oe),ye.currentTarget)),H("drop",he,ye=>M()(ye,o(we),o(oe))),T(Oe,he)};Z(Je,Oe=>{o(ve)?Oe(Pe):Oe(Ee,!1)})}T(Ve,Ct)};Z(qe,Ve=>{o(ge)||Ve(rt)})}le(()=>{Rt(tt,1,o(ge)?"drag-placeholder-space-horizontal":"card-animation-wrapper-horizontal","svelte-otng0r"),ze(tt,(b(o(ge)),b(h()),_(()=>o(ge)?`width: ${h().width}px; height: ${h().height}px`:"")))}),H("dragover",tt,Ve=>{o(ge)&&Ve.preventDefault()}),H("drop",tt,Ve=>{o(ge)&&(Ve.preventDefault(),Ve.stopPropagation(),M()(Ve,o(we),o(oe)))}),vl(tt,()=>Tl,()=>({duration:o(ge)?0:300})),T(j,tt)}),le(()=>ze(se,`gap: ${o(t)??""}px`)),T(re,se)}),le(()=>ze(je,`gap: ${o(t)??""}px`)),T(z,de)};Z(et,z=>{c()==="vertical"?z(dt):z(be,!1)})}T(n,ae),Zt()}Cn(["change","click","dblclick","input","contextmenu"]);function s_(n,e,t,r,s,i){if(!e.mediaId)return;const l=t.get(e.mediaId)||[];if(l.length===0)return;const a=l.pop();t.set(e.mediaId,l);const c=r.get(e.mediaId)||[];c.push(JSON.parse(JSON.stringify(o(s)))),r.set(e.mediaId,c),a&&(S(s,a,!0),i(),e.sheet&&e.sheet.doc.getMap(`drawings_${e.mediaId}`).set("strokes",JSON.stringify(o(s))))}function i_(n,e,t,r,s,i){if(!e.mediaId)return;const l=t.get(e.mediaId)||[];if(l.length===0)return;const a=l.pop();t.set(e.mediaId,l);const c=r.get(e.mediaId)||[];c.push(JSON.parse(JSON.stringify(o(s)))),r.set(e.mediaId,c),a&&(S(s,a,!0),i(),e.sheet&&e.sheet.doc.getMap(`drawings_${e.mediaId}`).set("strokes",JSON.stringify(o(s))))}async function o_(n,e,t,r,s,i){if(!e.cardId)return;console.log("[saveModal] Saving changes for card:",e.cardId),console.log("[saveModal] Title:",t(),"Color:",r(),"Prompt:",s());const l=e.cardsMetadata.get(e.cardId);if(l){const a=[...e.undoStack,{type:"edit",userId:e.userId,previousState:{cardId:e.cardId,title:l.title,color:l.color,prompt:l.prompt||""}}];e.onUpdateUndoStack(a),e.onUpdateRedoStack([]),console.log("[saveModal] Saved to undo stack:",a.length,"operations")}try{const a=await fetch(`${e.apiUrl}/api/cards/${e.cardId}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t(),color:r(),prompt:s()})});if(a.ok){const c=await a.json();e.sheet&&ki(e.sheet,e.cardId,c),console.log("[saveModal] Card updated successfully"),e.onShowToast("Backend temporarily disconnected.")}else console.error("[saveModal] Failed to update card:",a.statusText)}catch(a){console.error("[saveModal] Error updating card:",a)}i()}var l_=n=>n.stopPropagation(),a_=(n,e)=>e(n.currentTarget.value),c_=B('<img class="modal-media-image svelte-h7vqqj" loading="eager"/>'),d_=(n,e)=>e("white"),u_=(n,e)=>e("black"),h_=(n,e,t)=>e(o(t).id),f_=B('<div class="attachment-thumbnail svelte-h7vqqj"><img class="svelte-h7vqqj"/> <button class="attachment-delete-btn svelte-h7vqqj" title="Delete attachment">×</button></div>'),g_=B('<div class="modal-overlay svelte-h7vqqj"><div class="modal-content-large svelte-h7vqqj"><div class="modal-left svelte-h7vqqj"><input type="text" class="modal-card-title svelte-h7vqqj" placeholder="Shot title..."/> <div class="modal-card-preview svelte-h7vqqj"><!> <canvas class="sketch-canvas svelte-h7vqqj" width="800" height="450"></canvas></div> <div class="sketch-tools svelte-h7vqqj"><span class="tool-label svelte-h7vqqj">Draw:</span> <button style="background: white;" title="White"></button> <button style="background: black;" title="Black"></button> <div class="tool-divider svelte-h7vqqj"></div> <button class="tool-btn svelte-h7vqqj" title="Undo stroke"><svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M8 4L4 8L8 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M4 8H14C15.1046 8 16 8.89543 16 10V12C16 13.1046 15.1046 14 14 14H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <button class="tool-btn svelte-h7vqqj" title="Redo stroke"><svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M12 4L16 8L12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M16 8H6C4.89543 8 4 8.89543 4 10V12C4 13.1046 4.89543 14 6 14H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <div class="tool-divider svelte-h7vqqj"></div> <button class="tool-btn svelte-h7vqqj" title="Clear all"><svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M4 6H16M8 6V4C8 3.44772 8.44772 3 9 3H11C11.5523 3 12 3.44772 12 4V6M6 6V16C6 16.5523 6.44772 17 7 17H13C13.5523 17 14 16.5523 14 16V6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></button></div></div> <div class="modal-right svelte-h7vqqj"><div class="modal-header svelte-h7vqqj"><button class="modal-close-btn svelte-h7vqqj">×</button></div> <div class="modal-fields svelte-h7vqqj"><div class="modal-field svelte-h7vqqj"><label class="modal-label svelte-h7vqqj">Color</label> <div class="color-input-group svelte-h7vqqj"><input type="color" class="modal-color-picker svelte-h7vqqj"/> <input type="text" class="modal-input modal-color-text svelte-h7vqqj" placeholder="#CCCCCC"/></div></div> <div class="modal-field svelte-h7vqqj"><div class="prompt-header svelte-h7vqqj"><label class="modal-label svelte-h7vqqj">Prompt</label> <button class="format-json-btn svelte-h7vqqj" title="Format as JSON"><span class="material-symbols-outlined svelte-h7vqqj">data_object</span></button></div> <textarea class="modal-textarea svelte-h7vqqj" placeholder="Add a rowing oar" rows="8"></textarea></div> <div class="modal-field svelte-h7vqqj"><label class="modal-label svelte-h7vqqj">Attachments</label> <div class="attachments-gallery svelte-h7vqqj"><label class="attachment-upload-btn svelte-h7vqqj" title="Upload image or video"><span class="material-symbols-outlined svelte-h7vqqj">add_photo_alternate</span> <input type="file" accept="image/*,video/mp4,video/quicktime,video/webm" style="display: none;"/></label> <!></div></div></div> <div class="modal-actions svelte-h7vqqj"><button class="modal-btn modal-btn-cancel svelte-h7vqqj">Cancel</button> <button class="modal-btn modal-btn-save svelte-h7vqqj">Save</button></div></div></div></div>');function v_(n,e){Xt(e,!0);let t=k(e,"title",15),r=k(e,"color",15),s=k(e,"prompt",15),i=k(e,"attachments",15),l=null,a=P(!1),c=P("white"),d=P(st([])),u=null,h=null,v=new Map,f=new Map;function g(M){if(l=M,!M.getContext("2d"))return;const ne=M.getBoundingClientRect();M.width=ne.width,M.height=ne.height,N()}function p(M){if(!l)return;S(a,!0);const W=l.getBoundingClientRect(),ne=M.clientX-W.left,Me=M.clientY-W.top,ce={color:o(c),points:[{x:ne,y:Me}]};S(d,[...o(d),ce],!0),e.sheet&&e.mediaId&&e.sheet.doc.getMap(`drawings_${e.mediaId}`).set("strokes",JSON.stringify(o(d)))}function w(M){if(!o(a)||!l)return;const W=l.getBoundingClientRect(),ne=M.clientX-W.left,Me=M.clientY-W.top,ce=o(d)[o(d).length-1];if(ce){ce.points.push({x:ne,y:Me}),S(d,[...o(d)],!0);const pe=l.getContext("2d");if(pe){const Ae=ce.points[ce.points.length-2];pe.strokeStyle=o(c),pe.lineWidth=3,pe.lineCap="round",pe.lineJoin="round",pe.beginPath(),pe.moveTo(Ae.x,Ae.y),pe.lineTo(ne,Me),pe.stroke()}e.sheet&&e.mediaId&&e.sheet.doc.getMap(`drawings_${e.mediaId}`).set("strokes",JSON.stringify(o(d)))}}function C(){if(o(a)&&e.mediaId){const M=v.get(e.mediaId)||[];M.push(JSON.parse(JSON.stringify(o(d)))),v.set(e.mediaId,M),f.set(e.mediaId,[])}S(a,!1)}function U(){if(S(d,[],!0),l){const M=l.getContext("2d");M&&M.clearRect(0,0,l.width,l.height)}e.sheet&&e.mediaId&&e.sheet.doc.getMap(`drawings_${e.mediaId}`).set("strokes",JSON.stringify([]))}function N(){if(!l)return;const M=l.getContext("2d");M&&(M.clearRect(0,0,l.width,l.height),o(d).forEach(W=>{if(!(W.points.length<2)){M.strokeStyle=W.color,M.lineWidth=3,M.lineCap="round",M.lineJoin="round",M.beginPath(),M.moveTo(W.points[0].x,W.points[0].y);for(let ne=1;ne<W.points.length;ne++)M.lineTo(W.points[ne].x,W.points[ne].y);M.stroke()}}))}function q(M){S(c,M,!0)}function K(){if(!u||!h)return;let M=!1;const W=()=>{if(!u||!h)return;M=!0;const ce=h.toString(),pe=u.value;ce!==pe&&(h.delete(0,ce.length),h.insert(0,pe)),M=!1},ne=()=>{if(M||!u||!h)return;const ce=h.toString();if(u.value===ce)return;if(document.activeElement===u){const Ae=u.selectionStart||0,Q=u.selectionEnd||0;u.value=ce,s(ce),requestAnimationFrame(()=>{u&&u.setSelectionRange(Ae,Q)})}else u.value=ce,s(ce)};h.observe(ne),u.addEventListener("input",W);const Me=()=>{h&&h.unobserve(ne),u&&u.removeEventListener("input",W)};u._yjsCleanup=Me}function F(){if(s())try{const M=JSON.parse(s()),W=JSON.stringify(M,null,2);h&&(h.delete(0,h.length),h.insert(0,W)),s(W),u&&(u.value=W)}catch{console.warn("Prompt is not valid JSON, cannot format")}}function te(M){t(M),e.sheet&&e.cardId&&no(e.sheet,e.cardId,"title",M)}async function J(M){var Me;const W=M.target,ne=(Me=W.files)==null?void 0:Me[0];if(!(!ne||!e.cardId)){try{const ce=new FormData;ce.append("file",ne),ce.append("cardId",e.cardId);const pe=await fetch(`${e.apiUrl}/api/attachments/upload`,{method:"POST",body:ce});if(pe.ok){const Ae=await pe.json();i([...i(),Ae]),e.onUpdateAttachments(i()),e.sheet&&no(e.sheet,e.cardId,"attachments",[...i(),Ae])}else console.error("Failed to upload attachment:",await pe.text())}catch(ce){console.error("Error uploading attachment:",ce)}W.value=""}}async function V(M){if(e.cardId)try{const W=await fetch(`${e.apiUrl}/api/attachments/${M}`,{method:"DELETE"});W.ok?(i(i().filter(ne=>ne.id!==M)),e.onUpdateAttachments(i()),e.sheet&&no(e.sheet,e.cardId,"attachments",i().filter(ne=>ne.id!==M))):console.error("Failed to delete attachment:",await W.text())}catch(W){console.error("Error deleting attachment:",W)}}function G(){u&&u._yjsCleanup&&u._yjsCleanup(),e.onClose()}so(()=>{if(e.show&&e.sheet&&e.mediaId){e.cardId&&(h=e.sheet.doc.getText(`prompt_${e.cardId}`),h.length===0&&s()?h.insert(0,s()):s(h.toString()));const M=e.sheet.doc.getMap(`drawings_${e.mediaId}`),W=M.get("strokes");if(W)try{S(d,JSON.parse(W),!0)}catch{S(d,[],!0)}else S(d,[],!0);const ne=()=>{const Me=M.get("strokes");if(Me)try{S(d,JSON.parse(Me),!0),N()}catch(ce){console.error("Error parsing drawing strokes:",ce)}};return M.observe(ne),setTimeout(()=>{l&&g(l),u&&h&&K()},100),()=>{M.unobserve(ne)}}});var Te=ft(),Ne=$e(Te);{var Fe=M=>{var W=g_();W.__click=G;var ne=I(W);ne.__click=[l_];var Me=I(ne),ce=I(Me);ce.__input=[a_,te];var pe=E(ce,2),Ae=I(pe);{var Q=qe=>{ui(qe,{get src(){return e.mediaUrl},get thumbnail(){return e.thumbUrl}})},y=qe=>{var rt=ft(),Ve=$e(rt);{var Ct=Je=>{var Pe=c_();le(()=>{Ye(Pe,"src",e.mediaUrl),Ye(Pe,"alt",t())}),T(Je,Pe)};Z(Ve,Je=>{e.mediaUrl&&Je(Ct)},!0)}T(qe,rt)};Z(Ae,qe=>{e.mediaType==="video"&&e.mediaUrl&&e.thumbUrl?qe(Q):qe(y,!1)})}var A=E(Ae,2);A.__mousedown=p,A.__mousemove=w,A.__mouseup=C,vi(A,qe=>l=qe,()=>l);var ke=E(pe,2),me=E(I(ke),2);let Ue;me.__click=[d_,q];var _e=E(me,2);let ie;_e.__click=[u_,q];var L=E(_e,4);L.__click=[s_,e,v,f,d,N];var R=E(L,2);R.__click=[i_,e,f,v,d,N];var ee=E(R,4);ee.__click=U;var ae=E(Me,2),et=I(ae),dt=I(et);dt.__click=G;var be=E(et,2),z=I(be),de=E(I(z),2),fe=I(de),xe=E(fe,2);Ye(xe,"pattern","^#[0-9A-Fa-f]6$");var je=E(z,2),re=I(je),oe=E(I(re),2);oe.__click=F;var se=E(re,2);vi(se,qe=>u=qe,()=>u);var j=E(je,2),we=E(I(j),2),ge=I(we),Ge=E(I(ge),2);Ge.__change=J;var Ie=E(ge,2);gn(Ie,17,i,Io,(qe,rt)=>{var Ve=f_(),Ct=I(Ve),Je=E(Ct,2);Je.__click=[h_,V,rt],le(()=>{Ye(Ct,"src",o(rt).thumbnailUrl),Ye(Ct,"alt",o(rt).name)}),T(qe,Ve)});var X=E(be,2),ve=I(X);ve.__click=G;var tt=E(ve,2);tt.__click=[o_,e,t,r,s,G],le((qe,rt)=>{rn(ce,t()),ze(pe,`background-color: ${r()??""}`),Ue=Rt(me,1,"color-circle svelte-h7vqqj",null,Ue,qe),ie=Rt(_e,1,"color-circle svelte-h7vqqj",null,ie,rt),rn(se,s())},[()=>({active:o(c)==="white"}),()=>({active:o(c)==="black"})]),H("mouseleave",A,C),lo(fe,r),lo(xe,r),T(M,W)};Z(Ne,M=>{e.show&&M(Fe)})}T(n,Te),Zt()}Cn(["click","input","mousedown","mousemove","mouseup","change"]);var m_=B('<span class="toast-counter svelte-w17ltc"> </span>'),p_=B('<div class="progress-bar-container svelte-w17ltc"><div class="progress-bar svelte-w17ltc"></div></div>'),__=B('<div class="toast-overlay svelte-w17ltc"><div class="toast svelte-w17ltc"><div class="toast-content svelte-w17ltc"> <!></div> <!></div></div>');function w_(n,e){var t=ft(),r=$e(t);{var s=i=>{var l=__(),a=I(l),c=I(a),d=I(c),u=E(d);{var h=g=>{var p=m_(),w=I(p);le(()=>In(w,`(${e.current??""}/${e.total??""})`)),T(g,p)};Z(u,g=>{e.current!==void 0&&e.total!==void 0&&g(h)})}var v=E(c,2);{var f=g=>{var p=p_(),w=I(p);le(()=>ze(w,`width: ${e.progress??""}%`)),T(g,p)};Z(v,g=>{e.progress!==void 0&&g(f)})}le(()=>In(d,`${e.message??""} `)),T(i,l)};Z(r,i=>{e.show&&i(s)})}T(n,t)}var y_=n=>n.stopPropagation(),b_=B('<div class="confirm-overlay svelte-7e0w24"><div class="confirm-dialog svelte-7e0w24"><div class="confirm-message svelte-7e0w24"> </div> <div class="confirm-buttons svelte-7e0w24"><button class="confirm-btn confirm-btn-cancel svelte-7e0w24">Cancel</button> <button class="confirm-btn confirm-btn-delete svelte-7e0w24">Delete</button></div></div></div>');function C_(n,e){var t=ft(),r=$e(t);{var s=i=>{var l=b_();l.__click=function(...f){var g;(g=e.onCancel)==null||g.apply(this,f)};var a=I(l);a.__click=[y_];var c=I(a),d=I(c),u=E(c,2),h=I(u);h.__click=function(...f){var g;(g=e.onCancel)==null||g.apply(this,f)};var v=E(h,2);v.__click=function(...f){var g;(g=e.onConfirm)==null||g.apply(this,f)},le(()=>In(d,e.message)),T(i,l)};Z(r,i=>{e.show&&i(s)})}T(n,t)}Cn(["click"]);function k_(n,e){e.onClose()}var S_=(n,e)=>{e.onSetCover(),e.onClose()},D_=(n,e)=>{e.onDownload(),e.onClose()},T_=B('<div class="menu-backdrop svelte-12hoypm"></div> <div class="card-menu svelte-12hoypm"><button class="menu-item svelte-12hoypm"><span class="material-symbols-outlined svelte-12hoypm">image</span> Set cover image</button> <button class="menu-item svelte-12hoypm"><span class="material-symbols-outlined svelte-12hoypm">download</span> Download</button></div>',1);function M_(n,e){Xt(e,!0);var t=ft(),r=$e(t);{var s=i=>{var l=T_(),a=$e(l);a.__click=[k_,e];var c=E(a,2),d=I(c);d.__click=[S_,e];var u=E(d,2);u.__click=[D_,e],le(()=>ze(c,`left: ${e.position.x??""}px; top: ${e.position.y??""}px`)),T(i,l)};Z(r,i=>{e.show&&i(s)})}T(n,t),Zt()}Cn(["click"]);var x_=B('<div class="loading svelte-1uha8ag">Loading sheet...</div>'),I_=B("<!> <!> <!> <!> <!>",1);function E_(n,e){Xt(e,!1);const t=vn(),r=vn(new Rh);function s(y){O(r,o(r).toastMessage=y),O(r,o(r).showToast=!0),o(r).toastTimeout&&clearTimeout(o(r).toastTimeout),O(r,o(r).toastTimeout=setTimeout(()=>{O(r,o(r).showToast=!1)},3e3))}function i(y,A){O(r,o(r).confirmMessage=y),O(r,o(r).confirmCallback=A),O(r,o(r).showConfirmDialog=!0)}const l={get draggedCard(){return o(r).draggedCard},set draggedCard(y){O(r,o(r).draggedCard=y)},get dragPreview(){return o(r).dragPreview},set dragPreview(y){O(r,o(r).dragPreview=y)},get isDragging(){return o(r).isDragging},set isDragging(y){O(r,o(r).isDragging=y)},get dragMousePos(){return o(r).dragMousePos},set dragMousePos(y){O(r,o(r).dragMousePos=y)}},a=new Ah(o(r).orientation,l,{onRecordUndo:y=>o(r).undoStack.push(y),onClearRedo:()=>{O(r,o(r).redoStack=[])}},o(r).userId,()=>o(r).sheet,()=>o(r).timeline),c={get draggedColumn(){return o(r).draggedColumn},set draggedColumn(y){O(r,o(r).draggedColumn=y)},get columnDragPreview(){return o(r).columnDragPreview},set columnDragPreview(y){O(r,o(r).columnDragPreview=y)},get isColumnDragging(){return o(r).isColumnDragging},set isColumnDragging(y){O(r,o(r).isColumnDragging=y)}},d=new Uh(o(r).orientation,c,{onRecordUndo:y=>o(r).undoStack.push(y),onClearRedo:()=>{O(r,o(r).redoStack=[])}},o(r).userId,()=>o(r).sheet,()=>o(r).lanes,()=>o(r).timeline,()=>o(r).cellsMap,()=>o(r).cardsMetadata,()=>o(r).thumbnailSize),u={get undoStack(){return o(r).undoStack},set undoStack(y){O(r,o(r).undoStack=y)},get redoStack(){return o(r).redoStack},set redoStack(y){O(r,o(r).redoStack=y)}};let h=null;const v={get openColumnMenu(){return o(r).openColumnMenu},set openColumnMenu(y){O(r,o(r).openColumnMenu=y)}};let f=vn(null);const g={get showModal(){return o(r).showModal},set showModal(y){O(r,o(r).showModal=y)},get modalCardId(){return o(r).modalCardId},set modalCardId(y){O(r,o(r).modalCardId=y)},get modalMediaId(){return o(r).modalMediaId},set modalMediaId(y){O(r,o(r).modalMediaId=y)},get modalTitle(){return o(r).modalTitle},set modalTitle(y){O(r,o(r).modalTitle=y)},get modalColor(){return o(r).modalColor},set modalColor(y){O(r,o(r).modalColor=y)},get modalPrompt(){return o(r).modalPrompt},set modalPrompt(y){O(r,o(r).modalPrompt=y)},get modalMediaUrl(){return o(r).modalMediaUrl},set modalMediaUrl(y){O(r,o(r).modalMediaUrl=y)},get modalMediaType(){return o(r).modalMediaType},set modalMediaType(y){O(r,o(r).modalMediaType=y)},get modalThumbUrl(){return o(r).modalThumbUrl},set modalThumbUrl(y){O(r,o(r).modalThumbUrl=y)},get attachments(){return o(r).attachments},set attachments(y){O(r,o(r).attachments=y)}};let p=vn(null),w=null;const C=300;let U=null;const N=16;function q(){o(r).sheet&&(O(r,o(r).rows=o(r).sheet.rowOrder.toArray()),O(r,o(r).cols=o(r).sheet.colOrder.toArray()),O(r,o(r).cellsMap=new Map(o(r).sheet.cells)),O(r,o(r).shotTitles=new Map(o(r).sheet.shotTitles)))}function K(){U&&clearTimeout(U),U=setTimeout(q,N)}function F(y){const A=new Map;return y.forEach((ke,me)=>{ke instanceof Wt?A.set(me,{id:me,...rl(ke)}):A.set(me,{id:me,...ke})}),A}Mh(async()=>{O(r,o(r).wsUrl="ws://localhost:8000/yjs"),O(r,o(r).apiUrl="http://localhost:8000"),h=new Fv(o(r).orientation,u,o(r).userId,o(r).apiUrl,()=>o(r).sheet,()=>o(r).timeline,()=>o(r).cardsMetadata,()=>"vertical"),S(f,new Bv(o(r).orientation,v,{showConfirm:i,onRecordUndo:y=>o(r).undoStack.push(y),onClearRedo:()=>{O(r,o(r).redoStack=[])},showToast:s},o(r).userId,o(r).apiUrl,()=>o(r).sheet,()=>o(r).cols,()=>o(r).timeline,()=>o(r).cellsMap,()=>o(r).cardsMetadata,()=>o(r).shotTitles,()=>"vertical")),S(p,new zv(o(r).orientation,g,{showConfirm:i,showToast:s,onRecordUndo:y=>o(r).undoStack.push(y),onClearRedo:()=>{O(r,o(r).redoStack=[])},onDeleteColumn:y=>{var A;return(A=o(f))==null?void 0:A.deleteColumn(y)}},o(r).userId,o(r).apiUrl,()=>o(r).sheet,()=>o(r).timeline,()=>o(r).cellsMap,()=>o(r).cardsMetadata,()=>"vertical")),o(r).loadPreferences();try{if(O(r,o(r).sheet=await Pv(o(r).wsUrl,o(r).sheetId,o(r).userId)),!o(r).sheet||!o(r).sheet.rowOrder)throw new Error("Failed to establish valid Yjs connection");o(r).sheet.rowOrder.observe(()=>K()),o(r).sheet.colOrder.observe(()=>K()),o(r).sheet.cells.observe(()=>{K(),w&&clearTimeout(w),w=setTimeout(async()=>{const ke=Nv(o(r).sheet).filter(me=>!o(r).cardsMetadata.has(me));if(ke.length>0)try{const me=await fetch(`${o(r).apiUrl}/api/cards/batch`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cardIds:ke})});if(me.ok){const Ue=await me.json();console.log("[+page.svelte] Fetched cards from API:",Ue.length,Ue[0]),o(r).sheet&&(o(r).sheet.doc.transact(()=>{for(const _e of Ue)ki(o(r).sheet,_e.cardId,{..._e,id:_e.cardId})}),console.log("[+page.svelte] Stored",Ue.length,"cards in Yjs cardsMetadata (batched)"),console.log("[+page.svelte] cardsMetadata size:",o(r).sheet.cardsMetadata.size))}}catch(me){console.error("Failed to fetch card metadata:",me)}},C)});const y=(A,ke)=>{ke.observeDeep(()=>{if(!o(r).sheet)return;const me={id:A,...rl(ke)},Ue=new Map(o(r).cardsMetadata);Ue.set(A,me),O(r,o(r).cardsMetadata=Ue)})};return o(r).sheet.cardsMetadata.observe(A=>{if(!o(r).sheet)return;const ke=new Map(o(r).cardsMetadata);let me=!1;A.changes.keys.forEach((Ue,_e)=>{if(Ue.action==="delete")ke.delete(_e),me=!0;else if(Ue.action==="add"||Ue.action==="update"){const ie=o(r).sheet.cardsMetadata.get(_e);if(ie){if(ie instanceof Wt){const L={id:_e,...rl(ie)};ke.set(_e,L),y(_e,ie)}else ke.set(_e,{id:_e,...ie});me=!0}}}),me&&O(r,o(r).cardsMetadata=ke)}),o(r).sheet.cardsMetadata.forEach((A,ke)=>{A instanceof Wt&&y(ke,A)}),o(r).sheet.shotTitles.observe(()=>K()),O(r,o(r).rows=o(r).sheet.rowOrder.toArray()),O(r,o(r).cols=o(r).sheet.colOrder.toArray()),O(r,o(r).cellsMap=new Map(o(r).sheet.cells)),O(r,o(r).cardsMetadata=F(o(r).sheet.cardsMetadata)),O(r,o(r).shotTitles=new Map(o(r).sheet.shotTitles)),O(r,o(r).loading=!1),()=>{var A;(A=o(r).sheet)==null||A.provider.disconnect()}}catch(y){console.error("Failed to connect to sheet:",y),O(r,o(r).loading=!1),s("Failed to connect to Yjs server. Make sure the backend is running.")}});function te(){h==null||h.handleUndo()}function J(){h==null||h.handleRedo()}async function V(){try{const y=await fetch(`${o(r).apiUrl}/api/sheets/${o(r).sheetId}/regenerate`,{method:"POST"});if(!y.ok)throw new Error(`Regenerate failed: ${y.statusText}`);const A=await y.json();console.log("[handleRegenerate] Sheet regenerated:",A),s("Sheet regenerated successfully")}catch(y){console.error("[handleRegenerate] Failed to regenerate sheet:",y),s("Failed to regenerate sheet")}}function G(y){(y.metaKey||y.ctrlKey)&&y.key==="z"&&!y.shiftKey?(y.preventDefault(),te()):(y.metaKey||y.ctrlKey)&&y.key==="z"&&y.shiftKey?(y.preventDefault(),J()):y.key==="Escape"&&((o(r).isDragging||o(r).isColumnDragging)&&(a.handleDragEnd(new DragEvent("dragend")),d.resetColumnDrag()),o(r).showThumbnailMenu&&O(r,o(r).showThumbnailMenu=!1),o(r).openColumnMenu&&O(r,o(r).openColumnMenu=null),o(r).openEllipsisMenu&&O(r,o(r).openEllipsisMenu=null))}function Te(y){const A=y.target;o(r).showThumbnailMenu&&!A.closest(".thumbnail-dropdown")&&O(r,o(r).showThumbnailMenu=!1),o(r).openEllipsisMenu&&!A.closest(".ellipsis-menu-container")&&O(r,o(r).openEllipsisMenu=null),o(r).openColumnMenu&&!A.closest(".column-menu")&&!A.closest(".menu-btn")&&O(r,o(r).openColumnMenu=null)}function Ne(y){const A=y.target;o(r).columnsContainerRef&&A!==o(r).columnsContainerRef&&O(r,o(r).columnsContainerRef.scrollLeft=A.scrollLeft),o(r).frozenRowRef&&A!==o(r).frozenRowRef&&O(r,o(r).frozenRowRef.scrollLeft=A.scrollLeft)}function Fe(y,A){o(r).sheet&&!y.startsWith("phantom-")&&o(r).sheet.shotTitles.set(y,A)}function M(y,A){O(r,o(r).openCardMenu=A),O(r,o(r).cardMenuPosition={x:y.clientX,y:y.clientY})}async function W(y,A,ke){const me=y.target,Ue=me.files;if(!Ue||Ue.length===0)return;const _e=Array.from(Ue).sort((be,z)=>be.name.localeCompare(z.name)),ie=_e.length;O(r,o(r).toastMessage="Uploading"),O(r,o(r).toastProgress=0),O(r,o(r).toastCurrent=0),O(r,o(r).toastTotal=ie),O(r,o(r).showToast=!0),o(r).toastTimeout&&clearTimeout(o(r).toastTimeout);const L=[];for(let be=0;be<_e.length;be++){const z=_e[be],de=`card-${Date.now()}-${be}-${Math.random().toString(36).substring(2,9)}`;console.log(`[handleFileUpload] File ${be} (${z.name}) -> cardId=${de}, laneId=${ke}, insertIndex=${be}`),L.push({cardId:de,file:z,laneId:ke,insertIndex:be})}if(L.length>0&&o(r).timeline.length>1){const be=o(r).timeline[1],z=ke;console.log("[handleFileUpload] Will scroll to:",be,z);const de=(fe=0)=>{const xe=document.querySelector(`[data-row="${be}"][data-col="${z}"]`);console.log("[handleFileUpload] Scroll attempt",fe,"- found element:",!!xe),xe?(xe.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[handleFileUpload] Scrolled to uploaded card")):fe<5?setTimeout(()=>de(fe+1),100*Math.pow(2,fe)):console.warn("[handleFileUpload] Failed to find card element after 5 attempts")};de()}let R=0;const ee=L.map(async({cardId:be,file:z,laneId:de,insertIndex:fe})=>{const xe=new FormData;xe.append("file",z),xe.append("sheet_id",o(r).sheetId),xe.append("card_id",be),xe.append("lane_id",de),xe.append("insert_index",fe.toString()),xe.append("title",z.name);try{const je=await fetch(`${o(r).apiUrl}/api/media/upload-card`,{method:"POST",body:xe});if(!je.ok)throw new Error("Upload failed");const re=await je.json();R++;const oe=R/ie*100;return O(r,o(r).toastProgress=oe),O(r,o(r).toastCurrent=R),{success:!0,cardId:be,file:z.name}}catch(je){console.error("Upload failed for",z.name,":",je),o(r).sheet&&ki(o(r).sheet,be,{title:"Upload Failed",color:"#FF6B6B",prompt:z.name,isLoading:!1,uploadFailed:!0}),R++;const re=R/ie*100;return O(r,o(r).toastProgress=re),O(r,o(r).toastCurrent=R),{success:!1,cardId:be,file:z.name,error:je}}}),ae=await Promise.all(ee),et=ae.filter(be=>be.success).length,dt=ae.filter(be=>!be.success).length;O(r,o(r).toastProgress=void 0),O(r,o(r).toastCurrent=void 0),O(r,o(r).toastTotal=void 0),s(dt===0?`All ${ie} file${ie>1?"s":""} uploaded successfully!`:`${et}/${ie} file${ie>1?"s":""} uploaded. ${dt} failed.`),me.value=""}Gs(()=>o(r),()=>{S(t,[{name:"Film",count:0,active:!1},{name:"Blocks",count:0,active:!1},{name:"Scenes",count:0,active:!1},{name:"Shots",count:o(r).cols.length,active:!0},{name:"Images",count:0,active:!1}])}),Mo(),Eo();var ne=I_();H("keydown",hi,G),H("click",hi,Te);var Me=$e(ne);um(Me,{get selectedThumbnailSize(){return o(r),_(()=>o(r).selectedThumbnailSize)},get showThumbnailMenu(){return o(r),_(()=>o(r).showThumbnailMenu)},get isSoundMuted(){return o(r),_(()=>o(r).isSoundMuted)},get stickyTopRow(){return o(r),_(()=>o(r).stickyTopRow)},get openEllipsisMenu(){return o(r),_(()=>o(r).openEllipsisMenu)},get orientation(){return o(r),_(()=>o(r).orientation.name)},onUndo:te,onRedo:J,onSetOrientation:y=>{try{o(r).setOrientation(y),o(r).savePreference("orientation",y),s(y==="horizontal"?"Switched to horizontal mode - Time flows left-to-right":"Switched to vertical mode - Time flows top-to-bottom")}catch(A){s(A instanceof Error?A.message:"Failed to change orientation")}},onRegenerate:V,onToggleThumbnailMenu:()=>{O(r,o(r).showThumbnailMenu=!o(r).showThumbnailMenu)},onSelectThumbnailSize:y=>{O(r,o(r).selectedThumbnailSize=y),O(r,o(r).showThumbnailMenu=!1),o(r).savePreference("thumbnailSize",y)},onToggleSound:()=>{O(r,o(r).isSoundMuted=!o(r).isSoundMuted),o(r).savePreference("isSoundMuted",o(r).isSoundMuted)},onToggleStickyTopRow:()=>{O(r,o(r).stickyTopRow=!o(r).stickyTopRow),o(r).savePreference("stickyTopRow",o(r).stickyTopRow)},onToggleEllipsisMenu:y=>{const A=o(r).openEllipsisMenu===y;O(r,o(r).openEllipsisMenu=A?null:y)},projectName:"nanosheet",get levels(){return o(t)},breadcrumbs:[],onLevelClick:y=>s(`${o(t)[y].name} feature not yet implemented`),onShowToast:s,children:(y,A)=>{var ke=ft(),me=$e(ke);{var Ue=ie=>{var L=x_();T(ie,L)},_e=ie=>{r_(ie,{get displayCols(){return o(r),_(()=>o(r).displayCols)},get displayRows(){return o(r),_(()=>o(r).displayRows)},get rows(){return o(r),_(()=>o(r).rows)},get stickyTopRow(){return o(r),_(()=>o(r).stickyTopRow)},get orientation(){return o(r),_(()=>o(r).orientation.name)},get cellsMap(){return o(r),_(()=>o(r).cellsMap)},get cardsMetadata(){return o(r),_(()=>o(r).cardsMetadata)},get thumbnailSize(){return o(r),_(()=>o(r).thumbnailSize)},get shotTitles(){return o(r),_(()=>o(r).shotTitles)},get draggedColumn(){return o(r),_(()=>o(r).draggedColumn)},get isColumnDragging(){return o(r),_(()=>o(r).isColumnDragging)},get columnDragPreview(){return o(r),_(()=>o(r).columnDragPreview)},get isDragging(){return o(r),_(()=>o(r).isDragging)},get draggedCard(){return o(r),_(()=>o(r).draggedCard)},get dragPreview(){return o(r),_(()=>o(r).dragPreview)},get openColumnMenu(){return o(r),_(()=>o(r).openColumnMenu)},get timeline(){return o(r),_(()=>o(r).timeline)},onSyncColumnsScroll:Ne,onColumnDragStart:(L,R)=>d.handleColumnDragStart(L,R),onColumnDragOver:(L,R)=>d.handleColumnDragOver(L,R),onColumnDrop:(L,R)=>d.handleColumnDrop(L,R),onResetColumnDrag:()=>d.resetColumnDrag(),onDragStart:(L,R,ee,ae)=>a.handleDragStart(L,R,ee,ae),onDragOver:(L,R,ee,ae)=>a.handleDragOver(L,R,ee,ae),onDrop:(L,R,ee)=>a.handleDrop(L,R,ee),onDragEnd:L=>a.handleDragEnd(L),onCardDoubleClick:L=>{var R;return(R=o(p))==null?void 0:R.handleCardDoubleClick(L)},onDeleteCard:(L,R)=>{var ee;return(ee=o(p))==null?void 0:ee.handleDeleteCard(L,R)},onCardTitleInput:(L,R)=>{var ee;return(ee=o(p))==null?void 0:ee.handleCardTitleInput(L,R)},onCardTitleChange:(L,R)=>{var ee;return(ee=o(p))==null?void 0:ee.handleCardTitleChange(L,R)},onFileUpload:W,onShotTitleChange:Fe,onToggleColumnMenu:(L,R)=>{var ee;return(ee=o(f))==null?void 0:ee.toggleColumnMenu(L,R)},onCloseColumnMenu:()=>{O(r,o(r).openColumnMenu=null)},onDuplicateColumn:L=>{var R;return(R=o(f))==null?void 0:R.duplicateColumn(L)},onDeleteColumn:L=>{var R;return(R=o(f))==null?void 0:R.deleteColumn(L)},onColumnDownload:L=>{var R;return(R=o(f))==null?void 0:R.handleColumnDownload(L)},onCardContextMenu:M,get frozenRowRef(){return o(r).frozenRowRef},set frozenRowRef(L){O(r,o(r).frozenRowRef=L)},get columnsContainerRef(){return o(r).columnsContainerRef},set columnsContainerRef(L){O(r,o(r).columnsContainerRef=L)},$$legacy:!0})};Z(me,ie=>{o(r),_(()=>o(r).loading)?ie(Ue):ie(_e,!1)})}T(y,ke)},$$slots:{default:!0}});var ce=E(Me,2);v_(ce,{get show(){return o(r),_(()=>o(r).showModal)},get cardId(){return o(r),_(()=>o(r).modalCardId)},mediaId:null,get title(){return o(r),_(()=>o(r).modalTitle)},get color(){return o(r),_(()=>o(r).modalColor)},get prompt(){return o(r),_(()=>o(r).modalPrompt)},get mediaUrl(){return o(r),_(()=>o(r).modalMediaUrl)},get mediaType(){return o(r),_(()=>o(r).modalMediaType)},get thumbUrl(){return o(r),_(()=>o(r).modalThumbUrl)},get attachments(){return o(r),_(()=>o(r).attachments)},get sheet(){return o(r),_(()=>o(r).sheet)},get apiUrl(){return o(r),_(()=>o(r).apiUrl)},get userId(){return o(r),_(()=>o(r).userId)},get cardsMetadata(){return o(r),_(()=>o(r).cardsMetadata)},get undoStack(){return o(r),_(()=>o(r).undoStack)},onClose:()=>{O(r,o(r).showModal=!1)},onSave:y=>{},onUpdateUndoStack:y=>{O(r,o(r).undoStack=y)},onUpdateRedoStack:y=>{O(r,o(r).redoStack=y)},onUpdateAttachments:y=>{O(r,o(r).attachments=y)},onShowToast:s});var pe=E(ce,2);w_(pe,{get show(){return o(r),_(()=>o(r).showToast)},get message(){return o(r),_(()=>o(r).toastMessage)},get progress(){return o(r),_(()=>o(r).toastProgress)},get current(){return o(r),_(()=>o(r).toastCurrent)},get total(){return o(r),_(()=>o(r).toastTotal)}});var Ae=E(pe,2);C_(Ae,{get show(){return o(r),_(()=>o(r).showConfirmDialog)},get message(){return o(r),_(()=>o(r).confirmMessage)},onConfirm:()=>{var y,A;(A=(y=o(r)).confirmCallback)==null||A.call(y),O(r,o(r).showConfirmDialog=!1),O(r,o(r).confirmCallback=null)},onCancel:()=>{O(r,o(r).showConfirmDialog=!1),O(r,o(r).confirmCallback=null)}});var Q=E(Ae,2);{let y=He(()=>(o(r),_(()=>o(r).openCardMenu!==null)));M_(Q,{get show(){return o(y)},get position(){return o(r),_(()=>o(r).cardMenuPosition)},onSetCover:()=>{var A;o(r).openCardMenu&&((A=o(p))==null||A.handleSetCoverImage(o(r).openCardMenu))},onDownload:()=>{var A;o(r).openCardMenu&&((A=o(p))==null||A.handleDownloadCard(o(r).openCardMenu))},onClose:()=>{O(r,o(r).openCardMenu=null)}})}T(n,ne),Zt()}uh(E_,{target:document.getElementById("app")});
